import{r as m,a as e}from"./react-69b9bddd.js";import{a as ae,u as I}from"./react-redux-13959126.js";import"./Card.module-3bdbfb7f.js";import{s as ce,c as se,f as ie,h as me,L as oe,u as de}from"./index-c349c545.js";import{f as ue}from"./icons-material-40f8e5d8.js";import{a as Ee}from"./react-router-7dadf37a.js";import{O as he,Q as ge,a as q,i as v,A as N,h as x,V as we,l as F,f as _e,D as pe,k as r}from"./material-04052d9a.js";import"./@babel-5e587562.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-20ba4de3.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./react-icons-6bc9af43.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./stylis-79144faa.js";import"./utils-49fe0532.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./base-e8cfb5a9.js";import"./@popperjs-f3391c26.js";const Se="_tbl_permissions_181m4_1",fe="_head_181m4_7",_={tbl_permissions:Se,head:fe},M={branch:{invalid:!1,message:""}},Ze=()=>{const f=ae(),R=I(t=>t.user),Q=I(ce),[j,L]=m.useState([]),[T,E]=m.useState(""),[s,G]=m.useState([]),[g,A]=m.useState([]),[C,O]=m.useState(null),[w,z]=m.useState(""),[d,J]=m.useState(""),[K,D]=m.useState({}),[n,p]=m.useState(null),[X,y]=m.useState(!1),[k,B]=m.useState(M),H=Ee();m.useEffect(()=>{var t;if(s!=null&&s.length){const c=(t=s==null?void 0:s.find)==null?void 0:t.call(s,l=>l._id===R.branch);c!=null&&c._id&&z(c)}},[s]),m.useEffect(()=>{if(n){let t=!0;for(const c in n)for(const l in n[c])if(n[c][l].write===!1){t=!1;break}y(t)}},[n]);const V=m.useCallback(()=>{H("/users/usersList")},[H]);m.useEffect(()=>{f(se()).then(({payload:t={}})=>{const{message:c}=(t==null?void 0:t.data)||{};c?E(c):(G(t==null?void 0:t.data),E(""))}).catch(()=>{E("Something went wrong! Please try later or contact Administrator.")})},[]),m.useEffect(()=>{w&&f(ie(w==null?void 0:w._id)).then(({payload:t={}})=>{var l,i,u,o;const{message:c}=(t==null?void 0:t.data)||{};c?E(c):(E(""),((i=(l=R.type)==null?void 0:l.toLowerCase)==null?void 0:i.call(l))==="superadmin"?L(t==null?void 0:t.data):L((o=(u=t==null?void 0:t.data)==null?void 0:u.filter)==null?void 0:o.call(u,({id:S})=>R._id!==S)))}).catch(()=>{E("Something went wrong! Please try later or contact Administrator.")})},[w]),m.useEffect(()=>{d?f(me(d==null?void 0:d.id)).then(({payload:t={}})=>{var c,l,i;D({...(t==null?void 0:t.data)||{}}),p((c=t==null?void 0:t.data)==null?void 0:c.permissions),(l=t==null?void 0:t.data)!=null&&l.userBranches?A(((i=t.data)==null?void 0:i.userBranches)||[]):A([])}).catch(()=>{E("Something went wrong! Please try later or contact Administrator.")}):D({})},[d]);const Y=(t,c)=>{z(c),L([])},Z=(t,c)=>{J(c)},$=(t,c)=>{O(c),B(M)},ee=t=>{g.splice(t,1),A([...g])},te=()=>{if(C)if(g.some(({_id:t})=>t===C._id)){let t={};t.branch={invalid:!0,message:"Branch is already selected."},B(t)}else A(t=>[...t,C]),O(null),B(M);else{let t={};t.branch={invalid:!0,message:"Branch is required."},B(t)}},a=(t,c)=>{var l,i,u;if(t.target.name==="Sales/Purchase_Add_FO_No_write"){const o="Sales/Purchase",S="Add_FO_No",b="write";p(U=>{const P={...U};return P[o][S][b]=c,P})}else{const o=t.target.name,S=(l=o.split)==null?void 0:l.call(o,"_")[0],b=(i=o.split)==null?void 0:i.call(o,"_")[1],U=(u=o.split)==null?void 0:u.call(o,"_")[2];p(P=>{const W={...P};return W[S][b][U]=c,W})}},ne=t=>{t.preventDefault();const c={id:d==null?void 0:d.id,permissions:n,userBranches:g.map(({_id:l})=>l)};f(de(c)).then(({payload:l={}})=>{const{message:i}=(l==null?void 0:l.data)||{};i?E(i):(E(""),V())}).catch(()=>{E("Something went wrong! Please try later or contact Administrator.")})},le=()=>{V()},re=(t,c)=>{y(c),p(c?l=>{for(const i in l)for(const u in l[i])l[i][u].read=!0,l[i][u].write=!0;return l}:l=>{for(const i in l)for(const u in l[i])l[i][u].read=!1,l[i][u].write=!1;return l})},h=(d==null?void 0:d.type)==="User";return e.createElement(e.Fragment,null,Q&&e.createElement(oe,null),e.createElement("h1",{className:"pageHead"},"User permissions"),e.createElement("div",{className:"inner-wrap"},T!==""&&e.createElement(he,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(ge,{severity:"error"},T)),e.createElement("form",{className:"frm-bottom-spc",action:"",onSubmit:ne},e.createElement(q,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},s&&(s==null?void 0:s.length)>0&&e.createElement(v,{fullWidth:!0,size:"small"},e.createElement(N,{disablePortal:!0,size:"small",name:"branch",options:s,value:w||null,onChange:Y,getOptionLabel:t=>t.name||"",openOnFocus:!0,renderInput:t=>e.createElement(x,{...t,label:"Branch",fullWidth:!0})}))),e.createElement("div",{className:"grid-item"},s&&(s==null?void 0:s.length)>0&&e.createElement(v,{fullWidth:!0,size:"small"},e.createElement(N,{disablePortal:!0,size:"small",name:"users",options:j,value:d||null,onChange:Z,getOptionLabel:t=>t.username||"",openOnFocus:!0,renderInput:t=>e.createElement(x,{...t,label:"Users",fullWidth:!0})}))),e.createElement("div",{className:"grid-item"},s&&(s==null?void 0:s.length)>0&&e.createElement(v,{fullWidth:!0,size:"small",error:k.branch.invalid},e.createElement(N,{disablePortal:!0,size:"small",name:"branch",options:s,value:C||null,onChange:$,getOptionLabel:t=>t.name||"",openOnFocus:!0,disabled:!d,renderInput:t=>e.createElement(x,{...t,label:"Assign Branch",fullWidth:!0,error:k.branch.invalid})}),k.branch.invalid&&e.createElement(we,null,k.branch.message))),e.createElement("div",{className:"grid-item"},s&&(s==null?void 0:s.length)>0&&e.createElement(v,{fullWidth:!0,size:"small"},e.createElement(F,{variant:"contained",size:"medium",color:"primary",className:"ml6",style:{width:"max-content"},onClick:te},"Add")))),e.createElement("div",{style:{paddingBottom:"10px"}},g.length?"User assigned Branches":""," "),e.createElement("div",null,e.createElement("table",{className:_.tbl_permissions},e.createElement("tbody",null,g.map(t=>e.createElement("tr",{key:t._id},e.createElement("td",null,t.name),e.createElement("td",null,e.createElement(_e,{size:"small",onClick:ee,color:"error"},e.createElement(ue,null))))))))),K.employee&&e.createElement(e.Fragment,null,e.createElement(pe,{sx:{marginBottom:"20px"}}),e.createElement(q,{sx:{padding:"20px 20px 60px",marginBottom:"20px",overflow:"auto"}},e.createElement("div",null,"Select All"," ",e.createElement(r,{name:"selectAll",checked:X,onChange:re})),e.createElement("table",{className:_.tbl_permissions},e.createElement("tbody",null,e.createElement("tr",null,e.createElement("td",{colSpan:10,className:_.head},"Master")),e.createElement("tr",null,e.createElement("td",{width:"10%"},"Branch"),e.createElement("td",{width:"10%"},e.createElement(r,{name:"Admin_Branch_write",checked:n.Admin.Branch.write,onChange:a})),e.createElement("td",{width:"10%"},"Place"),e.createElement("td",{width:"10%"},e.createElement(r,{name:"Admin_Place_write",checked:n.Admin.Place.write,onChange:a})),e.createElement("td",{width:"10%"},"Article"),e.createElement("td",{width:"10%"},e.createElement(r,{name:"Admin_Article_write",checked:n.Admin.Article.write,onChange:a})),e.createElement("td",null,"Employee"),e.createElement("td",null,e.createElement(r,{name:"Admin_Employee_write",checked:n.Admin.Employee.write,onChange:a})),e.createElement("td",null,"Driver"),e.createElement("td",null,e.createElement(r,{name:"Admin_Driver_write",checked:n.Admin.Driver.write,onChange:a}))),e.createElement("tr",null,e.createElement("td",null,"Customers"),e.createElement("td",null,e.createElement(r,{name:"Admin_Customers_write",checked:n.Admin.Customers.write,onChange:a})),e.createElement("td",null,"Supplier"),e.createElement("td",null,e.createElement(r,{name:"Admin_Supplier_write",checked:n.Admin.Supplier.write,onChange:a})),e.createElement("td",null,"VehicleType"),e.createElement("td",null,e.createElement(r,{name:"Admin_VehicleType_write",checked:n.Admin.VehicleType.write,onChange:a})),e.createElement("td",null,"Vehicle"),e.createElement("td",null,e.createElement(r,{name:"Admin_Vehicle_write",checked:n.Admin.Vehicle.write,onChange:a})),e.createElement("td",null,"BankMaster"),e.createElement("td",null,e.createElement(r,{name:"Sales/Purchase_BankMaster_write",checked:n["Sales/Purchase"].BankMaster.write,onChange:a}))),e.createElement("tr",null),e.createElement("tr",null,e.createElement("td",null,"BankAccountMaster"),e.createElement("td",null,e.createElement(r,{name:"Sales/Purchase_BankAccountMaster_write",checked:n["Sales/Purchase"].BankAccountMaster.write,onChange:a})),e.createElement("td",null,"Rate Master"),e.createElement("td",null,e.createElement(r,{name:"Admin_RateMaster_write",checked:n.Admin.RateMaster.write,onChange:a})),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null)),e.createElement("tr",null,e.createElement("td",{colSpan:10,className:_.head},"Transactions")),e.createElement("tr",null,e.createElement("td",null,"LorryReceipt"),e.createElement("td",null,e.createElement(r,{name:"Sales/Purchase_LorryReceipt_write",checked:n["Sales/Purchase"].LorryReceipt.write,onChange:a})),e.createElement("td",null,"LorryReceiptReg"),e.createElement("td",null,e.createElement(r,{name:"Sales/Purchase_LorryReceiptReg_write",checked:n["Sales/Purchase"].LorryReceiptReg.write,onChange:a})),e.createElement("td",null,"Add_FO_No"),e.createElement("td",null,e.createElement(r,{name:"Sales/Purchase_Add_FO_No_write",checked:n["Sales/Purchase"].Add_FO_No.write,onChange:a})),e.createElement("td",null,"LorryFreightChallan"),e.createElement("td",null,e.createElement(r,{name:"Sales/Purchase_LoadingSlip_write",checked:n["Sales/Purchase"].LoadingSlip.write,onChange:a})),e.createElement("td",null,"LorryFreightChallanReg"),e.createElement("td",null,e.createElement(r,{name:"Sales/Purchase_LoadingSlipRegister_write",checked:n["Sales/Purchase"].LoadingSlipRegister.write,onChange:a}))),e.createElement("tr",null,e.createElement("td",null,"LRAcknowledge"),e.createElement("td",null,e.createElement(r,{name:"Sales/Purchase_LRAcknowledge_write",checked:n["Sales/Purchase"].LRAcknowledge.write,onChange:a})),e.createElement("td",null,"BillList"),e.createElement("td",null,e.createElement(r,{name:"Accounts_RouteBill_write",checked:n.Accounts.RouteBill.write,onChange:a})),e.createElement("td",null,"BillRegister"),e.createElement("td",null,e.createElement(r,{name:"Accounts_BillRegister_write",checked:n.Accounts.BillRegister.write,onChange:a})),e.createElement("td",null,"PaymentCollection"),e.createElement("td",null,e.createElement(r,{name:"Accounts_PaymentCollection_write",checked:n.Accounts.PaymentCollection.write,onChange:a})),e.createElement("td",null,"PaymentAdvice"),e.createElement("td",null,e.createElement(r,{name:"Sales/Purchase_PaymentAdvice_write",checked:n["Sales/Purchase"].PaymentAdvice.write,onChange:a}))),e.createElement("tr",null,e.createElement("td",{width:"10%"},"MoneyTransfer"),e.createElement("td",{width:"10%"},e.createElement(r,{name:"Admin_MoneyTransfer_write",checked:n.Admin.MoneyTransfer.write,onChange:a})),e.createElement("td",null,"Quotation"),e.createElement("td",null,e.createElement(r,{name:"Sales/Purchase_TripSheet_write",checked:n["Sales/Purchase"].TripSheet.write,onChange:a})),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null)),e.createElement("tr",null,e.createElement("td",{colSpan:10,className:_.head},"Reports")),e.createElement("tr",null,e.createElement("td",null,"BilledLRStatus"),e.createElement("td",null,e.createElement(r,{name:"Accounts_BilledLRStatus_write",checked:n.Accounts.BilledLRStatus.write,onChange:a})),e.createElement("td",null,"LoadingTripsheet"),e.createElement("td",null,e.createElement(r,{name:"Accounts_LoadingSlip_write",checked:n.Accounts.LoadingSlip.write,onChange:a})),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null)),e.createElement("tr",null,e.createElement("td",{colSpan:10,className:_.head},"User")),e.createElement("tr",null,e.createElement("td",null,"UserList"),e.createElement("td",null,e.createElement(r,{name:"User_UserActivation_write",disabled:h,checked:h?!1:n.User.UserActivation.write,onChange:a})),e.createElement("td",null,"RoleMaster"),e.createElement("td",null,e.createElement(r,{name:"User_RoleMaster_write",disabled:h,checked:h?!1:n.User.RoleMaster.write,onChange:a})),e.createElement("td",null,"ChangePassword"),e.createElement("td",null,e.createElement(r,{name:"User_ChangePassword_write",disabled:h,checked:h?!1:n.User.ChangePassword.write,onChange:a})),e.createElement("td",null,"UserRegister"),e.createElement("td",null,e.createElement(r,{name:"User_UserRegister_write",disabled:h,checked:h?!1:n.User.UserRegister.write,onChange:a})),e.createElement("td",null),e.createElement("td",null)))),e.createElement("div",{className:"right userpButtons"},e.createElement(F,{variant:"outlined",size:"medium",onClick:le},"Cancel"),e.createElement(F,{variant:"contained",size:"medium",type:"submit",color:"primary",className:"ml6"},"Save")))))))};export{Ze as default};
