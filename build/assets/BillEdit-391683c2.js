import{r as d,a as e}from"./react-69b9bddd.js";import{u as U,a as de}from"./react-redux-13959126.js";import{L as he,A as fe,D as ve}from"./x-date-pickers-f3802fc3.js";import{L as Ee}from"./LorryReceipts-1c804c18.js";import"./Card.module-3bdbfb7f.js";import{bR as be,b$ as pe,L as Fe,an as j,bY as Pe,c0 as Ce,bU as Le,b5 as Se,b_ as xe,bT as Ne}from"./index-1d9d8716.js";import{F as Be}from"./file-saver-259f058c.js";import{a as ke,b as Ae}from"./react-router-7dadf37a.js";import{O as Ie,Q as ze,a as X,i as b,A as Z,h as p,V as x,D as Te,m as L,l as _}from"./material-04052d9a.js";import"./@babel-5e587562.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-20ba4de3.js";import"./@date-io-28dabb9c.js";import"./dayjs-39ab3f8d.js";import"./utils-49fe0532.js";import"./clsx-1229b3e0.js";import"./base-e8cfb5a9.js";import"./@popperjs-f3391c26.js";import"./rifm-bf33b601.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./stylis-79144faa.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./x-data-grid-83fc2422.js";import"./prop-types-b6d0a120.js";import"./reselect-36a88051.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./icons-material-40f8e5d8.js";import"./react-icons-6bc9af43.js";const T={branch:"",date:new Date,from:"",to:"",customer:"",lrList:[],totalFreight:"",freight:"",localFreight:"",cgst:"",cgstPercent:"",sgst:"",sgstPercent:"",total:"",grandTotal:"",remark:""},w={branch:{invalid:!1,message:""},date:{invalid:!1,message:""},customer:{invalid:!1,message:""},lrList:{invalid:!1,message:""},totalFreight:{invalid:!1,message:""},freight:{invalid:!1,message:""},localFreight:{invalid:!1,message:""},cgstPercent:{invalid:!1,message:""},sgstPercent:{invalid:!1,message:""}},Ft=()=>{var q,Q,Y,J;const O=U(t=>t.user),R=U(be),{branches:N,customers:s}=U(({bill:t})=>t)||{},[B,y]=d.useState([]),[P,ee]=d.useState([]),[n,v]=d.useState(T),[g,te]=d.useState(T),[a,W]=d.useState(w),[G,h]=d.useState(""),k=de(),V=ke(),re=Ae(),{billId:A}=re.state,H=d.useCallback(()=>{V("/transactions/billList")},[V]);d.useEffect(()=>{const t=Object.keys(a);if(t!=null&&t.length){const r=document.querySelector(`input[name=${t[0]}]`);r==null||r.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[a]),d.useEffect(()=>{if(G){const t=document.getElementById("alertError");t==null||t.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[G]);const ne=(t,r,l,o)=>{k(Pe({branch:t,consignor:r,from:l,to:o})).then(({payload:c={}})=>{var E;const{message:m}=(c==null?void 0:c.data)||{};if(m)h(m);else{const i=[...(c==null?void 0:c.data)||[]];(E=i==null?void 0:i.forEach)==null||E.call(i,f=>{var C,S;f.checked=!1,f.consignor=((C=s==null?void 0:s.filter)==null?void 0:C.call(s,u=>u._id===f.consignor)[0])||"",f.consignee=((S=s==null?void 0:s.filter)==null?void 0:S.call(s,u=>u._id===f.consignee)[0])||""}),ee(i)}}).catch(()=>{h("Something went wrong! Please try later or contact Administrator.")})};d.useEffect(()=>{g.branch&&g.customer&&ne(g.branch,g.customer,g.from,g.to)},[g.branch,g.customer,g.from,g.to]),d.useEffect(()=>{A&&k(pe(A)).then(({payload:t={}})=>{const{message:r}=(t==null?void 0:t.data)||{};r?h(r):te(t==null?void 0:t.data)}).catch(()=>{h("Something went wrong! Please try later or contact Administrator.")})},[A]),d.useEffect(()=>{var t,r,l,o,c,m;if(g._id&&(P!=null&&P.length)&&(s!=null&&s.length)){const E={...g},i=(t=P==null?void 0:P.map)==null?void 0:t.call(P,u=>{var z,K;const I=(K=(z=g.lrList)==null?void 0:z.filter)==null?void 0:K.call(z,ue=>ue._id===u._id);return{...u,checked:!!(I!=null&&I.length)}});let f;A&&(f=(r=i==null?void 0:i.filter)==null?void 0:r.call(i,u=>!u.billGenerated||u.billGenerated&&u.assoBill===A));const C=(l=N==null?void 0:N.find)==null?void 0:l.call(N,u=>u._id===g.branch);E.lrList=(c=(o=E.lrList)==null?void 0:o.map)==null?void 0:c.call(o,u=>{var I;return((I=i==null?void 0:i.filter)==null?void 0:I.call(i,z=>z._id===u._id)[0])||""});const S=(m=s==null?void 0:s.find)==null?void 0:m.call(s,u=>u._id===g.customer);v({...E,branch:C,customer:S}),y(f)}},[g,P,s,A]),d.useEffect(()=>{const t=+n.totalFreight+ +n.freight+ +n.localFreight,r=t+ +n.sgst+ +n.cgst;v(l=>({...l,total:t,grandTotal:r}))},[n.totalFreight,n.freight,n.localFreight,n.sgst,n.cgst]),d.useEffect(()=>{const t=+n.totalFreight+ +n.freight+ +n.localFreight,r=t*+n.cgstPercent/100,l=t*+n.sgstPercent/100;v(o=>({...o,cgst:r,sgst:l}))},[n.cgstPercent,n.sgstPercent,n.totalFreight,n.freight,n.localFreight]),d.useEffect(()=>{var r,l;const t=(l=(r=n.lrList)==null?void 0:r.reduce)==null?void 0:l.call(r,(o,c)=>o+c.total,0);v(o=>({...o,totalFreight:t}))},[n.lrList]);const ie=()=>{v(T),h(""),W(w)},ae=()=>{H()},F=t=>{const r=t.target.name,l=t.target.value;v(o=>({...o,[r]:l}))},M=(t,r)=>{v(l=>({...l,[r]:t}))},le=t=>{var l;const r=(l=t.trim)==null?void 0:l.call(t);((r==null?void 0:r.length)>2||!r)&&k(Ne(r))},se=({target:t})=>{le(t.value)},D=(t,r,l)=>{var o,c;t.preventDefault(),ce(n)||k(Ce({...n,branch:(o=n.branch)==null?void 0:o._id,customer:(c=n.customer)==null?void 0:c._id})).then(({payload:m={}})=>{const{message:E}=(m==null?void 0:m.data)||{};E?h(E):r?k(Le({id:m==null?void 0:m.data._id,email:""})).then(({payload:i={}})=>{const{message:f}=(i==null?void 0:i.data)||{};if(f&&h(f),i!=null&&i.data.file){const C=Se(i==null?void 0:i.data.file);if(C){const S=window.open(C,"_blank");S.focus(),S.print(),h(""),W(w),v(T),H()}}}).catch(i=>{h(i.message)}):l?k(xe({id:m==null?void 0:m.data._id,email:""})).then(({payload:i={}})=>{const{message:f}=(i==null?void 0:i.data)||{};if(f)h(f);else{const C=new Blob([i==null?void 0:i.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Be.saveAs(C,"Bill.xlsx"),h(""),W(w),v(T),H()}}).catch(i=>{h(i.message)}):(h(""),W(w),v(T),H())}).catch(m=>{h(m.message)})},oe=t=>{t.preventDefault(),D(t,!0)},me=t=>{t.preventDefault(),D(t,!1,!0)},ce=t=>{var o,c,m;const r={...w};t.branch||(r.branch={invalid:!0,message:"Branch is required"}),t.date||(r.date={invalid:!0,message:"Date is required"}),t.customer||(r.customer={invalid:!0,message:"Customer is required"}),(!((o=t.lrList)!=null&&o.length)||!((m=(c=t.lrList||[]).some)!=null&&m.call(c,E=>E)))&&(r.lrList={invalid:!0,message:"At least one lorry receipt is required"}),+t.totalFreight<=0&&(r.totalFreight={invalid:!0,message:"Total freight should be greater than 0"}),+t.freight<0&&(r.freight={invalid:!0,message:"Freight should be 0 or more"}),+t.localFreight<0&&(r.localFreight={invalid:!0,message:"Local freight should be 0 or more"}),+t.cgstPercent<0&&(r.cgstPercent={invalid:!0,message:"CGST % should be 0 or more"}),+t.sgstPercent<0&&(r.sgstPercent={invalid:!0,message:"SGST % should be 0 or more"});let l=!1;for(const E in r)r[E].invalid===!0&&(l=!0);return l&&W(r),l},$=(t,r)=>{v(l=>({...l,[t]:new Date(r)}))},ge=()=>{var r;const t=(r=B==null?void 0:B.filter)==null?void 0:r.call(B,l=>l.checked);v(l=>({...l,lrList:t}))};return e.createElement(e.Fragment,null,R&&e.createElement(Fe,null),e.createElement("div",{className:"inner-wrap"},e.createElement("h1",{className:"pageHead"},"Edit a bill"),G!==""&&e.createElement(Ie,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(ze,{id:"alertError",severity:"error"},G)),e.createElement("form",{action:"",onSubmit:D,id:"billForm"},e.createElement(X,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0,size:"small",error:a.branch.invalid},e.createElement(Z,{disablePortal:!0,size:"small",name:"branch",options:N,value:n.branch||null,onChange:(t,r)=>M(r,"branch"),getOptionLabel:t=>t.name,openOnFocus:!0,disabled:O&&O.type&&((Q=(q=O.type)==null?void 0:q.toLowerCase)==null?void 0:Q.call(q))!=="superadmin"&&((J=(Y=O.type)==null?void 0:Y.toLowerCase)==null?void 0:J.call(Y))!=="admin",renderInput:t=>e.createElement(p,{...t,label:"Branch",name:"branch",error:a.branch.invalid,fullWidth:!0})}),a.branch.invalid&&e.createElement(x,null,a.branch.message))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0,size:"small",error:a.customer.invalid},e.createElement(Z,{disablePortal:!0,autoSelect:!0,size:"small",name:"customer",options:s,value:n.customer||null,onChange:(t,r)=>M(r,"customer"),getOptionLabel:t=>t.name,openOnFocus:!0,renderInput:t=>e.createElement(p,{...t,label:"Customer",error:a.customer.invalid,fullWidth:!0,onChange:se})}),a.customer.invalid&&e.createElement(x,null,a.customer.message))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0,error:a.date.invalid},e.createElement(he,{dateAdapter:fe},e.createElement(ve,{error:a.date.invalid,label:"Date",inputFormat:"DD/MM/YYYY",value:n.date,disableFuture:!0,onChange:$.bind(null,"date"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(p,{name:"date",size:"small",...t,error:a.date.invalid})})),a.date.invalid&&e.createElement(x,null,a.date.message)))))),a.lrList.invalid&&e.createElement("p",{className:"error"},a.lrList.message),e.createElement(X,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement(Ee,{lorryReceipts:B,setLRForBill:ge,bill:n,setBill:v,dateInputChangeHandler:$}),e.createElement(Te,{sx:{margin:"20px 0"}}),e.createElement("form",{action:"",onSubmit:D,id:"billForm"},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0},e.createElement(p,{size:"small",type:"number",variant:"outlined",label:"Total freight",value:n.totalFreight||"",onChange:F,name:"totalFreight",id:"totalFreight",InputProps:{startAdornment:e.createElement(L,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0,error:a.freight.invalid},e.createElement(p,{size:"small",variant:"outlined",label:"Freight",value:n.freight||"",error:a.freight.invalid,onInput:j,onChange:F,name:"freight",id:"freight",InputProps:{startAdornment:e.createElement(L,{position:"start"},"₹"),maxLength:15}}),a.freight.invalid&&e.createElement(x,null,a.freight.message))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0,error:a.localFreight.invalid},e.createElement(p,{size:"small",variant:"outlined",label:"Local freight",value:n.localFreight||"",error:a.localFreight.invalid,onChange:F,onInput:j,name:"localFreight",id:"localFreight",InputProps:{startAdornment:e.createElement(L,{position:"start"},"₹"),maxLength:15}}),a.localFreight.invalid&&e.createElement(x,null,a.localFreight.message))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0,error:a.cgstPercent.invalid},e.createElement(p,{size:"small",variant:"outlined",label:"CGST %",value:n.cgstPercent||"",error:a.cgstPercent.invalid,onChange:F,onInput:j,name:"cgstPercent",id:"cgstPercent",InputProps:{endAdornment:e.createElement(L,{position:"end"},"%"),maxLength:15}}),a.cgstPercent.invalid&&e.createElement(x,null,a.cgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0},e.createElement(p,{size:"small",type:"number",variant:"outlined",label:"CGST",value:n.cgst||"",onChange:F,name:"cgst",id:"cgst",InputProps:{startAdornment:e.createElement(L,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0,error:a.sgstPercent.invalid},e.createElement(p,{size:"small",variant:"outlined",label:"SGST %",value:n.sgstPercent||"",error:a.sgstPercent.invalid,onChange:F,onInput:j,name:"sgstPercent",id:"sgstPercent",InputProps:{endAdornment:e.createElement(L,{position:"end"},"%"),maxLength:15}}),a.sgstPercent.invalid&&e.createElement(x,null,a.sgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0},e.createElement(p,{size:"small",type:"number",variant:"outlined",label:"SGST",value:n.sgst||"",onChange:F,name:"sgst",id:"sgst",InputProps:{startAdornment:e.createElement(L,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0},e.createElement(p,{size:"small",type:"number",variant:"outlined",label:"Total",value:n.total||"",onChange:F,name:"total",id:"total",InputProps:{startAdornment:e.createElement(L,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0},e.createElement(p,{size:"small",type:"number",variant:"outlined",label:"Grand total",value:n.grandTotal||"",onChange:F,name:"grandTotal",id:"grandTotal",InputProps:{startAdornment:e.createElement(L,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(b,{fullWidth:!0},e.createElement(p,{size:"small",variant:"outlined",label:"Remark",value:n.remark,onChange:F,name:"remark",id:"remark",inputProps:{maxLength:200}}))))),e.createElement("div",{className:"right"},e.createElement(_,{variant:"outlined",size:"medium",onClick:ae},"Back"),e.createElement(_,{variant:"outlined",size:"medium",onClick:ie,className:"ml6"},"Reset"),e.createElement(_,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"billForm",className:"ml6"},"Save"),e.createElement(_,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:oe},"Save & Print")," ",e.createElement(_,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:me},"export to excel sheet")))))};export{Ft as default};
