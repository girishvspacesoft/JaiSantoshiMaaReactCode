import{r as f,a as e}from"./react-69b9bddd.js";import{u as P,a as le}from"./react-redux-13959126.js";import{f as ie}from"./icons-material-40f8e5d8.js";import{L as I,A as L,D as N}from"./x-date-pickers-f3802fc3.js";import"./Card.module-3bdbfb7f.js";import{da as se,dj as me,L as oe,an as de,dk as ce,dc as O}from"./index-1d9d8716.js";import{S as ue}from"./Stations-b566eaca.js";import{b as ge,a as he}from"./react-router-7dadf37a.js";import{O as pe,Q as Ee,a as fe,i as o,A as Q,h as d,V as h,m as ve,D as R,a5 as be,a6 as Ce,a7 as xe,a8 as j,a9 as s,aa as Fe,f as ze,l as _}from"./material-04052d9a.js";import"./@babel-5e587562.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-20ba4de3.js";import"./@date-io-28dabb9c.js";import"./dayjs-39ab3f8d.js";import"./utils-49fe0532.js";import"./clsx-1229b3e0.js";import"./base-e8cfb5a9.js";import"./@popperjs-f3391c26.js";import"./rifm-bf33b601.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./stylis-79144faa.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./react-icons-6bc9af43.js";const V={date:new Date,customer:"",customerId:null,from:null,branch:null,to:null,otherField:"",field1:"",field2:"",field3:"",termsAndCond:"",ddChanger:500,ratePer:"",stations:[]},A={branch:{invalid:!1,message:""},date:{invalid:!1,message:""},customer:{invalid:!1,message:""},from:{invalid:!1,message:""},to:{invalid:!1,message:""},ratePer:{invalid:!1,message:""},stations:{invalid:!1,message:""}},st=()=>{var C,W,x,Y,k,F,w;const y=P(se),G=ge(),{quotationId:T}=G.state,[r,c]=f.useState(V),[n,D]=f.useState(A),[q,p]=f.useState(""),v=le(),H=he(),{places:E,branches:J,customers:K}=P(({quotation:t})=>t)||{},b=P(t=>t.user),S=f.useCallback(()=>{H("/transactions/quotations")},[H]);f.useEffect(()=>{E!=null&&E.length&&T&&v(me(T)).then(({payload:t={}})=>{const{message:a}=(t==null?void 0:t.data)||{};a?p(a):c(t==null?void 0:t.data)}).catch(()=>{p("Something went wrong! Please try later or contact Administrator.")})},[E]);const U=()=>{S()},u=t=>{const a=t.target.name,l=t.target.value;c(i=>({...i,[a]:l}))},X=t=>{var a,l;t.preventDefault(),Z(r)||(r.branch&&(r.branch=(a=r.branch)==null?void 0:a._id),r.customerId&&(r.customerId=(l=r.customerId)==null?void 0:l._id),v(ce(r)).then(({payload:i={}})=>{const{message:m}=(i==null?void 0:i.data)||{};m?p(m):(p(""),D(A),c(V),S())}).catch(i=>{p(i.message)}))},Z=t=>{var i,m,g,B,M;const a={...A};t.branch||(a.branch={invalid:!0,message:"Branch is required"}),t.date||(a.date={invalid:!0,message:"Date is required"}),(m=(i=t.customer)==null?void 0:i.trim)!=null&&m.call(i)||(a.customer={invalid:!0,message:"Customer is required"}),t.from||(a.from={invalid:!0,message:"From date is required"}),t.to||(a.to={invalid:!0,message:"To date is required"}),(B=(g=t.ratePer)==null?void 0:g.trim)!=null&&B.call(g)||(a.ratePer={invalid:!0,message:"Rate type is required"}),(M=t.stations)!=null&&M.length||(a.stations={invalid:!0,message:"At least one entry is required"});let l=!1;for(const ne in a)a[ne].invalid===!0&&(l=!0);return l&&D(a),l},z=(t,a)=>{c(l=>({...l,[t]:new Date(a)}))},$=(t,a,l)=>{c(i=>({...i,[l]:a}))},ee=(t,a)=>{a?typeof a=="object"&&c(l=>({...l,customerId:a,customer:a.label})):c(l=>({...l,customerId:null,customer:""}))},te=({target:t})=>{c(a=>({...a,customer:t.value,customerId:null})),ae(t.value)},ae=t=>{var l;const a=(l=t.trim)==null?void 0:l.call(t);(a==null?void 0:a.length)>2?v(O(a)):a||v(O())},re=(t,a)=>{var l,i;if(t.preventDefault(),(l=r.stations)!=null&&l.length){const m=r.stations;(i=m==null?void 0:m.splice)==null||i.call(m,a,1),c(g=>({...g,stations:m}))}};return e.createElement(e.Fragment,null,y&&e.createElement(oe,null),e.createElement("h1",{className:"pageHead"},"Edit a quotation"),e.createElement("div",{className:"inner-wrap"},q!==""&&e.createElement(pe,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(Ee,{severity:"error"},q)),e.createElement(fe,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("form",{action:"",onSubmit:X,id:"quotationForm"},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,size:"small",error:n.branch.invalid},e.createElement(Q,{disablePortal:!0,size:"small",name:"branch",options:J,value:r.branch,onChange:(t,a)=>$(t,a,"branch"),getOptionLabel:t=>t.name||"",openOnFocus:!0,disabled:b&&b.type&&((W=(C=b.type)==null?void 0:C.toLowerCase)==null?void 0:W.call(C))!=="superadmin"&&((Y=(x=b.type)==null?void 0:x.toLowerCase)==null?void 0:Y.call(x))!=="admin",renderInput:t=>e.createElement(d,{...t,label:"Branch",name:"branch",error:n.branch.invalid,fullWidth:!0})}),n.branch.invalid&&e.createElement(h,null,n.branch.message))),e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,error:n.date.invalid},e.createElement(I,{dateAdapter:L},e.createElement(N,{error:n.date.invalid,label:"Date",inputFormat:"DD/MM/YYYY",value:r.date,onChange:z.bind(null,"date"),renderInput:t=>e.createElement(d,{name:"date",size:"small",autoComplete:"off",...t,error:n.date.invalid})})),n.date.invalid&&e.createElement(h,null,n.date.message))),e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,size:"small",error:n.customer.invalid},e.createElement(Q,{id:"customerId",autoSelect:!0,size:"small",name:"customerId",options:K,value:r.customerId,onChange:(t,a)=>ee(t,a),getOptionLabel:t=>t.name,openOnFocus:!0,renderInput:t=>e.createElement(d,{...t,label:"Customer",name:"customerId",onChange:a=>te(a),error:n.customer.invalid,fullWidth:!0})}),n.customer.invalid&&e.createElement(h,null,n.customer.message))),e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,error:n.from.invalid},e.createElement(I,{dateAdapter:L},e.createElement(N,{error:n.from.invalid,label:"From date",inputFormat:"DD/MM/YYYY",value:r.from,onChange:z.bind(null,"from"),renderInput:t=>e.createElement(d,{name:"from",size:"small",autoComplete:"off",...t,error:n.from.invalid})})),n.from.invalid&&e.createElement(h,null,n.from.message))),e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,error:n.to.invalid},e.createElement(I,{dateAdapter:L},e.createElement(N,{error:n.to.invalid,label:"To date",inputFormat:"DD/MM/YYYY",value:r.to,onChange:z.bind(null,"to"),renderInput:t=>e.createElement(d,{name:"to",size:"small",autoComplete:"off",...t,error:n.to.invalid})})),n.to.invalid&&e.createElement(h,null,n.to.message))),e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,size:"small",error:n.ratePer.invalid},e.createElement(d,{size:"small",variant:"outlined",label:"Rate per",helperText:"Ex. for 'Full Load' use short (F.L.)",FormHelperTextProps:{disabled:!0,classes:{sizeSmall:"small"}},value:r.ratePer,error:n.ratePer.invalid,onChange:u,name:"ratePer",id:"ratePer"}),n.ratePer.invalid&&e.createElement(h,null,n.ratePer.message))),e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,size:"small"},e.createElement(d,{size:"small",variant:"outlined",label:"Other header field",value:r.otherField,onChange:u,name:"otherField",id:"otherField",helperText:"Ex. for 'Half Load' use short (H.L.)",FormHelperTextProps:{disabled:!0,classes:{sizeSmall:"small"}}})))," ",e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,size:"small"},e.createElement(d,{size:"small",variant:"outlined",label:"Additional Terms and Condition",value:r.termsAndCond,onChange:u,name:"termsAndCond",id:"termsAndCond",inputProps:{maxLength:500}}))),e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,size:"small"},e.createElement(d,{size:"small",variant:"outlined",label:"DD Changer",value:r.ddChanger||"",onChange:u,onInput:de,name:"ddChanger",id:"ddChanger",InputProps:{startAdornment:e.createElement(ve,{position:"start"},"₹"),maxLength:10},inputProps:{maxLength:10}}))),e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,size:"small"},e.createElement(d,{size:"small",variant:"outlined",label:"Field 1",value:r.field1,onChange:u,name:"field1",id:"field1",inputProps:{maxLength:20}}))),e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,size:"small"},e.createElement(d,{size:"small",variant:"outlined",label:"Field 2",value:r.field2,onChange:u,name:"field2",id:"field2",inputProps:{maxLength:20}}))),e.createElement("div",{className:"grid-item"},e.createElement(o,{fullWidth:!0,size:"small"},e.createElement(d,{size:"small",variant:"outlined",label:"Field 3",value:r.field3,onChange:u,name:"field3",id:"field3",inputProps:{maxLength:20}}))))),e.createElement(R,{sx:{margin:"20px 0"}}),n.stations.invalid&&e.createElement("p",{className:"error"},n.stations.message),e.createElement(ue,{places:E,quotation:r,setQuotation:c}),((k=r.stations)==null?void 0:k.length)>0?e.createElement(be,null,e.createElement(Ce,{sx:{width:"80%"},className:"tbl_jsm"},e.createElement(xe,null,e.createElement(j,null,e.createElement(s,null,"Station"),e.createElement(s,{align:"right"},"Rate per ",r.ratePer),e.createElement(s,{align:"right"},r.otherField),e.createElement(s,{align:"right"},r.field1),e.createElement(s,{align:"right"},r.field2),e.createElement(s,{align:"right"},r.field3),e.createElement(s,{align:"center"},"Action"))),e.createElement(Fe,null,(w=(F=r.stations)==null?void 0:F.map)==null?void 0:w.call(F,(t,a)=>e.createElement(j,{key:a,sx:{"&:last-child td, &:last-child th":{border:0}}},e.createElement(s,null,t.station),e.createElement(s,{align:"right"},"₹ ",t.amount),e.createElement(s,{align:"right"},"₹ ",t.otherFieldValue),e.createElement(s,{align:"right"},"₹ ",t.field1),e.createElement(s,{align:"right"},"₹ ",t.field2),e.createElement(s,{align:"right"},"₹ ",t.field3),e.createElement(s,{align:"center"},e.createElement(ze,{size:"small",onClick:l=>re(l,a),color:"error"},e.createElement(ie,null)))))))):null,e.createElement(R,{sx:{margin:"20px 0"}}),e.createElement("div",{className:"right"},e.createElement(_,{variant:"outlined",size:"medium",onClick:U},"Back"),e.createElement(_,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"quotationForm",className:"ml6"},"Save")))))};export{st as default};
