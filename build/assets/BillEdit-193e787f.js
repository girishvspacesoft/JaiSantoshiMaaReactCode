import{r as g,a as e}from"./react-ef3a9354.js";import{u as j,a as he}from"./react-redux-60e7b2bb.js";import{L as U,A as Q,D as X}from"./x-date-pickers-488148bd.js";import{L as fe}from"./LorryReceipts-57b2aa96.js";import"./Card.module-3bdbfb7f.js";import{bN as ve,bW as Ee,L as be,al as q,bT as pe,bX as Fe,bP as Pe,b3 as Ce,bV as xe}from"./index-38e56929.js";import{F as Le}from"./file-saver-259f058c.js";import{a as Se,b as Ne}from"./react-router-c905df87.js";import{O as Ae,Q as Be,a as y,i as h,A as ee,h as f,V as S,D as Ie,m as x,l as O}from"./material-a209ad60.js";import"./@babel-5e587562.js";import"./react-dom-7dcc36ef.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-54e50305.js";import"./@date-io-28dabb9c.js";import"./dayjs-39ab3f8d.js";import"./utils-7edb168f.js";import"./clsx-1229b3e0.js";import"./base-7d25deaf.js";import"./@popperjs-f3391c26.js";import"./rifm-3b678e07.js";import"./system-5cdc79da.js";import"./styled-engine-b70b2ed8.js";import"./@emotion-afe87aa6.js";import"./stylis-79144faa.js";import"./private-theming-1cbad2aa.js";import"./react-transition-group-6e6f7170.js";import"./dom-helpers-9a525042.js";import"./x-data-grid-f709ef26.js";import"./prop-types-a80e8cd9.js";import"./reselect-36a88051.js";import"./redux-persist-cccb0614.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-584a1cea.js";import"./@remix-run-8989dd9f.js";import"./icons-material-e9adcbb1.js";import"./react-icons-5ea1dfbe.js";const k={branch:"",date:new Date,from:"",to:"",customer:"",lrList:[],totalFreight:"",freight:"",localFreight:"",cgst:"",cgstPercent:"",sgst:"",sgstPercent:"",total:"",grandTotal:"",remark:""},T={branch:{invalid:!1,message:""},date:{invalid:!1,message:""},customer:{invalid:!1,message:""},lrList:{invalid:!1,message:""},totalFreight:{invalid:!1,message:""},freight:{invalid:!1,message:""},localFreight:{invalid:!1,message:""},cgstPercent:{invalid:!1,message:""},sgstPercent:{invalid:!1,message:""}},Et=()=>{var H,K,M,Z;const _=j(t=>t.user),te=j(ve),{branches:N,customers:s}=j(({bill:t})=>t)||{},[A,re]=g.useState([]),[P,ne]=g.useState([]),[n,b]=g.useState(k),[u,ae]=g.useState(k),[i,w]=g.useState(T),[D,v]=g.useState(""),W=he(),$=Se(),ie=Ne(),{billId:B}=ie.state,Y=g.useCallback(()=>{$("/transactions/billList")},[$]);g.useEffect(()=>{const t=Object.keys(i);if(t!=null&&t.length){const r=document.querySelector(`input[name=${t[0]}]`);r==null||r.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[i]),g.useEffect(()=>{if(D){const t=document.getElementById("alertError");t==null||t.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[D]);const le=(t,r,l,m)=>{W(pe({branch:t,consignor:r,from:l,to:m})).then(({payload:c={}})=>{var p;const{message:o}=(c==null?void 0:c.data)||{};if(o)v(o);else{const a=[...(c==null?void 0:c.data)||[]];(p=a==null?void 0:a.forEach)==null||p.call(a,E=>{var C,L;E.checked=!1,E.consignor=((C=s==null?void 0:s.filter)==null?void 0:C.call(s,d=>d._id===E.consignor)[0])||"",E.consignee=((L=s==null?void 0:s.filter)==null?void 0:L.call(s,d=>d._id===E.consignee)[0])||""}),ne(a)}}).catch(()=>{v("Something went wrong! Please try later or contact Administrator.")})};g.useEffect(()=>{u.branch&&u.customer&&le(u.branch,u.customer,u.from,u.to)},[u.branch,u.customer,u.from,u.to]),g.useEffect(()=>{B&&W(Ee(B)).then(({payload:t={}})=>{const{message:r}=(t==null?void 0:t.data)||{};r?v(r):ae(t==null?void 0:t.data)}).catch(()=>{v("Something went wrong! Please try later or contact Administrator.")})},[B]),g.useEffect(()=>{var t,r,l,m,c,o;if(u._id&&(P!=null&&P.length)&&(s!=null&&s.length)){const p={...u},a=(t=P==null?void 0:P.map)==null?void 0:t.call(P,d=>{var z,R;const I=(R=(z=u.lrList)==null?void 0:z.filter)==null?void 0:R.call(z,ge=>ge._id===d._id);return{...d,checked:!!(I!=null&&I.length)}});let E;B&&(E=(r=a==null?void 0:a.filter)==null?void 0:r.call(a,d=>!d.billGenerated||d.billGenerated&&d.assoBill===B));const C=(l=N==null?void 0:N.find)==null?void 0:l.call(N,d=>d._id===u.branch);p.lrList=(c=(m=p.lrList)==null?void 0:m.map)==null?void 0:c.call(m,d=>{var I;return((I=a==null?void 0:a.filter)==null?void 0:I.call(a,z=>z._id===d._id)[0])||""});const L=(o=s==null?void 0:s.find)==null?void 0:o.call(s,d=>d._id===u.customer);b({...p,branch:C,customer:L}),re(E)}},[u,P,s,B]),g.useEffect(()=>{const t=+n.totalFreight+ +n.freight+ +n.localFreight,r=t+ +n.sgst+ +n.cgst;b(l=>({...l,total:t,grandTotal:r}))},[n.totalFreight,n.freight,n.localFreight,n.sgst,n.cgst]),g.useEffect(()=>{const t=+n.totalFreight+ +n.freight+ +n.localFreight,r=t*+n.cgstPercent/100,l=t*+n.sgstPercent/100;b(m=>({...m,cgst:r,sgst:l}))},[n.cgstPercent,n.sgstPercent,n.totalFreight,n.freight,n.localFreight]),g.useEffect(()=>{var r,l;const t=(l=(r=n.lrList)==null?void 0:r.reduce)==null?void 0:l.call(r,(m,c)=>m+c.total,0);b(m=>({...m,totalFreight:t}))},[n.lrList]);const se=()=>{b(k),v(""),w(T)},me=()=>{Y()},F=t=>{const r=t.target.name,l=t.target.value;b(m=>({...m,[r]:l}))},J=(t,r)=>{b(l=>({...l,[r]:t}))},G=(t,r,l)=>{var m,c;t.preventDefault(),ue(n)||W(Fe({...n,branch:(m=n.branch)==null?void 0:m._id,customer:(c=n.customer)==null?void 0:c._id})).then(({payload:o={}})=>{const{message:p}=(o==null?void 0:o.data)||{};p?v(p):r?W(Pe({id:o==null?void 0:o.data._id,email:""})).then(({payload:a={}})=>{const{message:E}=(a==null?void 0:a.data)||{};if(E&&v(E),a!=null&&a.data.file){const C=Ce(a==null?void 0:a.data.file);if(C){const L=window.open(C,"_blank");L.focus(),L.print(),v(""),w(T),b(k),Y()}}}).catch(a=>{v(a.message)}):l?W(xe({id:o==null?void 0:o.data._id,email:""})).then(({payload:a={}})=>{const{message:E}=(a==null?void 0:a.data)||{};if(E)v(E);else{const C=new Blob([a==null?void 0:a.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Le.saveAs(C,"Bill.xlsx"),v(""),w(T),b(k),Y()}}).catch(a=>{v(a.message)}):(v(""),w(T),b(k),Y())}).catch(o=>{v(o.message)})},oe=t=>{t.preventDefault(),G(t,!0)},ce=t=>{t.preventDefault(),G(t,!1,!0)},ue=t=>{var m,c,o;const r={...T};t.branch||(r.branch={invalid:!0,message:"Branch is required"}),t.date||(r.date={invalid:!0,message:"Date is required"}),t.customer||(r.customer={invalid:!0,message:"Customer is required"}),(!((m=t.lrList)!=null&&m.length)||!((o=(c=t.lrList||[]).some)!=null&&o.call(c,p=>p)))&&(r.lrList={invalid:!0,message:"At least one lorry receipt is required"}),+t.totalFreight<=0&&(r.totalFreight={invalid:!0,message:"Total freight should be greater than 0"}),+t.freight<0&&(r.freight={invalid:!0,message:"Freight should be 0 or more"}),+t.localFreight<0&&(r.localFreight={invalid:!0,message:"Local freight should be 0 or more"}),+t.cgstPercent<0&&(r.cgstPercent={invalid:!0,message:"CGST % should be 0 or more"}),+t.sgstPercent<0&&(r.sgstPercent={invalid:!0,message:"SGST % should be 0 or more"});let l=!1;for(const p in r)r[p].invalid===!0&&(l=!0);return l&&w(r),l},V=(t,r)=>{b(l=>({...l,[t]:new Date(r)}))},de=()=>{var r;const t=(r=A==null?void 0:A.filter)==null?void 0:r.call(A,l=>l.checked);b(l=>({...l,lrList:t}))};return e.createElement(e.Fragment,null,te&&e.createElement(be,null),e.createElement("div",{className:"inner-wrap"},e.createElement("h1",{className:"pageHead"},"Edit a bill"),D!==""&&e.createElement(Ae,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(Be,{id:"alertError",severity:"error"},D)),e.createElement("form",{action:"",onSubmit:G,id:"billForm"},e.createElement(y,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,size:"small",error:i.branch.invalid},e.createElement(ee,{disablePortal:!0,size:"small",name:"branch",options:N,value:n.branch||null,onChange:(t,r)=>J(r,"branch"),getOptionLabel:t=>t.name,openOnFocus:!0,disabled:_&&_.type&&((K=(H=_.type)==null?void 0:H.toLowerCase)==null?void 0:K.call(H))!=="superadmin"&&((Z=(M=_.type)==null?void 0:M.toLowerCase)==null?void 0:Z.call(M))!=="admin",renderInput:t=>e.createElement(f,{...t,label:"Branch",name:"branch",error:i.branch.invalid,fullWidth:!0})}),i.branch.invalid&&e.createElement(S,null,i.branch.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,size:"small",error:i.customer.invalid},e.createElement(ee,{disablePortal:!0,autoSelect:!0,size:"small",name:"customer",options:s,value:n.customer||null,onChange:(t,r)=>J(r,"customer"),getOptionLabel:t=>t.name,openOnFocus:!0,renderInput:t=>e.createElement(f,{...t,label:"Customer",error:i.customer.invalid,fullWidth:!0})}),i.customer.invalid&&e.createElement(S,null,i.customer.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:i.date.invalid},e.createElement(U,{dateAdapter:Q},e.createElement(X,{error:i.date.invalid,label:"Date",inputFormat:"DD/MM/YYYY",value:n.date,disableFuture:!0,onChange:V.bind(null,"date"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(f,{name:"date",size:"small",...t,error:i.date.invalid})})),i.date.invalid&&e.createElement(S,null,i.date.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(U,{dateAdapter:Q},e.createElement(X,{label:"From",inputFormat:"DD/MM/YYYY",value:n.from||null,maxDate:n.to,disableFuture:!0,onChange:V.bind(null,"from"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(f,{name:"from",size:"small",...t})})))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(U,{dateAdapter:Q},e.createElement(X,{label:"To",inputFormat:"DD/MM/YYYY",value:n.to||null,minDate:n.from,disableFuture:!0,onChange:V.bind(null,"to"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(f,{name:"to",size:"small",...t})}))))))),i.lrList.invalid&&e.createElement("p",{className:"error"},i.lrList.message),e.createElement(y,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement(fe,{lorryReceipts:A,setLRForBill:de,bill:n,setBill:b}),e.createElement(Ie,{sx:{margin:"20px 0"}}),e.createElement("form",{action:"",onSubmit:G,id:"billForm"},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"Total freight",value:n.totalFreight||"",onChange:F,name:"totalFreight",id:"totalFreight",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:i.freight.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"Freight",value:n.freight||"",error:i.freight.invalid,onInput:q,onChange:F,name:"freight",id:"freight",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),maxLength:15}}),i.freight.invalid&&e.createElement(S,null,i.freight.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:i.localFreight.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"Local freight",value:n.localFreight||"",error:i.localFreight.invalid,onChange:F,onInput:q,name:"localFreight",id:"localFreight",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),maxLength:15}}),i.localFreight.invalid&&e.createElement(S,null,i.localFreight.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:i.cgstPercent.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"CGST %",value:n.cgstPercent||"",error:i.cgstPercent.invalid,onChange:F,onInput:q,name:"cgstPercent",id:"cgstPercent",InputProps:{endAdornment:e.createElement(x,{position:"end"},"%"),maxLength:15}}),i.cgstPercent.invalid&&e.createElement(S,null,i.cgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"CGST",value:n.cgst||"",onChange:F,name:"cgst",id:"cgst",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:i.sgstPercent.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"SGST %",value:n.sgstPercent||"",error:i.sgstPercent.invalid,onChange:F,onInput:q,name:"sgstPercent",id:"sgstPercent",InputProps:{endAdornment:e.createElement(x,{position:"end"},"%"),maxLength:15}}),i.sgstPercent.invalid&&e.createElement(S,null,i.sgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"SGST",value:n.sgst||"",onChange:F,name:"sgst",id:"sgst",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"Total",value:n.total||"",onChange:F,name:"total",id:"total",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"Grand total",value:n.grandTotal||"",onChange:F,name:"grandTotal",id:"grandTotal",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",variant:"outlined",label:"Remark",value:n.remark,onChange:F,name:"remark",id:"remark",inputProps:{maxLength:200}}))))),e.createElement("div",{className:"right"},e.createElement(O,{variant:"outlined",size:"medium",onClick:me},"Back"),e.createElement(O,{variant:"outlined",size:"medium",onClick:se,className:"ml6"},"Reset"),e.createElement(O,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"billForm",className:"ml6"},"Save"),e.createElement(O,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:oe},"Save & Print")," ",e.createElement(O,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:ce},"export to excel sheet")))))};export{Et as default};
