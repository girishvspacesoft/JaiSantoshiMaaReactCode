import{r as f,a as e}from"./react-69b9bddd.js";import{u as G,a as ne}from"./react-redux-13959126.js";import{L as ae,A as ie,D as se}from"./x-date-pickers-f3802fc3.js";import{L as le}from"./LorryReceipts-1c804c18.js";import"./Card.module-3bdbfb7f.js";import{bR as oe,bY as me,L as ce,an as A,bZ as de,bU as ge,b5 as ue,b_ as he,bT as fe}from"./index-1d9d8716.js";import{F as ve}from"./file-saver-259f058c.js";import{b as Ee,a as pe}from"./react-router-7dadf37a.js";import{O as be,Q as Fe,a as j,i as d,A as U,h as g,V as P,D as Pe,m as b,l as I}from"./material-04052d9a.js";import"./@babel-5e587562.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-20ba4de3.js";import"./@date-io-28dabb9c.js";import"./dayjs-39ab3f8d.js";import"./utils-49fe0532.js";import"./clsx-1229b3e0.js";import"./base-e8cfb5a9.js";import"./@popperjs-f3391c26.js";import"./rifm-bf33b601.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./stylis-79144faa.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./x-data-grid-83fc2422.js";import"./prop-types-b6d0a120.js";import"./reselect-36a88051.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./icons-material-40f8e5d8.js";import"./react-icons-6bc9af43.js";const k={branch:"",date:new Date,from:"",to:"",customer:"",lrList:[],totalFreight:"",freight:"",localFreight:"",cgst:"",cgstPercent:"",sgst:"",sgstPercent:"",total:"",grandTotal:"",remark:""},C={branch:{invalid:!1,message:""},date:{invalid:!1,message:""},customer:{invalid:!1,message:""},lrList:{invalid:!1,message:""},totalFreight:{invalid:!1,message:""},freight:{invalid:!1,message:""},localFreight:{invalid:!1,message:""},cgstPercent:{invalid:!1,message:""},sgstPercent:{invalid:!1,message:""}},mt=()=>{var W,q,O,Y;const V=G(oe),{branches:M,customers:v}=G(({bill:t})=>t)||{},z=G(t=>t.user),{state:Q}=Ee(),[L,Z]=f.useState([]),[n,c]=f.useState({...k,branch:Q}),[i,x]=f.useState(C),[B,u]=f.useState(""),S=ne(),H=pe(),T=f.useCallback(()=>{H("/transactions/billList")},[H]);f.useEffect(()=>{const t=Object.keys(i);if(t!=null&&t.length){const r=document.querySelector(`input[name=${t[0]}]`);r==null||r.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[i]),f.useEffect(()=>{if(B){const t=document.getElementById("alertError");t==null||t.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[B]),f.useEffect(()=>{var t,r;n.branch&&n.customer&&S(me({branch:(t=n.branch)==null?void 0:t._id,consignor:(r=n.customer)==null?void 0:r._id,from:n.from,to:n.to})).then(({payload:a={}})=>{var h,o,p;const{message:l}=(a==null?void 0:a.data)||{};if(l)u(l);else{const s=(o=(h=a==null?void 0:a.data)==null?void 0:h.filter)==null?void 0:o.call(h,m=>!m.billGenerated);(p=s==null?void 0:s.forEach)==null||p.call(s,m=>{var F,N;m.checked=!1,m.consignor=((F=v==null?void 0:v.filter)==null?void 0:F.call(v,_=>_._id===m.consignor)[0])||"",m.consignee=((N=v==null?void 0:v.filter)==null?void 0:N.call(v,_=>_._id===m.consignee)[0])||""}),Z(s),c(m=>({...m,lrList:[]}))}}).catch(()=>{u("Something went wrong! Please try later or contact Administrator.")})},[n.branch,n.customer,n.from,n.to]),f.useEffect(()=>{var r,a;let t=0;(a=(r=n.lrList)==null?void 0:r.forEach)==null||a.call(r,l=>{t+=+l.total}),c(l=>({...l,totalFreight:t}))},[n.lrList]),f.useEffect(()=>{const t=+n.totalFreight+ +n.freight+ +n.localFreight,r=t+ +n.sgst+ +n.cgst;c(a=>({...a,total:t,grandTotal:r}))},[n.totalFreight,n.freight,n.localFreight,n.sgst,n.cgst]),f.useEffect(()=>{const t=+n.totalFreight+ +n.freight+ +n.localFreight,r=t*+n.cgstPercent/100,a=t*+n.sgstPercent/100;c(l=>({...l,cgst:r,sgst:a}))},[n.cgstPercent,n.sgstPercent,n.totalFreight,n.freight,n.localFreight]),f.useEffect(()=>{var r,a;const t=(a=(r=n.lrList)==null?void 0:r.reduce)==null?void 0:a.call(r,(l,h)=>l+h.total,0);c(l=>({...l,totalFreight:t}))},[n.lrList]);const $=()=>{c(k),u(""),x(C)},J=()=>{T()},E=t=>{const r=t.target.name,a=t.target.value;c(l=>({...l,[r]:a}))},D=(t,r)=>{c(a=>({...a,[r]:t}))},w=(t,r,a)=>{var l,h;t.preventDefault(),y(n)||S(de({...n,branch:(l=n.branch)==null?void 0:l._id,customer:(h=n.customer)==null?void 0:h._id})).then(({payload:o={}})=>{const{message:p}=(o==null?void 0:o.data)||{};p?u(p):r?S(ge({id:o==null?void 0:o.data._id,email:""})).then(({payload:s={}})=>{const{message:m}=(s==null?void 0:s.data)||{};if(m&&u(m),s!=null&&s.data.file){const F=ue(s==null?void 0:s.data.file);if(F){const N=window.open(F,"_blank");N.focus(),N.print(),u(""),x(C),c(k),T()}}}).catch(s=>{u(s.message)}):a?S(he({id:o==null?void 0:o.data._id,email:""})).then(({payload:s={}})=>{const{message:m}=(s==null?void 0:s.data)||{};if(m)u(m);else{const F=new Blob([s==null?void 0:s.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});ve.saveAs(F,"Bill.xlsx"),u(""),x(C),c(k),T()}}).catch(s=>{u(s.message)}):(u(""),x(C),c(k),T())}).catch(o=>{u(o.message)})},K=t=>{t.preventDefault(),w(t,!0)},X=t=>{t.preventDefault(),w(t,!1,!0)},y=t=>{var l,h,o;const r={...C};t.branch||(r.branch={invalid:!0,message:"Branch is required"}),t.date||(r.date={invalid:!0,message:"Date is required"}),t.customer||(r.customer={invalid:!0,message:"Customer is required"}),(!((l=t.lrList)!=null&&l.length)||!((o=(h=t.lrList||[]).some)!=null&&o.call(h,p=>p)))&&(r.lrList={invalid:!0,message:"At least one lorry receipt is required"}),+t.totalFreight<=0&&(r.totalFreight={invalid:!0,message:"Total freight should be greater than 0"}),+t.freight<0&&(r.freight={invalid:!0,message:"Freight should be 0 or more"}),+t.localFreight<0&&(r.localFreight={invalid:!0,message:"Local freight should be 0 or more"}),+t.cgstPercent<0&&(r.cgstPercent={invalid:!0,message:"CGST % should be 0 or more"}),+t.sgstPercent<0&&(r.sgstPercent={invalid:!0,message:"SGST % should be 0 or more"});let a=!1;for(const p in r)r[p].invalid===!0&&(a=!0);return a&&x(r),a},R=(t,r)=>{c(a=>({...a,[t]:new Date(r)}))},ee=t=>{var a;const r=(a=t.trim)==null?void 0:a.call(t);((r==null?void 0:r.length)>2||!r)&&S(fe(r))},te=({target:t})=>{ee(t.value)},re=()=>{var r;const t=(r=L==null?void 0:L.filter)==null?void 0:r.call(L,a=>a.checked);c(a=>({...a,lrList:t}))};return e.createElement(e.Fragment,null,V&&e.createElement(ce,null),e.createElement("h1",{className:"pageHead"},"Add a bill"),e.createElement("div",{className:"inner-wrap"},B!==""&&e.createElement(be,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(Fe,{id:"alertError",severity:"error"},B)),e.createElement("form",{action:"",onSubmit:w,id:"billForm"},e.createElement(j,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0,size:"small",error:i.branch.invalid},e.createElement(U,{disablePortal:!0,size:"small",name:"branch",options:M,value:n.branch,onChange:(t,r)=>D(r,"branch"),getOptionLabel:t=>t.name,openOnFocus:!0,disabled:z&&z.type&&((q=(W=z.type)==null?void 0:W.toLowerCase)==null?void 0:q.call(W))!=="superadmin"&&((Y=(O=z.type)==null?void 0:O.toLowerCase)==null?void 0:Y.call(O))!=="admin",renderInput:t=>e.createElement(g,{...t,label:"Branch",name:"branch",error:i.branch.invalid,fullWidth:!0})}),i.branch.invalid&&e.createElement(P,null,i.branch.message))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0,size:"small",error:i.customer.invalid},e.createElement(U,{disablePortal:!0,autoSelect:!0,size:"small",name:"customer",options:v,value:n.customer||null,onChange:(t,r)=>D(r,"customer"),getOptionLabel:t=>t.name,openOnFocus:!0,renderInput:t=>e.createElement(g,{...t,label:"Customer",error:i.customer.invalid,fullWidth:!0,onChange:te})}),i.customer.invalid&&e.createElement(P,null,i.customer.message))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0,error:i.date.invalid},e.createElement(ae,{dateAdapter:ie},e.createElement(se,{error:i.date.invalid,label:"Date",inputFormat:"DD/MM/YYYY",value:n.date,disableFuture:!0,onChange:R.bind(null,"date"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(g,{name:"date",size:"small",...t,error:i.date.invalid})})),i.date.invalid&&e.createElement(P,null,i.date.message)))))),i.lrList.invalid&&e.createElement("p",{className:"error"},i.lrList.message),e.createElement(j,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement(le,{lorryReceipts:L,setLRForBill:re,bill:n,setBill:c,dateInputChangeHandler:R}),e.createElement(Pe,{sx:{margin:"20px 0"}}),e.createElement("form",{action:"",onSubmit:w,id:"billForm"},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0},e.createElement(g,{size:"small",type:"number",variant:"outlined",label:"Total freight",value:n.totalFreight||"",onChange:E,name:"totalFreight",id:"totalFreight",InputProps:{startAdornment:e.createElement(b,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0,error:i.freight.invalid},e.createElement(g,{size:"small",type:"text",variant:"outlined",label:"Freight",value:n.freight||"",error:i.freight.invalid,onInput:A,onChange:E,name:"freight",id:"freight",InputProps:{maxLength:12,startAdornment:e.createElement(b,{position:"start"},"₹")}}),i.freight.invalid&&e.createElement(P,null,i.freight.message))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0,error:i.localFreight.invalid},e.createElement(g,{size:"small",variant:"outlined",label:"Local freight",value:n.localFreight||"",error:i.localFreight.invalid,onChange:E,onInput:A,name:"localFreight",id:"localFreight",InputProps:{startAdornment:e.createElement(b,{position:"start"},"₹"),maxLength:15}}),i.localFreight.invalid&&e.createElement(P,null,i.localFreight.message))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0,error:i.cgstPercent.invalid},e.createElement(g,{size:"small",variant:"outlined",label:"CGST %",value:n.cgstPercent||"",error:i.cgstPercent.invalid,onChange:E,onInput:A,name:"cgstPercent",id:"cgstPercent",InputProps:{endAdornment:e.createElement(b,{position:"end"},"%"),maxLength:15}}),i.cgstPercent.invalid&&e.createElement(P,null,i.cgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0},e.createElement(g,{size:"small",variant:"outlined",label:"CGST",value:n.cgst||"",onChange:E,onInput:A,name:"cgst",id:"cgst",InputProps:{startAdornment:e.createElement(b,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0,error:i.sgstPercent.invalid},e.createElement(g,{size:"small",variant:"outlined",label:"SGST %",value:n.sgstPercent||"",error:i.sgstPercent.invalid,onChange:E,onInput:A,name:"sgstPercent",id:"sgstPercent",InputProps:{endAdornment:e.createElement(b,{position:"end"},"%"),maxLength:15}}),i.sgstPercent.invalid&&e.createElement(P,null,i.sgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0},e.createElement(g,{size:"small",variant:"outlined",label:"SGST",value:n.sgst||"",onChange:E,name:"sgst",id:"sgst",InputProps:{startAdornment:e.createElement(b,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0},e.createElement(g,{size:"small",variant:"outlined",label:"Total",value:n.total||"",onChange:E,name:"total",id:"total",InputProps:{startAdornment:e.createElement(b,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0},e.createElement(g,{size:"small",type:"number",variant:"outlined",label:"Grand total",value:n.grandTotal||"",onChange:E,name:"grandTotal",id:"grandTotal",InputProps:{startAdornment:e.createElement(b,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(d,{fullWidth:!0},e.createElement(g,{size:"small",variant:"outlined",label:"Remark",value:n.remark,onChange:E,name:"remark",id:"remark",inputProps:{maxLength:200}}))))),e.createElement("div",{className:"right"},e.createElement(I,{variant:"outlined",size:"medium",onClick:J},"Back"),e.createElement(I,{variant:"outlined",size:"medium",onClick:$,className:"ml6"},"Reset"),e.createElement(I,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"billForm",className:"ml6"},"Save"),e.createElement(I,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:K},"Save & Print"),e.createElement(I,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:X},"export to excel sheet")))))};export{mt as default};
