import{r as d,a as e}from"./react-bfabd40c.js";import{a as ae,u as I}from"./react-redux-45d870ba.js";import"./Card.module-3bdbfb7f.js";import{s as ce,c as se,f as ie,h as me,L as de,u as oe}from"./index-54d20a5c.js";import{f as ue}from"./icons-material-4539f19e.js";import{a as Ee}from"./react-router-622b2d59.js";import{O as he,Q as ge,a as q,i as P,A as N,h as M,V as _e,l as x,f as we,D as pe,k as a}from"./material-e0a59a28.js";import"./@babel-e11bafe1.js";import"./react-dom-b0178e93.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-6cfbf744.js";import"./use-sync-external-store-18921cc2.js";import"./redux-persist-d9cc1560.js";import"./redux-b7ba668d.js";import"./@reduxjs-4d37e7cf.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-4a70c6fc.js";import"./react-router-dom-60901e53.js";import"./@remix-run-d753ad9e.js";import"./react-icons-55b3b9a0.js";import"./system-a1d29c52.js";import"./styled-engine-f3bd09bf.js";import"./@emotion-77835cc8.js";import"./stylis-79144faa.js";import"./utils-c03c978f.js";import"./private-theming-970ac73c.js";import"./react-transition-group-7ded6f4d.js";import"./dom-helpers-9a525042.js";import"./base-ff50cfe3.js";import"./@popperjs-f3391c26.js";const fe="_tbl_permissions_181m4_1",Se="_head_181m4_7",w={tbl_permissions:fe,head:Se},F={branch:{invalid:!1,message:""}},Ze=()=>{const S=ae(),R=I(t=>t.user),Q=I(ce),[j,v]=d.useState([]),[T,h]=d.useState(""),[i,G]=d.useState([]),[g,A]=d.useState([]),[C,O]=d.useState(null),[_,z]=d.useState(""),[u,J]=d.useState(""),[K,D]=d.useState({}),[n,p]=d.useState(null),[X,y]=d.useState(!1),[k,b]=d.useState(F),H=Ee();d.useEffect(()=>{var t;if(i!=null&&i.length){const s=(t=i==null?void 0:i.find)==null?void 0:t.call(i,r=>r._id===R.branch);s!=null&&s._id&&z(s)}},[i]),d.useEffect(()=>{if(n){let t=!0;for(const s in n)for(const r in n[s])if(n[s][r].write===!1){t=!1;break}y(t)}},[n]);const V=d.useCallback(()=>{H("/users/usersList")},[H]);d.useEffect(()=>{S(se()).then(({payload:t={}})=>{const{message:s}=(t==null?void 0:t.data)||{};s?h(s):(G(t==null?void 0:t.data),h(""))}).catch(()=>{h("Something went wrong! Please try later or contact Administrator.")})},[]),d.useEffect(()=>{_&&S(ie(_==null?void 0:_._id)).then(({payload:t={}})=>{var r,m,E,o;const{message:s}=(t==null?void 0:t.data)||{};s?h(s):(h(""),((m=(r=R.type)==null?void 0:r.toLowerCase)==null?void 0:m.call(r))==="superadmin"?v(t==null?void 0:t.data):v((o=(E=t==null?void 0:t.data)==null?void 0:E.filter)==null?void 0:o.call(E,({id:f})=>R._id!==f)))}).catch(()=>{h("Something went wrong! Please try later or contact Administrator.")})},[_]),d.useEffect(()=>{u?S(me(u==null?void 0:u.id)).then(({payload:t={}})=>{var s,r,m;D({...(t==null?void 0:t.data)||{}}),p((s=t==null?void 0:t.data)==null?void 0:s.permissions),(r=t==null?void 0:t.data)!=null&&r.userBranches?A(((m=t.data)==null?void 0:m.userBranches)||[]):A([])}).catch(()=>{h("Something went wrong! Please try later or contact Administrator.")}):D({})},[u]);const Y=(t,s)=>{z(s),v([])},Z=(t,s)=>{J(s)},$=(t,s)=>{O(s),b(F)},ee=t=>{g.splice(t,1),A([...g])},te=()=>{if(C)if(g.some(({_id:t})=>t===C._id)){let t={};t.branch={invalid:!0,message:"Branch is already selected."},b(t)}else A(t=>[...t,C]),O(null),b(F);else{let t={};t.branch={invalid:!0,message:"Branch is required."},b(t)}},c=(t,s)=>{var r,m,E;if(t.target.name==="Sales/Purchase_Add_FO_No_write"){const o="Sales/Purchase",f="Add_FO_No",L="write";p(U=>{const B={...U};return B[o][f][L]=s,B})}else{const o=t.target.name,f=(r=o.split)==null?void 0:r.call(o,"_")[0],L=(m=o.split)==null?void 0:m.call(o,"_")[1],U=(E=o.split)==null?void 0:E.call(o,"_")[2];p(B=>{const W={...B};return W[f][L][U]=s,W})}},ne=t=>{t.preventDefault();const s={id:u==null?void 0:u.id,permissions:n,userBranches:g.map(({_id:r})=>r)};S(oe(s)).then(({payload:r={}})=>{const{message:m}=(r==null?void 0:r.data)||{};m?h(m):(h(""),V())}).catch(()=>{h("Something went wrong! Please try later or contact Administrator.")})},le=()=>{V()},re=(t,s)=>{y(s),p(s?r=>{for(const m in r)for(const E in r[m])r[m][E].read=!0,r[m][E].write=!0;return r}:r=>{for(const m in r)for(const E in r[m])r[m][E].read=!1,r[m][E].write=!1;return r})},l=(u==null?void 0:u.type)==="User";return e.createElement(e.Fragment,null,Q&&e.createElement(de,null),e.createElement("h1",{className:"pageHead"},"User permissions"),e.createElement("div",{className:"inner-wrap"},T!==""&&e.createElement(he,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(ge,{severity:"error"},T)),e.createElement("form",{className:"frm-bottom-spc",action:"",onSubmit:ne},e.createElement(q,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},i&&(i==null?void 0:i.length)>0&&e.createElement(P,{fullWidth:!0,size:"small"},e.createElement(N,{disablePortal:!0,size:"small",name:"branch",options:i,value:_||null,onChange:Y,getOptionLabel:t=>t.name||"",openOnFocus:!0,renderInput:t=>e.createElement(M,{...t,label:"Branch",fullWidth:!0})}))),e.createElement("div",{className:"grid-item"},i&&(i==null?void 0:i.length)>0&&e.createElement(P,{fullWidth:!0,size:"small"},e.createElement(N,{disablePortal:!0,size:"small",name:"users",options:j,value:u||null,onChange:Z,getOptionLabel:t=>t.username||"",openOnFocus:!0,renderInput:t=>e.createElement(M,{...t,label:"Users",fullWidth:!0})}))),e.createElement("div",{className:"grid-item"},i&&(i==null?void 0:i.length)>0&&e.createElement(P,{fullWidth:!0,size:"small",error:k.branch.invalid},e.createElement(N,{disablePortal:!0,size:"small",name:"branch",options:i,value:C||null,onChange:$,getOptionLabel:t=>t.name||"",openOnFocus:!0,disabled:!u,renderInput:t=>e.createElement(M,{...t,label:"Assign Branch",fullWidth:!0,error:k.branch.invalid})}),k.branch.invalid&&e.createElement(_e,null,k.branch.message))),e.createElement("div",{className:"grid-item"},i&&(i==null?void 0:i.length)>0&&e.createElement(P,{fullWidth:!0,size:"small"},e.createElement(x,{variant:"contained",size:"medium",color:"primary",className:"ml6",style:{width:"max-content"},onClick:te},"Add")))),e.createElement("div",{style:{paddingBottom:"10px"}},g.length?"User assigned Branches":""," "),e.createElement("div",null,e.createElement("table",{className:w.tbl_permissions},e.createElement("tbody",null,g.map(t=>e.createElement("tr",{key:t._id},e.createElement("td",null,t.name),e.createElement("td",null,e.createElement(we,{size:"small",onClick:ee,color:"error"},e.createElement(ue,null))))))))),K.employee&&e.createElement(e.Fragment,null,e.createElement(pe,{sx:{marginBottom:"20px"}}),e.createElement(q,{sx:{padding:"20px",marginBottom:"20px",overflow:"auto"}},e.createElement("div",null,"Select All"," ",e.createElement(a,{name:"selectAll",checked:X,onChange:re})),e.createElement("table",{className:w.tbl_permissions},e.createElement("tbody",null,e.createElement("tr",null,e.createElement("td",{colSpan:10,className:w.head},"Master")),e.createElement("tr",null,e.createElement("td",{width:"10%"},"Branch"),e.createElement("td",{width:"10%"},e.createElement(a,{name:"Admin_Branch_write",disabled:l,checked:l?!1:n.Admin.Branch.write,onChange:c})),e.createElement("td",{width:"10%"},"Place"),e.createElement("td",{width:"10%"},e.createElement(a,{name:"Admin_Place_write",disabled:l,checked:l?!1:n.Admin.Place.write,onChange:c})),e.createElement("td",{width:"10%"},"Article"),e.createElement("td",{width:"10%"},e.createElement(a,{name:"Admin_Article_write",disabled:l,checked:l?!1:n.Admin.Article.write,onChange:c})),e.createElement("td",null,"Employee"),e.createElement("td",null,e.createElement(a,{name:"Admin_Employee_write",disabled:l,checked:l?!1:n.Admin.Employee.write,onChange:c})),e.createElement("td",null,"Driver"),e.createElement("td",null,e.createElement(a,{name:"Admin_Driver_write",disabled:l,checked:l?!1:n.Admin.Driver.write,onChange:c}))),e.createElement("tr",null,e.createElement("td",null,"Customers"),e.createElement("td",null,e.createElement(a,{name:"Admin_Customers_write",disabled:l,checked:l?!1:n.Admin.Customers.write,onChange:c})),e.createElement("td",null,"Supplier"),e.createElement("td",null,e.createElement(a,{name:"Admin_Supplier_write",disabled:l,checked:l?!1:n.Admin.Supplier.write,onChange:c})),e.createElement("td",null,"VehicleType"),e.createElement("td",null,e.createElement(a,{name:"Admin_VehicleType_write",disabled:l,checked:l?!1:n.Admin.VehicleType.write,onChange:c})),e.createElement("td",null,"Vehicle"),e.createElement("td",null,e.createElement(a,{name:"Admin_Vehicle_write",disabled:l,checked:l?!1:n.Admin.Vehicle.write,onChange:c})),e.createElement("td",null,"BankMaster"),e.createElement("td",null,e.createElement(a,{name:"Sales/Purchase_BankMaster_write",disabled:l,checked:l?!1:n["Sales/Purchase"].BankMaster.write,onChange:c}))),e.createElement("tr",null),e.createElement("tr",null,e.createElement("td",null,"BankAccountMaster"),e.createElement("td",null,e.createElement(a,{name:"Sales/Purchase_BankAccountMaster_write",disabled:l,checked:l?!1:n["Sales/Purchase"].BankAccountMaster.write,onChange:c})),e.createElement("td",null,"Rate Master (read)"),e.createElement("td",null,e.createElement(a,{name:"Admin_RateMaster_read",disabled:l,checked:l?!1:n.Admin.RateMaster.read,onChange:c})),e.createElement("td",null,"Rate Master"),e.createElement("td",null,e.createElement(a,{name:"Admin_RateMaster_write",disabled:l,checked:l?!1:n.Admin.RateMaster.write,onChange:c})),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null)),e.createElement("tr",null,e.createElement("td",{colSpan:10,className:w.head},"Transactions")),e.createElement("tr",null,e.createElement("td",null,"LorryReceipt"),e.createElement("td",null,e.createElement(a,{name:"Sales/Purchase_LorryReceipt_write",checked:n["Sales/Purchase"].LorryReceipt.write,onChange:c})),e.createElement("td",null,"LorryReceiptReg"),e.createElement("td",null,e.createElement(a,{name:"Sales/Purchase_LorryReceiptReg_write",checked:n["Sales/Purchase"].LorryReceiptReg.write,onChange:c})),e.createElement("td",null,"Add_FO_No"),e.createElement("td",null,e.createElement(a,{name:"Sales/Purchase_Add_FO_No_write",checked:n["Sales/Purchase"].Add_FO_No.write,onChange:c})),e.createElement("td",null,"LorryFreightChallan"),e.createElement("td",null,e.createElement(a,{name:"Sales/Purchase_LoadingSlip_write",checked:n["Sales/Purchase"].LoadingSlip.write,onChange:c})),e.createElement("td",null,"LorryFreightChallanReg"),e.createElement("td",null,e.createElement(a,{name:"Sales/Purchase_LoadingSlipRegister_write",checked:n["Sales/Purchase"].LoadingSlipRegister.write,onChange:c}))),e.createElement("tr",null,e.createElement("td",null,"LRAcknowledge"),e.createElement("td",null,e.createElement(a,{name:"Sales/Purchase_LRAcknowledge_write",checked:n["Sales/Purchase"].LRAcknowledge.write,onChange:c})),e.createElement("td",null,"BillList"),e.createElement("td",null,e.createElement(a,{name:"Accounts_RouteBill_write",checked:n.Accounts.RouteBill.write,onChange:c})),e.createElement("td",null,"BillRegister"),e.createElement("td",null,e.createElement(a,{name:"Accounts_BillRegister_write",checked:n.Accounts.BillRegister.write,onChange:c})),e.createElement("td",null,"PaymentCollection"),e.createElement("td",null,e.createElement(a,{name:"Accounts_PaymentCollection_write",checked:n.Accounts.PaymentCollection.write,onChange:c})),e.createElement("td",null,"PaymentAdvice"),e.createElement("td",null,e.createElement(a,{name:"Sales/Purchase_PaymentAdvice_write",checked:n["Sales/Purchase"].PaymentAdvice.write,onChange:c}))),e.createElement("tr",null,e.createElement("td",{width:"10%"},"MoneyTransfer"),e.createElement("td",{width:"10%"},e.createElement(a,{name:"Admin_MoneyTransfer_write",checked:n.Admin.MoneyTransfer.write,onChange:c})),e.createElement("td",null,"Quotation"),e.createElement("td",null,e.createElement(a,{name:"Sales/Purchase_TripSheet_write",checked:n["Sales/Purchase"].TripSheet.write,onChange:c})),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null)),e.createElement("tr",null,e.createElement("td",{colSpan:10,className:w.head},"Reports")),e.createElement("tr",null,e.createElement("td",null,"BilledLRStatus"),e.createElement("td",null,e.createElement(a,{name:"Accounts_BilledLRStatus_write",checked:n.Accounts.BilledLRStatus.write,onChange:c})),e.createElement("td",null,"LoadingTripsheet"),e.createElement("td",null,e.createElement(a,{name:"Accounts_LoadingSlip_write",checked:n.Accounts.LoadingSlip.write,onChange:c})),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null),e.createElement("td",null)),e.createElement("tr",null,e.createElement("td",{colSpan:10,className:w.head},"User")),e.createElement("tr",null,e.createElement("td",null,"UserList"),e.createElement("td",null,e.createElement(a,{name:"User_UserActivation_write",disabled:l,checked:l?!1:n.User.UserActivation.write,onChange:c})),e.createElement("td",null,"RoleMaster"),e.createElement("td",null,e.createElement(a,{name:"User_RoleMaster_write",disabled:l,checked:l?!1:n.User.RoleMaster.write,onChange:c})),e.createElement("td",null,"ChangePassword"),e.createElement("td",null,e.createElement(a,{name:"User_ChangePassword_write",disabled:l,checked:l?!1:n.User.ChangePassword.write,onChange:c})),e.createElement("td",null,"UserRegister"),e.createElement("td",null,e.createElement(a,{name:"User_UserRegister_write",disabled:l,checked:l?!1:n.User.UserRegister.write,onChange:c})),e.createElement("td",null),e.createElement("td",null)))),e.createElement("div",{className:"right userpButtons"},e.createElement(x,{variant:"outlined",size:"medium",onClick:le},"Cancel"),e.createElement(x,{variant:"contained",size:"medium",type:"submit",color:"primary",className:"ml6"},"Save")))))))};export{Ze as default};
