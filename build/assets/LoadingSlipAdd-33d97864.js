import{r as h,a as e}from"./react-69b9bddd.js";import{u as te,a as he}from"./react-redux-13959126.js";import{L as ae,A as re,D as ve,T as oe}from"./x-date-pickers-f3802fc3.js";import"./Card.module-3bdbfb7f.js";import{bm as ge,k as fe,bx as Ee,L as be,P as ce,an as ne,by as pe,bs as Ne,b5 as we}from"./index-1d9d8716.js";import{F as Ce,g as Fe,v as K,h as v,a0 as Oe,l as $,D as ue,O as xe,Q as Se,a as le,i as p,A as V,V as F}from"./material-04052d9a.js";import{D as ke}from"./x-data-grid-83fc2422.js";import{b as de,a as Pe}from"./react-router-7dadf37a.js";import"./@babel-5e587562.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-20ba4de3.js";import"./@date-io-28dabb9c.js";import"./dayjs-39ab3f8d.js";import"./utils-49fe0532.js";import"./clsx-1229b3e0.js";import"./base-e8cfb5a9.js";import"./@popperjs-f3391c26.js";import"./rifm-bf33b601.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./stylis-79144faa.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./icons-material-40f8e5d8.js";import"./react-icons-6bc9af43.js";import"./prop-types-b6d0a120.js";import"./reselect-36a88051.js";const Le=({loadingSlip:X,setLoadingSlip:S,lorryReceipts:L})=>{var D,A;const j=[{field:"_id",headerName:"Id"},{field:"lrNo",headerName:"LR no.",flex:1},{field:"consignorName",headerName:"Consignor",flex:1},{field:"from",headerName:"From",flex:1},{field:"consigneeName",headerName:"Consignee",flex:1},{field:"to",headerName:"To",flex:1},{field:"weight",headerName:"Weight",flex:1},{field:"total",headerName:"To pay",flex:1,type:"number",renderCell:i=>{var o,s,c;return((o=i.row.payType)==null?void 0:o.toLowerCase())==="topay"?e.createElement("strong",null,"₹ ",(c=(s=Number(i.row.total))==null?void 0:s.toFixed)==null?void 0:c.call(s,2)):"-"}}],[d,b]=h.useState([]),[U,Z]=h.useState([]),[ee,_]=h.useState([]),[l,g]=h.useState(""),[r,y]=h.useState(0);h.useEffect(()=>{var i;if(L!=null&&L.length){const o=[...L];(i=o==null?void 0:o.forEach)==null||i.call(o,s=>{var N,m;let c=0;(m=(N=s.transactions)==null?void 0:N.forEach)==null||m.call(N,w=>{c+=+w.weight}),s.weight=c,s.checked=!1,s.show=!0}),b(o)}},[L]);const H=(i,o)=>{const s=[...d];s[o]={...s[o],checked:i.target.checked},i.target.checked?_(c=>[...c,s[o]]):_(c=>c.filter(({_id:N})=>s[o]._id!==N)),b([...s])};h.useEffect(()=>{S(i=>({...i,lrList:[...U]}))},[U,S]);const x=i=>{var N;i.preventDefault();let o=0;const s=d.find(m=>{var w;return(l==null?void 0:l.toLowerCase())===((w=m.lrNo)==null?void 0:w.toLowerCase())});let c=[...ee];s&&!c.some(m=>m.lrNo===s.lrNo)&&(_(m=>[...m,s]),c=[...c,s]),Z((N=c==null?void 0:c.filter)==null?void 0:N.call(c,m=>{var w,f;return(m.checked||(l==null?void 0:l.toLowerCase())===((w=m.lrNo)==null?void 0:w.toLowerCase()))&&(m.checked=!0,o+=((f=m.payType)==null?void 0:f.toLowerCase())==="topay"?m.total:0),m.checked})),y(o),S(m=>({...m,totalFreight:o}))},z=i=>{var s,c,N,m;const o=i.target.value?(m=(N=(c=(s=i.target.value)==null?void 0:s.trim)==null?void 0:c.call(s))==null?void 0:N.toLowerCase)==null?void 0:m.call(N):i.target.value;g(o),b(o?w=>{var T;const f=w;return(T=f==null?void 0:f.forEach)==null||T.call(f,M=>{var W,k,I,G;M.show=(G=(k=(W=M.lrNo)==null?void 0:W.toLowerCase)==null?void 0:(I=k.call(W)).includes)==null?void 0:G.call(I,o)}),f}:w=>{var T;const f=w;return(T=f==null?void 0:f.forEach)==null||T.call(f,M=>{M.show=!0}),f})};let q=0,B=0;const Q=(d==null?void 0:d.length)>0&&((D=d==null?void 0:d.map)==null?void 0:D.call(d,(i,o)=>(i.show&&(q+=1),i.checked&&i.show&&(B+=1),i.show?e.createElement(Ce,{className:"groupCheckbox",key:i.lrNo,control:e.createElement(Fe,{name:i._id,size:"small",checked:i.checked,onChange:s=>H(s,o)}),label:e.createElement("span",{style:{fontSize:"0.9em",display:"inline-block",lineHeight:"1em"}},i.lrNo)}):null)));return e.createElement(e.Fragment,null,e.createElement("form",{action:"",onSubmit:x,id:"lrSelectionForm"},e.createElement(K,{container:!0,spacing:2},e.createElement(K,{item:!0,xs:2},e.createElement("h2",{className:"mb20 text-inline"},"Lorry receipts")),(d==null?void 0:d.length)>0&&e.createElement(K,{item:!0,xs:3},e.createElement(v,{size:"small",variant:"outlined",label:"Filter LR",value:l,fullWidth:!0,onChange:z,name:"search",id:"search"})),e.createElement(K,{item:!0,xs:3},e.createElement("h4",{className:" text-inline",style:{paddingTop:"5px"}},q," Out of ",B," selected"))),e.createElement("div",{className:"bl_lrCheckboxes"},e.createElement(Oe,{className:"checkboxGroup"},Q,(d==null?void 0:d.length)===0&&e.createElement("p",null,"No lorry receipts for challan"))),e.createElement("div",{className:"right"},e.createElement($,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"lrSelectionForm",className:"ml6"},"Add"))),e.createElement(ue,{sx:{margin:"20px 0"}}),e.createElement("div",{style:{width:"100%"}},e.createElement(ke,{sx:{backgroundColor:"primary.contrastText"},autoHeight:!0,density:"compact",getRowId:i=>i._id,rows:X.lrList,columns:j,initialState:{...j,columns:{columnVisibilityModel:{_id:!1}}},pageSize:10,rowsPerPageOptions:[10],disableSelectionOnClick:!0}),e.createElement("div",{style:{textAlign:"end",paddingTop:"10px",paddingRight:"10px"}},e.createElement("p",null,"Total To Pay: ",e.createElement("strong",null," ₹ ",(A=r==null?void 0:r.toFixed)==null?void 0:A.call(r,2))))))},ze=h.memo(Le),R={branch:"",date:new Date,vehicle:null,vehicleNo:"",vehicleOwner:"",vehicleOwnerAddress:"",vehicleOwnerPhone:"",driver:null,driverName:"",licenseNo:"",phone:"",from:null,fromName:null,to:null,toName:null,lrList:[],totalFreight:"",rent:"",advance:"",totalPayable:"",totalWeight:"",currentTime:new Date,reachTime:null,paybleAt:null,remark:""},Y={branch:{invalid:!1,message:""},date:{invalid:!1,message:""},vehicle:{invalid:!1,message:""},vehicleOwner:{invalid:!1,message:""},vehicleOwnerAddress:{invalid:!1,message:""},vehicleOwnerPhone:{invalid:!1,message:""},driver:{invalid:!1,message:""},licenseNo:{invalid:!1,message:""},phone:{invalid:!1,message:""},from:{invalid:!1,message:""},to:{invalid:!1,message:""},lrList:{invalid:!1,message:""},totalFreight:{invalid:!1,message:""},rent:{invalid:!1,message:""},advance:{invalid:!1,message:""}},ft=()=>{var I,G,J,ie;const X=te(ge),S=te(t=>t.user),{branches:L,vehicles:j,suppliers:d,places:b,drivers:U}=te(({loadingslip:t})=>t)||{},{state:Z}=de(),[ee,_]=h.useState([]),[l,g]=h.useState({...R,branch:Z}),[r,y]=h.useState(Y),[H,x]=h.useState(""),[z,q]=h.useState(!1),[B,Q]=h.useState(1),D=he(),A=Pe(),i=de(),o=h.useCallback(()=>{A("/transactions/loadingSlips")},[A]),s=h.useCallback(()=>{A("/transactions/localMemoList")},[A]);h.useEffect(()=>{var t;i.pathname&&((t=i.pathname)!=null&&t.endsWith("addLocalMemoLS")?q(!0):q(!1))},[i.pathname]),h.useEffect(()=>{if(l.branch){const t=fe()?"":S.userBranches||[];D(Ee({branch:t,page:B})).then(({payload:a={}})=>{const{message:u}=(a==null?void 0:a.data)||{};if(u)x(u);else{const{lorryReceipts:O,isLastPage:E}=(a==null?void 0:a.data)||{};_(P=>[...B!==1?P:[],...O]),E||Q(P=>P+1)}}).catch(()=>{x("Something went wrong! Please try later or contact Administrator.")})}},[B]),h.useEffect(()=>{const t=Object.keys(r);if(t!=null&&t.length){const a=document.querySelector(`input[name=${t[0]}]`);a==null||a.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[r]),h.useEffect(()=>{if(H){const t=document.getElementById("alertError");t==null||t.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[H]);const c=()=>{g(R),x(""),y(Y)},N=()=>{z?s():o()},m=t=>{const a=t.target.name,u=t.target.value;a==="branch"&&(_(()=>[]),Q(1)),g(O=>({...O,[a]:u}))},w=(t,a)=>{var u;if(t.preventDefault(),!T(l)){const O={...l,branch:(u=l.branch)==null?void 0:u._id};z?O.isLocalMemo=!0:O.isLocalMemo=!1,D(pe(O)).then(({payload:E={}})=>{const{message:P}=(E==null?void 0:E.data)||{};P?x(P):a?E!=null&&E.data._id&&D(Ne({id:E==null?void 0:E.data._id,email:""})).then(({payload:n={}})=>{const{message:C}=(n==null?void 0:n.data)||{};if(C)x(C);else if(n!=null&&n.data.file){const se=we(n==null?void 0:n.data.file);if(se){const me=window.open(se,"_blank");me.focus(),me.print(),x(""),y(Y),g(R),z?s():o()}}}).catch(n=>{x(n.message)}):(x(""),y(Y),g(R),z?s():o())}).catch(E=>{x(E.message)})}},f=t=>{t.preventDefault(),w(t,!0)},T=t=>{var O;const a={...Y};t.branch||(a.branch={invalid:!0,message:"Branch is required"}),t.date||(a.date={invalid:!0,message:"Date is required"}),t.vehicle||(a.vehicle={invalid:!0,message:"Vehicle is required"}),t.driver||(a.driver={invalid:!0,message:"Driver name is required"}),t.from||(a.from={invalid:!0,message:"From is required"}),t.to||(a.to={invalid:!0,message:"To is required"}),(O=t.lrList)!=null&&O.length||(a.lrList={invalid:!0,message:"At least one lorry receipt is required"}),(t.totalFreight<0||!t.totalFreight)&&(a.totalFreight={invalid:!0,message:"Total freight is invalid"}),(t.rent<0||!t.rent)&&(a.rent={invalid:!0,message:"Rent is invalid"}),(t.advance<0||!t.advance)&&(a.advance={invalid:!0,message:"Advance is invalid"});let u=!1;for(const E in a)a[E].invalid===!0&&(u=!0);return u&&y(a),u},M=(t,a)=>{g(u=>({...u,[t]:new Date(a)}))},W=(t,a)=>{g(u=>({...u,[t]:new Date(a)}))},k=(t,a,u)=>{var O,E,P;if(g(n=>({...n,[u]:a})),u==="vehicle")if(a&&a._id){const n=(O=d==null?void 0:d.find)==null?void 0:O.call(d,C=>C._id===a.owner||C.name===a.ownerName);g(C=>({...C,vehicleNo:a==null?void 0:a.vehicleNo,vehicleOwner:n==null?void 0:n.name,vehicleOwnerAddress:`${(n==null?void 0:n.address)||""}, ${(n==null?void 0:n.city)||""}`,vehicleOwnerPhone:n==null?void 0:n.phone}))}else g(n=>({...n,vehicleNo:"",vehicleOwner:"",vehicleOwnerAddress:"",vehicleOwnerPhone:""}));if(u==="driver"&&(a&&a._id?g(n=>({...n,driverName:a.name,licenseNo:a.licenseNo,phone:a.telephone})):g(n=>({...n,driverName:"",licenseNo:"",phone:""}))),u==="from")if(a&&a._id){const n=(E=b==null?void 0:b.find)==null?void 0:E.call(b,C=>C._id===a._id);g(C=>({...C,fromName:n.name}))}else g(n=>({...n,fromName:""}));if(u==="to")if(a&&a._id){const n=(P=b==null?void 0:b.find)==null?void 0:P.call(b,C=>C._id===a._id);g(C=>({...C,toName:n.name}))}else g(n=>({...n,toName:""}))};return h.useEffect(()=>{const t=+l.totalFreight+ +l.advance-+l.rent;g(a=>({...a,totalPayable:t}))},[l.totalFreight,l.rent,l.advance]),e.createElement(e.Fragment,null,X&&e.createElement(be,null),e.createElement("h1",{className:"pageHead"},z?"Add a local Challan":"Add a Challan"),e.createElement("div",{className:"inner-wrap"},H!==""&&e.createElement(xe,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(Se,{id:"alertError",severity:"error"},H)),e.createElement("form",{action:"",onSubmit:w,id:"loadingSlipForm"},e.createElement(le,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,size:"small",error:r.branch.invalid},e.createElement(V,{disablePortal:!0,size:"small",name:"branch",options:L,value:l.branch||null,onChange:(t,a)=>k(t,a,"branch"),getOptionLabel:t=>t.name,openOnFocus:!0,disabled:S&&S.type&&((G=(I=S.type)==null?void 0:I.toLowerCase)==null?void 0:G.call(I))!=="superadmin"&&((ie=(J=S.type)==null?void 0:J.toLowerCase)==null?void 0:ie.call(J))!=="admin",renderInput:t=>e.createElement(v,{...t,label:"Branch",name:"branch",error:r.branch.invalid,fullWidth:!0})}),r.branch.invalid&&e.createElement(F,null,r.branch.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,error:r.date.invalid},e.createElement(ae,{dateAdapter:re},e.createElement(ve,{error:r.date.invalid,label:"Date",inputFormat:"DD/MM/YYYY",value:l.date,onChange:M.bind(null,"date"),renderInput:t=>e.createElement(v,{name:"date",size:"small",...t,error:r.date.invalid})})),r.date.invalid&&e.createElement(F,null,r.date.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,size:"small",error:r.vehicle.invalid},e.createElement(V,{disablePortal:!0,autoSelect:!0,size:"small",name:"vehicle",options:j,value:l.vehicle,onChange:(t,a)=>k(t,a,"vehicle"),openOnFocus:!0,renderInput:t=>e.createElement(v,{...t,label:"Vehicle",error:r.vehicle.invalid,fullWidth:!0}),renderOption:(t,a)=>e.createElement("li",{...t,key:a._id},a.label)}),r.vehicle.invalid&&e.createElement(F,null,r.vehicle.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,error:r.vehicleOwner.invalid},e.createElement(v,{size:"small",variant:"outlined",label:"Vehicle owner",focused:!!r.vehicleOwner.invalid,error:r.vehicleOwner.invalid,value:l.vehicleOwner,onChange:m,name:"vehicleOwner",id:"vehicleOwner"}),r.vehicleOwner.invalid&&e.createElement(F,null,r.vehicleOwner.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,error:r.vehicleOwnerAddress.invalid},e.createElement(v,{size:"small",variant:"outlined",label:"Vehicle owner address",error:r.vehicleOwnerAddress.invalid,value:l.vehicleOwnerAddress,onChange:m,name:"vehicleOwnerAddress",id:"vehicleOwnerAddress"}),r.vehicleOwnerAddress.invalid&&e.createElement(F,null,r.vehicleOwnerAddress.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,error:r.vehicleOwnerPhone.invalid},e.createElement(v,{size:"small",variant:"outlined",label:"Vehicle owner phone",error:r.vehicleOwnerPhone.invalid,value:l.vehicleOwnerPhone,onChange:m,onInput:ce,name:"vehicleOwnerPhone",id:"vehicleOwnerPhone"}),r.vehicleOwnerPhone.invalid&&e.createElement(F,null,r.vehicleOwnerPhone.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,size:"small",error:r.driver.invalid},e.createElement(V,{size:"small",name:"driver",id:"driver",options:U,value:l.driver||null,onChange:(t,a)=>k(t,a,"driver"),renderInput:t=>e.createElement(v,{...t,label:"Driver",error:r.driver.invalid,fullWidth:!0}),renderOption:(t,a)=>e.createElement("li",{...t,key:a._id},a.label)}),r.driver.invalid&&e.createElement(F,null,r.driver.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,error:r.licenseNo.invalid},e.createElement(v,{size:"small",variant:"outlined",label:"License no",value:l.licenseNo,error:r.licenseNo.invalid,onChange:m,name:"licenseNo",id:"licenseNo"}),r.licenseNo.invalid&&e.createElement(F,null,r.licenseNo.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,error:r.phone.invalid},e.createElement(v,{size:"small",variant:"outlined",label:"Telephone",value:l.phone,error:r.phone.invalid,onChange:m,onInput:ce,name:"phone",id:"phone"}),r.phone.invalid&&e.createElement(F,null,r.phone.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,size:"small",error:r.from.invalid},e.createElement(V,{disablePortal:!0,autoSelect:!0,size:"small",name:"from",options:b,value:l.from,onChange:(t,a)=>k(t,a,"from"),openOnFocus:!0,renderInput:t=>e.createElement(v,{...t,label:"From",error:r.from.invalid,fullWidth:!0})}),r.from.invalid&&e.createElement(F,null,r.from.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,size:"small",error:r.to.invalid},e.createElement(V,{disablePortal:!0,autoSelect:!0,size:"small",name:"to",options:b,value:l.to,onChange:(t,a)=>k(t,a,"to"),openOnFocus:!0,renderInput:t=>e.createElement(v,{...t,label:"To",error:r.to.invalid,fullWidth:!0})}),r.to.invalid&&e.createElement(F,null,r.to.message)))))),e.createElement("h2",{className:"mb20"},"Freight details"),r.lrList.invalid&&e.createElement("p",{className:"error"},r.lrList.message),e.createElement(le,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement(ze,{loadingSlip:l,setLoadingSlip:g,lorryReceipts:ee}),e.createElement(ue,{sx:{margin:"20px 0"}}),e.createElement("form",{action:"",onSubmit:w,id:"loadingSlipForm"},e.createElement("h3",{className:"mb20"},"Charges"),e.createElement("div",{className:"grid grid-8-col"},e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,error:r.totalFreight.invalid},e.createElement(v,{size:"small",variant:"outlined",label:"Total freight",value:l.totalFreight||"",error:r.totalFreight.invalid,onChange:m,onInput:ne,name:"totalFreight",id:"totalFreight"}),r.totalFreight.invalid&&e.createElement(F,null,r.totalFreight.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,error:r.rent.invalid},e.createElement(v,{size:"small",variant:"outlined",label:"Rent",value:l.rent||"",error:r.rent.invalid,onChange:m,onInput:ne,name:"rent",id:"rent"}),r.rent.invalid&&e.createElement(F,null,r.rent.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,error:r.advance.invalid},e.createElement(v,{size:"small",variant:"outlined",label:"Advance",value:l.advance||"",onChange:m,onInput:ne,error:r.advance.invalid,name:"advance",id:"advance"}),r.advance.invalid&&e.createElement(F,null,r.advance.message))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0},e.createElement(v,{size:"small",type:"number",variant:"outlined",label:"Total payable",value:l.totalPayable||"",onChange:m,name:"totalPayable",id:"totalPayable",inputProps:{readOnly:!0}})))))),e.createElement(le,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("form",{action:"",onSubmit:w,id:"loadingSlipForm"},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(ae,{dateAdapter:re},e.createElement(oe,{ampmInClock:!0,inputFormat:"hh:mm a",label:"Current time",value:l.currentTime,onChange:W.bind(null,"currentTime"),renderInput:t=>e.createElement(v,{name:"currentTime",size:"small",...t})}))),e.createElement("div",{className:"grid-item"},e.createElement(ae,{dateAdapter:re},e.createElement(oe,{ampmInClock:!0,inputFormat:"hh:mm a",label:"Reach time",value:l.reachTime,onChange:W.bind(null,"reachTime"),renderInput:t=>e.createElement(v,{name:"reachTime",size:"small",...t})}))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0,size:"small"},e.createElement(V,{disablePortal:!0,autoSelect:!0,size:"small",name:"paybleAt",options:L,value:l.paybleAt,onChange:(t,a)=>k(t,a,"paybleAt"),openOnFocus:!0,renderInput:t=>e.createElement(v,{...t,label:"Payable at",fullWidth:!0})}))),e.createElement("div",{className:"grid-item"},e.createElement(p,{fullWidth:!0},e.createElement(v,{size:"small",variant:"outlined",label:"Remark",value:l.remark,onChange:m,name:"remark",id:"remark",inputProps:{maxLength:200}}))))),e.createElement("div",{className:"right"},e.createElement($,{variant:"outlined",size:"medium",onClick:N},"Back"),e.createElement($,{variant:"outlined",size:"medium",onClick:c,className:"ml6"},"Reset"),e.createElement($,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"loadingSlipForm",className:"ml6"},"Save"),e.createElement($,{variant:"contained",size:"medium",type:"button",color:"primary",form:"loadingSlipForm",className:"ml6",onClick:f},"Save & Print")))))};export{ft as default};
