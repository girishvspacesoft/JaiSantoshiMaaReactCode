import{r as s,a as t}from"./react-bfabd40c.js";import{a as oe,u as v}from"./react-redux-45d870ba.js";import{c as le,h as ce,i as me,j as de,e as ue}from"./icons-material-4539f19e.js";import"./Card.module-3bdbfb7f.js";import{C as ge}from"./Dialog-cfe6f9ef.js";import{bi as fe,bj as he,bk as pe,bl as Se,bm as Ee,bn as be,bo as Le,bp as H,b3 as xe,bq as Ce,b4 as we,L as Ne,b5 as ve,br as Fe,a4 as De,bs as _e}from"./index-54d20a5c.js";import{S as Ae}from"./SendEmail-cf5e2403.js";import{a as Ie}from"./react-router-622b2d59.js";import{u as Oe,D as Pe,G as ze}from"./x-data-grid-cceece3f.js";import{j as ke}from"./utils-c03c978f.js";import{i as Be,A as Re,h as G,l as Te,O as Me,Q as je,m as He,f as L}from"./material-e0a59a28.js";import"./@babel-e11bafe1.js";import"./react-dom-b0178e93.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-6cfbf744.js";import"./use-sync-external-store-18921cc2.js";import"./redux-persist-d9cc1560.js";import"./redux-b7ba668d.js";import"./@reduxjs-4d37e7cf.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-4a70c6fc.js";import"./react-router-dom-60901e53.js";import"./@remix-run-d753ad9e.js";import"./react-icons-55b3b9a0.js";import"./system-a1d29c52.js";import"./styled-engine-f3bd09bf.js";import"./@emotion-77835cc8.js";import"./stylis-79144faa.js";import"./private-theming-970ac73c.js";import"./react-transition-group-7ded6f4d.js";import"./dom-helpers-9a525042.js";import"./base-ff50cfe3.js";import"./@popperjs-f3391c26.js";import"./clsx-1229b3e0.js";import"./prop-types-d7fd566a.js";import"./reselect-36a88051.js";const vt=()=>{const F=[{field:"_id",headerName:"Id",flex:1},{field:"lsNo",headerName:"LS no.",flex:1},{field:"date",headerName:"Date",flex:1},{field:"vehicleNo",headerName:"Vehicle no.",width:120,flex:1},{field:"fromName",headerName:"From",flex:1},{field:"toName",headerName:"To",flex:1},{field:"totalFreight",headerName:"Hire amount",flex:1},{field:"totalPayable",headerName:"Balance",flex:1},{field:"actions",headerName:"Action",sortable:!1,minWidth:200,renderCell:e=>{const a=r=>{r.stopPropagation(),R({...e.row,download:!1})},i=r=>{r.stopPropagation(),R({...e.row,download:!0})},n=r=>{r.stopPropagation(),h(!0),p({...e.row})},o=r=>(r.stopPropagation(),re(e.row._id));return t.createElement(t.Fragment,null,t.createElement(L,{size:"small",onClick:i,color:"primary"},t.createElement(ce,null)),t.createElement(L,{size:"small",onClick:a,color:"primary"},t.createElement(me,null)),t.createElement(L,{size:"small",onClick:n,color:"primary"},t.createElement(de,null)),t.createElement(L,{size:"small",onClick:o,color:"primary"},t.createElement(ue,null)))},flex:1}],c=oe(),D=Ie(),V=v(fe),_=v(e=>e.user),[$,q]=s.useState([]),[g,A]=s.useState(null),[,Q]=s.useState([]),[I,m]=s.useState(""),[U,O]=s.useState(!1),[W,J]=s.useState(""),[Ge,P]=s.useState(""),[d,z]=s.useState(null),[K,h]=s.useState(!1),[k,x]=s.useState(!1),[C,X]=s.useState(""),[w,p]=s.useState(null),[Y,B]=s.useState(!1),{search:S}=v(({loadingslip:e})=>e),N=Oe(),[u,Z]=s.useState({page:0,pageSize:100}),[f,y]=s.useState({isLoading:!1,data:[],total:0}),R=e=>{z(e)};s.useEffect(()=>{c(he()).then(({payload:e={}})=>{var i,n,o;const{message:a}=(e==null?void 0:e.data)||{};if(a)m(a);else if(m(""),q(e==null?void 0:e.data),(i=e==null?void 0:e.data)!=null&&i.length){const r=(o=(n=e==null?void 0:e.data)==null?void 0:n.find)==null?void 0:o.call(n,l=>l._id===_.branch);A(r)}}).catch(()=>{m("Something went wrong! Please try later or contact Administrator.")}),c(pe()),c(Se()),c(Ee()),c(be()),c(Le())},[_.branch]);const ee=()=>{const e={branch:g._id,pagination:{limit:u.pageSize?u.pageSize:100,page:u.page+1}};c(Fe(e)).then(({payload:a={}})=>{var n,o;const{message:i}=(a==null?void 0:a.data)||{};if(i)m(i);else{const r=(o=(n=a==null?void 0:a.data.loadingSlips)==null?void 0:n.filter)==null?void 0:o.call(n,l=>{var E,M,b,j;return l.date=De(new Date(l.createdAt)),l.totalFreight=(M=(E=l.totalFreight)==null?void 0:E.toFixed)==null?void 0:M.call(E,2),l.totalPayable=(j=(b=l.totalPayable)==null?void 0:b.toFixed)==null?void 0:j.call(b,2),!l.isLocalMemo});Q(r),y(l=>({...l,isLoading:!1,data:r,total:a==null?void 0:a.data.count}))}}).catch(a=>{m(a.message)})};s.useEffect(()=>{g&&ee()},[g,u.page,u.pageSize]),s.useEffect(()=>{d&&d._id&&c(H({id:d._id,email:""})).then(({payload:e={}})=>{var i;const{message:a}=(e==null?void 0:e.data)||{};if(a)m(a);else{if((i=e==null?void 0:e.data)!=null&&i.file){const n=xe(e==null?void 0:e.data.file),o=Ce(d.lsNo)+".pdf";d.download?we(n,o):window.open(n,"_blank")}z(null)}}).catch(e=>{m(e.message)})},[d]),s.useEffect(()=>{k&&C&&w&&(h(!1),c(H({id:w._id,email:C})).then(({payload:e={}})=>{const{message:a}=(e==null?void 0:e.data)||{};a&&m(a),x(!1),p(null)}).catch(e=>{m(e.message),x(!1),p(null)}))},[k,C,w]);const T=s.useMemo(()=>ke(e=>{var a,i,n;N.current.setQuickFilterValues((n=(i=(a=e.split)==null?void 0:a.call(e," "))==null?void 0:i.filter)==null?void 0:n.call(i,o=>o!==""))},500),[N]);s.useEffect(()=>{var e;S&&((e=f.data)!=null&&e.length)&&(B(!0),T(S),setTimeout(()=>{B(!1)},500))},[f.data]);const te=e=>{T(e.target.value),c(_e(e.target.value))},ae=e=>{x(!0),X(e)},se=(e,a)=>{A(a)},ne=e=>{O(!0),e.target.value==="true"?P(W):(P(""),J("")),O(!1)},ie=()=>{D("/transactions/loadingSlips/addLoadingSlip",{state:g})},re=e=>{D("/transactions/loadingSlips/editLoadingSlip",{state:{lsId:e}})};return t.createElement(t.Fragment,null,(V||Y)&&t.createElement(Ne,null),t.createElement("div",{className:"inner-wrap"},U&&t.createElement(ge,{isOpen:!0,onClose:ne,title:"Are you sure?",content:"Do you want to delete the loading slip?",warning:!0}),t.createElement("div",{className:"page_head"},t.createElement("h1",{className:"pageHead"},"Lorry Freight Challan List"),t.createElement("div",{className:"page_actions"},t.createElement(Be,{size:"small",sx:{width:"230px",marginRight:"5px"}},t.createElement(Re,{disablePortal:!0,size:"small",name:"branch",className:"multi-select",options:$,value:g||null,onChange:se,disabled:!ve(),getOptionLabel:e=>e.name,openOnFocus:!0,renderInput:e=>t.createElement(G,{...e,label:"Select branch",fullWidth:!0})})),t.createElement(Te,{variant:"contained",size:"small",type:"button",color:"primary",className:"ml6",onClick:ie},"Add challan"))),I!==""&&t.createElement(Me,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},t.createElement(je,{severity:"error"},I)),t.createElement("div",{style:{width:"100%"}},t.createElement(Pe,{apiRef:N,autoHeight:!0,density:"compact",rows:f.data,rowCount:f.total,loading:f.isLoading,pageSizeOptions:[100],paginationModel:u,onPaginationModelChange:Z,paginationMode:"server",columns:F,getRowId:e=>e._id,sx:{backgroundColor:"primary.contrastText"},initialState:{...F,columns:{columnVisibilityModel:{_id:!1}}},disableSelectionOnClick:!0,disableColumnFilter:!0,disableColumnSelector:!0,disableDensitySelector:!0,components:{Toolbar:()=>t.createElement(ze,{sx:{gap:"6px",mb:"10px",justifyContent:"end",border:"none"}},t.createElement(G,{variant:"standard",placeholder:"Search...",autoFocus:!!S,onChange:te,value:S,InputProps:{startAdornment:t.createElement(He,{position:"start"},t.createElement(le,null))}}))}})),t.createElement(Ae,{isOpen:K,setIsOpen:h,handleEmailClose:()=>{h(!1),p(null)},handleSendEmail:e=>ae(e),contentBody:""})))};export{vt as default};
