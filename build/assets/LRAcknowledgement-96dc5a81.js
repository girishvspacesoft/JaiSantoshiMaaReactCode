import{r as n,a as t}from"./react-bfabd40c.js";import{a as he,u as F}from"./react-redux-45d870ba.js";import{L as j,A as Q,D as U}from"./x-date-pickers-7b1cc7dd.js";import{b as Ee,k as ve,c as be,l as Se,e as De}from"./icons-material-4539f19e.js";import"./Card.module-3bdbfb7f.js";import{by as xe,bz as Ce,bA as Ae,bB as Ne,a4 as Le,bq as ke,L as Fe,b5 as ze,bC as _e}from"./index-60b53c60.js";import{u as we,D as Ie,G as Pe}from"./x-data-grid-cceece3f.js";import{a as Re}from"./react-router-1b5f20a2.js";import{j as Me}from"./utils-c03c978f.js";import{i as z,A as Te,h as C,l as He,O as ye,Q as Be,a as Oe,V as J,a1 as We,a2 as K,f as _,m as Ye}from"./material-e0a59a28.js";import"./@babel-e11bafe1.js";import"./react-dom-b0178e93.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-6cfbf744.js";import"./use-sync-external-store-18921cc2.js";import"./@date-io-f382d426.js";import"./dayjs-7f45ce31.js";import"./clsx-1229b3e0.js";import"./base-ff50cfe3.js";import"./@popperjs-f3391c26.js";import"./rifm-7b0f12ad.js";import"./system-a1d29c52.js";import"./styled-engine-f3bd09bf.js";import"./@emotion-77835cc8.js";import"./stylis-79144faa.js";import"./private-theming-970ac73c.js";import"./react-transition-group-7ded6f4d.js";import"./dom-helpers-9a525042.js";import"./redux-persist-d9cc1560.js";import"./redux-b7ba668d.js";import"./@reduxjs-4d37e7cf.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-4a70c6fc.js";import"./react-router-dom-4405dfe9.js";import"./@remix-run-d753ad9e.js";import"./react-icons-55b3b9a0.js";import"./prop-types-d7fd566a.js";import"./reselect-36a88051.js";const V={startDate:null,endDate:null,type:""},w={startDate:{invalid:!1,message:""},endDate:{invalid:!1,message:""}},Ft=()=>{const I=[{field:"_id",headerName:"Id"},{field:"lrNo",headerName:"LR no.",flex:1},{field:"lsNo",flex:1,headerName:"LS no."},{field:"",headerName:"Delivered",flex:1,renderCell:e=>e.row.deliveryDate?t.createElement(Se,{color:"success",fontSize:"small"}):""},{field:"deliveryDate",headerName:"Delivered date",flex:1,minWidth:120},{field:"payType",headerName:"Pay mode",maxWidth:100,flex:1},{field:"total",headerName:"Receivable amount",type:"number",minWidth:150,flex:1,renderCell:e=>t.createElement("strong",null,"â‚¹ ",e.row.total)},{field:"actions",headerName:"Action",sortable:!1,maxWidth:70,flex:1,renderCell:e=>{const a=r=>(r.stopPropagation(),oe(e.row._id));return t.createElement(t.Fragment,null,t.createElement(_,{size:"small",onClick:a,color:"primary"},t.createElement(De,null)))}}],A=we(),v=he(),X=F(xe),N=F(e=>e.user),P=Re(),[Z,ee]=n.useState([]),[m,R]=n.useState(null),[l,te]=n.useState([]),[M,d]=n.useState(""),[c,T]=n.useState(w),[f,L]=n.useState(V),[H,u]=n.useState(!0),[ae,k]=n.useState(!1),[re,ne]=n.useState(!0),[se,y]=n.useState(!1),{search:b}=F(({acknowledge:e})=>e),[g,ie]=n.useState({page:0,pageSize:100}),[h,B]=n.useState({isLoading:!1,data:[],total:0});n.useEffect(()=>{v(Ce()).then(({payload:e={}})=>{var r,i;const{message:a}=(e==null?void 0:e.data)||{};if(a)d(a);else if(d(""),ee(e==null?void 0:e.data),N&&N.branch){const E=(i=(r=e==null?void 0:e.data)==null?void 0:r.find)==null?void 0:i.call(r,s=>s._id===N.branch);R(E)}}).catch(()=>{d("Something went wrong! Please try later or contact Administrator.")})},[]),n.useEffect(()=>{if(m!=null&&m._id&&H&&!ae){const e={query:f,branch:m._id,pagination:{limit:g.pageSize?g.pageSize:100,page:g.page+1}};v(Ae(e)).then(({payload:a={}})=>{const{message:r}=(a==null?void 0:a.data)||{};r?d(r):(B(i=>({...i,isLoading:!1,data:[],total:a==null?void 0:a.data.count})),te(a==null?void 0:a.data.lorryReceipts)),u(!1)}).catch(a=>{d(a.message)})}},[re,m,g.page,g.pageSize,H]),n.useEffect(()=>{var e,a;if(l!=null&&l.length){const r=(e=l==null?void 0:l.filter)==null?void 0:e.call(l,s=>s.associatedLS),i=(a=r==null?void 0:r.map)==null?void 0:a.call(r,s=>s.associatedLS),E=[...new Set(i)];v(Ne(E)).then(({payload:s={}})=>{var q;const{message:Y}=(s==null?void 0:s.data)||{};if(Y)d(Y);else{const p=l;(q=p==null?void 0:p.forEach)==null||q.call(p,o=>{var D,G,x,$;const S=(G=(D=s==null?void 0:s.data)==null?void 0:D.find)==null?void 0:G.call(D,fe=>fe._id===o.associatedLS);o.associatedLS=S,o.total=($=(x=o.total)==null?void 0:x.toFixed)==null?void 0:$.call(x,2),o.deliveryDate=o.deliveryDate?Le(o.deliveryDate):"",o.lsNo=ke(S==null?void 0:S.lsNo)}),B(o=>({...o,data:p}))}}).catch(s=>{d(s.message)})}},[l]);const O=n.useMemo(()=>Me(e=>{var a,r,i;A.current.setQuickFilterValues((i=(r=(a=e.split)==null?void 0:a.call(e," "))==null?void 0:r.filter)==null?void 0:i.call(r,E=>E!==""))},500),[A]);n.useEffect(()=>{var e;b&&((e=h.data)!=null&&e.length)&&(y(!0),O(b),setTimeout(()=>{y(!1)},500))},[h.data]);const le=e=>{O(e.target.value),v(_e(e.target.value))},oe=e=>{P("/transactions/lrAcknowledgement/editLRAcknowledgement",{state:{lrId:e}})},me=(e,a)=>{R(a),u(!0)},ce=e=>{e.preventDefault(),T(()=>ue(f)),u(!0)},W=(e,a)=>{L(r=>({...r,[e]:new Date(a)})),u(!1)},de=e=>{const a=e.target.name,r=e.target.value;L(i=>({...i,[a]:r}))},ue=e=>{const a={...w};e.startDate||(a.startDate={invalid:!0,message:"Start date is required"}),e.endDate||(a.endDate={invalid:!0,message:"End date is required"});let r=!1;for(const i in a)a[i].invalid===!0&&(r=!0);return k(!!r),a},ge=()=>{k(!1),T(w),u(!0),L(V),ne(!0)},pe=()=>{P("/transactions/lrAcknowledgement/addLRAcknowledgement",{state:m==null?void 0:m._id})};return t.createElement(t.Fragment,null,(X||se)&&t.createElement(Fe,null),t.createElement("div",{className:"inner-wrap"},t.createElement("div",{className:"page_head"},t.createElement("h1",{className:"pageHead"},"LR acknowledgements"),t.createElement("div",{className:"page_actions"},t.createElement(z,{size:"small",sx:{width:"210px",marginRight:"5px",marginTop:"5px"}},t.createElement(Te,{disablePortal:!0,size:"small",name:"branch",className:"multi-select",options:Z,value:m,onChange:me,disabled:!ze(),getOptionLabel:e=>e.name,openOnFocus:!0,renderInput:e=>t.createElement(C,{...e,label:"Select branch",fullWidth:!0})})),t.createElement(He,{style:{marginTop:"5px"},variant:"contained",size:"medium",type:"button",color:"primary",className:"ml6",onClick:pe},"Add acknowledgement"))),M!==""&&t.createElement(ye,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},t.createElement(Be,{severity:"error"},M)),t.createElement(Oe,{sx:{padding:"20px",marginBottom:"20px"}},t.createElement("h2",{style:{marginBottom:"10px"}},"Search"),t.createElement("form",{action:"",onSubmit:ce},t.createElement("div",{className:"grid grid-6-col"},t.createElement("div",{className:"grid-item"},t.createElement(z,{fullWidth:!0,error:c.startDate.invalid},t.createElement(j,{dateAdapter:Q},t.createElement(U,{label:"Start date",inputFormat:"DD/MM/YYYY",value:f.startDate,disableFuture:!0,disableMaskedInput:!0,onChange:W.bind(null,"startDate"),inputProps:{readOnly:!0},renderInput:e=>t.createElement(C,{name:"date",size:"small",...e,error:c.startDate.invalid})})),c.startDate.invalid&&t.createElement(J,null,c.startDate.message))),t.createElement("div",{className:"grid-item"},t.createElement(z,{fullWidth:!0,error:c.endDate.invalid},t.createElement(j,{dateAdapter:Q},t.createElement(U,{label:"End date",inputFormat:"DD/MM/YYYY",value:f.endDate,disableMaskedInput:!0,onChange:W.bind(null,"endDate"),inputProps:{readOnly:!0},renderInput:e=>t.createElement(C,{name:"date",size:"small",...e,error:c.endDate.invalid})})),c.endDate.invalid&&t.createElement(J,null,c.endDate.message))),t.createElement("div",{className:"grid-item"},t.createElement(We,{sx:{alignItems:"center"},color:"primary",name:"type",value:f.type,size:"small",exclusive:!0,onChange:de,style:{width:"100%"}},t.createElement(K,{style:{width:"50%"},name:"type",value:"delivered"},"Delivered"),t.createElement(K,{style:{width:"50%"},name:"type",value:"undelivered"},"Undelivered"))),t.createElement("div",{className:"grid-item"},t.createElement(_,{size:"small",variant:"contained",color:"primary",type:"submit",style:{backgroundColor:"#274d62",marginLeft:"5px"}},t.createElement(Ee,{style:{color:"#ffffff",verticalAlign:"middle"}})),t.createElement(_,{size:"small",variant:"contained",color:"primary",type:"button",onClick:ge,style:{backgroundColor:"#274d62",marginLeft:"5px"}},t.createElement(ve,{style:{color:"#ffffff",verticalAlign:"middle"}})))))),t.createElement(Ie,{apiRef:A,autoHeight:!0,density:"compact",rows:h.data,rowCount:h.total,loading:h.isLoading,pageSizeOptions:[100],paginationModel:g,onPaginationModelChange:e=>{ie(e),u(!0)},paginationMode:"server",columns:I,getRowId:e=>e._id,sx:{backgroundColor:"primary.contrastText"},initialState:{...I,columns:{columnVisibilityModel:{_id:!1}}},components:{Toolbar:()=>t.createElement(Pe,{sx:{gap:"6px",mb:"10px",justifyContent:"end",border:"none"}},t.createElement(C,{variant:"standard",placeholder:"Search...",autoFocus:!!b,onChange:le,value:b,InputProps:{startAdornment:t.createElement(Ye,{position:"start"},t.createElement(be,null))}}))},disableSelectionOnClick:!0,disableColumnFilter:!0,disableColumnSelector:!0,disableDensitySelector:!0})))};export{Ft as default};
