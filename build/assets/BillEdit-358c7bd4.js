import{r as c,a as e}from"./react-69b9bddd.js";import{u as H,a as ce}from"./react-redux-13959126.js";import{L as ue,A as ge,D as de}from"./x-date-pickers-f3802fc3.js";import{L as he}from"./LorryReceipts-d98cf9e4.js";import"./Card.module-3bdbfb7f.js";import{bR as fe,b$ as ve,L as Ee,an as G,bY as be,c0 as pe,bU as Fe,b5 as Pe,b_ as Ce,bT as Le}from"./index-c349c545.js";import{F as Se}from"./file-saver-259f058c.js";import{a as xe,b as Ne}from"./react-router-7dadf37a.js";import{O as Be,Q as ke,a as $,i as h,A as Q,h as f,V as C,D as Ae,m as F,l as I}from"./material-04052d9a.js";import"./@babel-5e587562.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-20ba4de3.js";import"./@date-io-28dabb9c.js";import"./dayjs-39ab3f8d.js";import"./utils-49fe0532.js";import"./clsx-1229b3e0.js";import"./base-e8cfb5a9.js";import"./@popperjs-f3391c26.js";import"./rifm-bf33b601.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./stylis-79144faa.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./x-data-grid-83fc2422.js";import"./prop-types-b6d0a120.js";import"./reselect-36a88051.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./icons-material-40f8e5d8.js";import"./react-icons-6bc9af43.js";const N={branch:"",date:new Date,from:"",to:"",customer:"",lrList:[],totalFreight:"",freight:"",localFreight:"",cgst:"",cgstPercent:"",sgst:"",sgstPercent:"",total:"",grandTotal:"",remark:""},B={branch:{invalid:!1,message:""},date:{invalid:!1,message:""},customer:{invalid:!1,message:""},lrList:{invalid:!1,message:""},totalFreight:{invalid:!1,message:""},freight:{invalid:!1,message:""},localFreight:{invalid:!1,message:""},cgstPercent:{invalid:!1,message:""},sgstPercent:{invalid:!1,message:""}},bt=()=>{var j,U,_,V,O,M;const z=H(t=>t.user),J=H(fe),{branches:L,customers:K}=H(({bill:t})=>t)||{},[S,X]=c.useState([]),[p,Z]=c.useState([]),[n,u]=c.useState(N),[Ie,R]=c.useState(N),[s,k]=c.useState(B),[T,g]=c.useState(""),x=ce(),D=xe(),y=Ne(),{billId:P}=y.state,w=c.useCallback(()=>{D("/transactions/billList")},[D]);c.useEffect(()=>{const t=Object.keys(s);if(t!=null&&t.length){const r=document.querySelector(`input[name=${t[0]}]`);r==null||r.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[s]),c.useEffect(()=>{if(T){const t=document.getElementById("alertError");t==null||t.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[T]);const ee=(t,r,i,o)=>{x(be({branch:t,consignor:r,from:i,to:o,billId:P})).then(({payload:m={}})=>{var v;const{message:l}=(m==null?void 0:m.data)||{};if(l)g(l);else{const a=[...(m==null?void 0:m.data)||[]];(v=a==null?void 0:a.forEach)==null||v.call(a,d=>{d.checked=!1}),Z(a)}}).catch(()=>{g("Something went wrong! Please try later or contact Administrator.")})};c.useEffect(()=>{n.branch&&n.customer&&ee(n.branch,n.customer,n.from,n.to)},[(j=n.branch)==null?void 0:j._id,(U=n.customer)==null?void 0:U._id,n.from,n.to]),c.useEffect(()=>{P&&x(ve(P)).then(({payload:t={}})=>{var i;const{message:r}=(t==null?void 0:t.data)||{};if(r)g(r);else{const{data:o}=t||{},m=(i=L==null?void 0:L.find)==null?void 0:i.call(L,l=>l._id===o.branch);R({...o||{},branch:m}),u(()=>({...o||{},branch:m,customer:o.customer,from:o.from,to:o.to}))}}).catch(()=>{g("Something went wrong! Please try later or contact Administrator.")})},[P]),c.useEffect(()=>{var t,r,i,o;if(n._id&&(p!=null&&p.length)){const m={...n},l=(t=p==null?void 0:p.map)==null?void 0:t.call(p,a=>{var E,A;const d=(A=(E=n.lrList)==null?void 0:E.filter)==null?void 0:A.call(E,me=>me._id===a._id);return{...a,checked:!!(d!=null&&d.length)}});let v;P&&(v=(r=l==null?void 0:l.filter)==null?void 0:r.call(l,a=>!a.billGenerated||a.billGenerated&&a.assoBill===P)),m.lrList=(o=(i=m.lrList)==null?void 0:i.map)==null?void 0:o.call(i,a=>{var d;return((d=l==null?void 0:l.filter)==null?void 0:d.call(l,E=>E._id===a._id)[0])||""}),u({...m}),X(v)}},[p,P]),c.useEffect(()=>{const t=+n.totalFreight+ +n.freight+ +n.localFreight,r=t+ +n.sgst+ +n.cgst;u(i=>({...i,total:t,grandTotal:r}))},[n.totalFreight,n.freight,n.localFreight,n.sgst,n.cgst]),c.useEffect(()=>{const t=+n.totalFreight+ +n.freight+ +n.localFreight,r=t*+n.cgstPercent/100,i=t*+n.sgstPercent/100;u(o=>({...o,cgst:r,sgst:i}))},[n.cgstPercent,n.sgstPercent,n.totalFreight,n.freight,n.localFreight]),c.useEffect(()=>{var r,i;const t=(i=(r=n.lrList)==null?void 0:r.reduce)==null?void 0:i.call(r,(o,m)=>o+m.total,0);u(o=>({...o,totalFreight:t}))},[n.lrList]);const te=()=>{u(N),g(""),k(B)},re=()=>{w()},b=t=>{const r=t.target.name,i=t.target.value;u(o=>({...o,[r]:i}))},q=(t,r)=>{u(i=>({...i,[r]:t}))},ne=t=>{var i;const r=(i=t.trim)==null?void 0:i.call(t);((r==null?void 0:r.length)>2||!r)&&x(Le(r))},ae=({target:t})=>{ne(t.value)},W=(t,r,i)=>{var o,m;t.preventDefault(),le(n)||x(pe({...n,branch:(o=n.branch)==null?void 0:o._id,customer:(m=n.customer)==null?void 0:m._id})).then(({payload:l={}})=>{const{message:v}=(l==null?void 0:l.data)||{};v?g(v):r?x(Fe({id:l==null?void 0:l.data._id,email:""})).then(({payload:a={}})=>{const{message:d}=(a==null?void 0:a.data)||{};if(d&&g(d),a!=null&&a.data.file){const E=Pe(a==null?void 0:a.data.file);if(E){const A=window.open(E,"_blank");A.focus(),A.print(),g(""),k(B),u(N),w()}}}).catch(a=>{g(a.message)}):i?x(Ce({id:l==null?void 0:l.data._id,email:""})).then(({payload:a={}})=>{const{message:d}=(a==null?void 0:a.data)||{};if(d)g(d);else{const E=new Blob([a==null?void 0:a.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Se.saveAs(E,"Bill.xlsx"),g(""),k(B),u(N),w()}}).catch(a=>{g(a.message)}):(g(""),k(B),u(N),w())}).catch(l=>{g(l.message)})},ie=t=>{t.preventDefault(),W(t,!0)},se=t=>{t.preventDefault(),W(t,!1,!0)},le=t=>{var o,m,l;const r={...B};t.branch||(r.branch={invalid:!0,message:"Branch is required"}),t.date||(r.date={invalid:!0,message:"Date is required"}),t.customer||(r.customer={invalid:!0,message:"Customer is required"}),(!((o=t.lrList)!=null&&o.length)||!((l=(m=t.lrList||[]).some)!=null&&l.call(m,v=>v)))&&(r.lrList={invalid:!0,message:"At least one lorry receipt is required"}),+t.totalFreight<=0&&(r.totalFreight={invalid:!0,message:"Total freight should be greater than 0"}),+t.freight<0&&(r.freight={invalid:!0,message:"Freight should be 0 or more"}),+t.localFreight<0&&(r.localFreight={invalid:!0,message:"Local freight should be 0 or more"}),+t.cgstPercent<0&&(r.cgstPercent={invalid:!0,message:"CGST % should be 0 or more"}),+t.sgstPercent<0&&(r.sgstPercent={invalid:!0,message:"SGST % should be 0 or more"});let i=!1;for(const v in r)r[v].invalid===!0&&(i=!0);return i&&k(r),i},Y=(t,r)=>{u(i=>({...i,[t]:new Date(r)}))},oe=()=>{var r;const t=(r=S==null?void 0:S.filter)==null?void 0:r.call(S,i=>i.checked);u(i=>({...i,lrList:t}))};return e.createElement(e.Fragment,null,J&&e.createElement(Ee,null),e.createElement("div",{className:"inner-wrap"},e.createElement("h1",{className:"pageHead"},"Edit a bill"),T!==""&&e.createElement(Be,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(ke,{id:"alertError",severity:"error"},T)),e.createElement("form",{action:"",onSubmit:W,id:"billForm"},e.createElement($,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,size:"small",error:s.branch.invalid},e.createElement(Q,{disablePortal:!0,size:"small",name:"branch",options:L,value:n.branch||null,onChange:(t,r)=>q(r,"branch"),getOptionLabel:t=>t.name,openOnFocus:!0,disabled:z&&z.type&&((V=(_=z.type)==null?void 0:_.toLowerCase)==null?void 0:V.call(_))!=="superadmin"&&((M=(O=z.type)==null?void 0:O.toLowerCase)==null?void 0:M.call(O))!=="admin",renderInput:t=>e.createElement(f,{...t,label:"Branch",name:"branch",error:s.branch.invalid,fullWidth:!0})}),s.branch.invalid&&e.createElement(C,null,s.branch.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,size:"small",error:s.customer.invalid},e.createElement(Q,{disablePortal:!0,autoSelect:!0,size:"small",name:"customer",options:K,value:n.customer||null,onChange:(t,r)=>q(r,"customer"),getOptionLabel:t=>t.name,openOnFocus:!0,renderInput:t=>e.createElement(f,{...t,label:"Customer",error:s.customer.invalid,fullWidth:!0,onChange:ae})}),s.customer.invalid&&e.createElement(C,null,s.customer.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:s.date.invalid},e.createElement(ue,{dateAdapter:ge},e.createElement(de,{error:s.date.invalid,label:"Date",inputFormat:"DD/MM/YYYY",value:n.date,disableFuture:!0,onChange:Y.bind(null,"date"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(f,{name:"date",size:"small",...t,error:s.date.invalid})})),s.date.invalid&&e.createElement(C,null,s.date.message)))))),s.lrList.invalid&&e.createElement("p",{className:"error"},s.lrList.message),e.createElement($,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement(he,{lorryReceipts:S,setLRForBill:oe,bill:n,setBill:u,dateInputChangeHandler:Y}),e.createElement(Ae,{sx:{margin:"20px 0"}}),e.createElement("form",{action:"",onSubmit:W,id:"billForm"},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"Total freight",value:n.totalFreight||"",onChange:b,name:"totalFreight",id:"totalFreight",InputProps:{startAdornment:e.createElement(F,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:s.freight.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"Freight",value:n.freight||"",error:s.freight.invalid,onInput:G,onChange:b,name:"freight",id:"freight",InputProps:{startAdornment:e.createElement(F,{position:"start"},"â‚¹"),maxLength:15}}),s.freight.invalid&&e.createElement(C,null,s.freight.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:s.localFreight.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"Local freight",value:n.localFreight||"",error:s.localFreight.invalid,onChange:b,onInput:G,name:"localFreight",id:"localFreight",InputProps:{startAdornment:e.createElement(F,{position:"start"},"â‚¹"),maxLength:15}}),s.localFreight.invalid&&e.createElement(C,null,s.localFreight.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:s.cgstPercent.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"CGST %",value:n.cgstPercent||"",error:s.cgstPercent.invalid,onChange:b,onInput:G,name:"cgstPercent",id:"cgstPercent",InputProps:{endAdornment:e.createElement(F,{position:"end"},"%"),maxLength:15}}),s.cgstPercent.invalid&&e.createElement(C,null,s.cgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"CGST",value:n.cgst||"",onChange:b,name:"cgst",id:"cgst",InputProps:{startAdornment:e.createElement(F,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:s.sgstPercent.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"SGST %",value:n.sgstPercent||"",error:s.sgstPercent.invalid,onChange:b,onInput:G,name:"sgstPercent",id:"sgstPercent",InputProps:{endAdornment:e.createElement(F,{position:"end"},"%"),maxLength:15}}),s.sgstPercent.invalid&&e.createElement(C,null,s.sgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"SGST",value:n.sgst||"",onChange:b,name:"sgst",id:"sgst",InputProps:{startAdornment:e.createElement(F,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"Total",value:n.total||"",onChange:b,name:"total",id:"total",InputProps:{startAdornment:e.createElement(F,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"Grand total",value:n.grandTotal||"",onChange:b,name:"grandTotal",id:"grandTotal",InputProps:{startAdornment:e.createElement(F,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",variant:"outlined",label:"Remark",value:n.remark,onChange:b,name:"remark",id:"remark",inputProps:{maxLength:200}}))))),e.createElement("div",{className:"right"},e.createElement(I,{variant:"outlined",size:"medium",onClick:re},"Back"),e.createElement(I,{variant:"outlined",size:"medium",onClick:te,className:"ml6"},"Reset"),e.createElement(I,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"billForm",className:"ml6"},"Save"),e.createElement(I,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:ie},"Save & Print")," ",e.createElement(I,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:se},"export to excel sheet")))))};export{bt as default};
