import{r as c,a as i}from"./react-69b9bddd.js";import{L as G,A as J,D as Q}from"./x-date-pickers-f3802fc3.js";import"./Card.module-3bdbfb7f.js";import{bC as V,bK as X,L as Z,bJ as $,bI as h}from"./index-c349c545.js";import{u as ee,a as te}from"./react-redux-13959126.js";import{B as re}from"./react-barcode-reader-438f2175.js";import{b as ie,a as ae}from"./react-router-7dadf37a.js";import{O as ne,Q as oe,a as se,i as D,A as me,h as L,V as F,l as C}from"./material-04052d9a.js";import"./@babel-5e587562.js";import"./@date-io-28dabb9c.js";import"./dayjs-39ab3f8d.js";import"./utils-49fe0532.js";import"./clsx-1229b3e0.js";import"./base-e8cfb5a9.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./@popperjs-f3391c26.js";import"./rifm-bf33b601.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./stylis-79144faa.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./icons-material-40f8e5d8.js";import"./react-icons-6bc9af43.js";import"./use-sync-external-store-20ba4de3.js";import"./prop-types-b6d0a120.js";const R={lrNo:null,deliveryDate:new Date},k={lrNo:{invalid:!1,message:""},deliveryDate:{invalid:!1,message:""}},Ge=()=>{const b=ee(V),{state:S}=ie(),[v,g]=c.useState(R),[s,H]=c.useState([]),[l,A]=c.useState(k),[w,d]=c.useState(""),[x,P]=c.useState(!0),[B,N]=c.useState(""),_=ae(),f=te(),I=c.useRef(null),O=c.useCallback(()=>{_("/transactions/lrAcknowledgement")},[_]);c.useEffect(()=>{if(x){let t={};S&&(t={branch:S}),f(X(t)).then(({payload:e={}})=>{var r,n;const{message:a}=(e==null?void 0:e.data)||{};if(a)d(a);else{const o=(n=(r=e==null?void 0:e.data)==null?void 0:r.map)==null?void 0:n.call(r,m=>({...m,label:m.lrNo,value:m.lrNo}));H(o),P(!1)}}).catch(e=>{d(e.message)})}},[x]);const W=()=>{O()},Y=t=>{if(t.preventDefault(),!K(v)){const e={_id:v.lrNo._id,deliveryDate:v.deliveryDate};f($(e)).then(({payload:a={}})=>{const{message:r}=(a==null?void 0:a.data)||{};r?d(r):(d(""),A(k),g(R),N(""),P(!0))}).catch(a=>{d(a.message)})}},q=(t,e)=>{var r;const a=(r=s==null?void 0:s.find)==null?void 0:r.call(s,({label:n})=>{var o,m,E,u,p,z;return((E=(m=(o=e==null?void 0:e.toLowerCase)==null?void 0:o.call(e))==null?void 0:m.trim)==null?void 0:E.call(m))===((z=(p=(u=n==null?void 0:n.toLowerCase)==null?void 0:u.call(n))==null?void 0:p.trim)==null?void 0:z.call(p))});a&&(v.isPrevented||(t.preventDefault(),t.stopPropagation()),g(n=>({...n,lrNo:a,isPrevented:!0})),a._id&&f(h(a._id)).then(({payload:n={}})=>{var o;N(((o=n==null?void 0:n.data)==null?void 0:o.lsNo)||"")}).catch(n=>{d(n.message)}))},T=t=>{console==null||console.err(t)},U=t=>{var e;if(t){const a=(e=s==null?void 0:s.find)==null?void 0:e.call(s,({label:r})=>{var n,o,m,E,u,p;return((m=(o=(n=t==null?void 0:t.toLowerCase)==null?void 0:n.call(t))==null?void 0:o.trim)==null?void 0:m.call(o))===((p=(u=(E=r==null?void 0:r.toLowerCase)==null?void 0:E.call(r))==null?void 0:u.trim)==null?void 0:p.call(u))});a._id&&f(h(a._id)).then(({payload:r={}})=>{var n;N(((n=r==null?void 0:r.data)==null?void 0:n.lsNo)||""),g(o=>({...o,lrNo:a}))}).catch(r=>{d(r.message)})}},K=t=>{const e={...k};t.deliveryDate||(e.deliveryDate={invalid:!0,message:"Delivery date is required"}),t.lrNo||(e.lrNo={invalid:!0,message:"LR no is required"});let a=!1;for(const r in e)e[r].invalid===!0&&(a=!0);return a&&A(e),a},M=(t,e)=>{g(a=>({...a,[t]:new Date(e)}))},j=t=>{g(e=>({...e,[t]:null}))},y=(t,e,a)=>{t.preventDefault(),g(r=>({...r,[a]:e})),e._id&&f(h(e._id)).then(({payload:r={}})=>{var n;N(((n=r==null?void 0:r.data)==null?void 0:n.lsNo)||"")}).catch(r=>{d(r.message)})};return i.createElement(i.Fragment,null,b&&i.createElement(Z,null),i.createElement("div",{className:"inner-wrap"},i.createElement("h1",{className:"pageHead"},"Update a lorry receipt acknowledgement"),w!==""&&i.createElement(ne,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},i.createElement(oe,{severity:"error"},w)),i.createElement("form",{action:"",onSubmit:Y},i.createElement(se,{sx:{padding:"20px",marginBottom:"20px"}},i.createElement("div",{className:"grid grid-6-col"},i.createElement("div",{className:"grid-item"},i.createElement(D,{fullWidth:!0,size:"small",error:l.lrNo.invalid},i.createElement(me,{disablePortal:!0,size:"small",name:"lrNo",options:s,value:v.lrNo,onChange:(t,e)=>y(t,e,"lrNo"),ref:I,openOnFocus:!0,disableClearable:!0,renderInput:t=>i.createElement(L,{...t,inputProps:{...t.inputProps,onKeyDown:e=>{e.key==="Enter"&&(q(e,e.target.value),e.stopPropagation())}},label:"Lorry receipt no",error:l.lrNo.invalid,fullWidth:!0})}),l.lrNo.invalid&&i.createElement(F,null,l.lrNo.message))),i.createElement("div",{className:"grid-item"},i.createElement(D,{fullWidth:!0},i.createElement(L,{size:"small",variant:"outlined",label:"Challan no.",value:B,name:"lsNo",id:"lsNo",inputProps:{readOnly:!0}}))),i.createElement("div",{className:"grid-item"},i.createElement("div",{className:"bl_date"},i.createElement(D,{fullWidth:!0,error:l.deliveryDate.invalid},i.createElement(G,{dateAdapter:J},i.createElement(Q,{error:l.deliveryDate.invalid,label:"Delivery date",inputFormat:"DD/MM/YYYY",value:v.deliveryDate,onChange:M.bind(null,"deliveryDate"),inputProps:{readOnly:!0},renderInput:t=>i.createElement(L,{name:"deliveryDate",size:"small",...t,error:l.deliveryDate.invalid})})),l.deliveryDate.invalid&&i.createElement(F,null,l.deliveryDate.message)),i.createElement(C,{variant:"text",size:"medium",className:"clearHandler",onClick:j.bind(null,"deliveryDate")},"Clear")))),i.createElement("div",{className:"right"},i.createElement(C,{variant:"outlined",size:"medium",onClick:W},"Back"),i.createElement(C,{variant:"contained",size:"medium",type:"submit",color:"primary",className:"ml6"},"Save")),i.createElement(re,{onError:T,onScan:U})))))};export{Ge as default};
