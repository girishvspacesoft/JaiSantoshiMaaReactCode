import{r as f,a as e}from"./react-ef3a9354.js";import{u as _,a as ne}from"./react-redux-60e7b2bb.js";import{L as G,A as H,D as M}from"./x-date-pickers-488148bd.js";import{L as ie}from"./LorryReceipts-57b2aa96.js";import"./Card.module-3bdbfb7f.js";import{bN as le,bT as se,L as oe,al as S,bU as me,bP as ce,b3 as de,bV as ue}from"./index-38e56929.js";import{F as ge}from"./file-saver-259f058c.js";import{b as he,a as fe}from"./react-router-c905df87.js";import{O as ve,Q as Ee,a as U,i as c,A as Q,h as d,V as P,D as pe,m as b,l as A}from"./material-a209ad60.js";import"./@babel-5e587562.js";import"./react-dom-7dcc36ef.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-54e50305.js";import"./@date-io-28dabb9c.js";import"./dayjs-39ab3f8d.js";import"./utils-7edb168f.js";import"./clsx-1229b3e0.js";import"./base-7d25deaf.js";import"./@popperjs-f3391c26.js";import"./rifm-3b678e07.js";import"./system-5cdc79da.js";import"./styled-engine-b70b2ed8.js";import"./@emotion-afe87aa6.js";import"./stylis-79144faa.js";import"./private-theming-1cbad2aa.js";import"./react-transition-group-6e6f7170.js";import"./dom-helpers-9a525042.js";import"./x-data-grid-f709ef26.js";import"./prop-types-a80e8cd9.js";import"./reselect-36a88051.js";import"./redux-persist-cccb0614.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-584a1cea.js";import"./@remix-run-8989dd9f.js";import"./icons-material-e9adcbb1.js";import"./react-icons-5ea1dfbe.js";const I={branch:"",date:new Date,from:"",to:"",customer:"",lrList:[],totalFreight:"",freight:"",localFreight:"",cgst:"",cgstPercent:"",sgst:"",sgstPercent:"",total:"",grandTotal:"",remark:""},C={branch:{invalid:!1,message:""},date:{invalid:!1,message:""},customer:{invalid:!1,message:""},lrList:{invalid:!1,message:""},totalFreight:{invalid:!1,message:""},freight:{invalid:!1,message:""},localFreight:{invalid:!1,message:""},cgstPercent:{invalid:!1,message:""},sgstPercent:{invalid:!1,message:""}},lt=()=>{var w,V,O,j;const $=_(le),{branches:J,customers:v}=_(({bill:t})=>t)||{},z=_(t=>t.user),{state:K}=he(),[L,X]=f.useState([]),[r,u]=f.useState({...I,branch:K}),[n,x]=f.useState(C),[k,g]=f.useState(""),T=ne(),q=fe(),B=f.useCallback(()=>{q("/transactions/billList")},[q]);f.useEffect(()=>{const t=Object.keys(n);if(t!=null&&t.length){const a=document.querySelector(`input[name=${t[0]}]`);a==null||a.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[n]),f.useEffect(()=>{if(k){const t=document.getElementById("alertError");t==null||t.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[k]),f.useEffect(()=>{var t,a;r.branch&&r.customer&&T(se({branch:(t=r.branch)==null?void 0:t._id,consignor:(a=r.customer)==null?void 0:a._id,from:r.from,to:r.to})).then(({payload:i={}})=>{var h,o,p;const{message:s}=(i==null?void 0:i.data)||{};if(s)g(s);else{const l=(o=(h=i==null?void 0:i.data)==null?void 0:h.filter)==null?void 0:o.call(h,m=>!m.billGenerated);(p=l==null?void 0:l.forEach)==null||p.call(l,m=>{var F,N;m.checked=!1,m.consignor=((F=v==null?void 0:v.filter)==null?void 0:F.call(v,Y=>Y._id===m.consignor)[0])||"",m.consignee=((N=v==null?void 0:v.filter)==null?void 0:N.call(v,Y=>Y._id===m.consignee)[0])||""}),X(l),u(m=>({...m,lrList:[]}))}}).catch(()=>{g("Something went wrong! Please try later or contact Administrator.")})},[r.branch,r.customer,r.from,r.to]),f.useEffect(()=>{var a,i;let t=0;(i=(a=r.lrList)==null?void 0:a.forEach)==null||i.call(a,s=>{t+=+s.total}),u(s=>({...s,totalFreight:t}))},[r.lrList]),f.useEffect(()=>{const t=+r.totalFreight+ +r.freight+ +r.localFreight,a=t+ +r.sgst+ +r.cgst;u(i=>({...i,total:t,grandTotal:a}))},[r.totalFreight,r.freight,r.localFreight,r.sgst,r.cgst]),f.useEffect(()=>{const t=+r.totalFreight+ +r.freight+ +r.localFreight,a=t*+r.cgstPercent/100,i=t*+r.sgstPercent/100;u(s=>({...s,cgst:a,sgst:i}))},[r.cgstPercent,r.sgstPercent,r.totalFreight,r.freight,r.localFreight]),f.useEffect(()=>{var a,i;const t=(i=(a=r.lrList)==null?void 0:a.reduce)==null?void 0:i.call(a,(s,h)=>s+h.total,0);u(s=>({...s,totalFreight:t}))},[r.lrList]);const Z=()=>{u(I),g(""),x(C)},y=()=>{B()},E=t=>{const a=t.target.name,i=t.target.value;u(s=>({...s,[a]:i}))},R=(t,a)=>{u(i=>({...i,[a]:t}))},W=(t,a,i)=>{var s,h;t.preventDefault(),re(r)||T(me({...r,branch:(s=r.branch)==null?void 0:s._id,customer:(h=r.customer)==null?void 0:h._id})).then(({payload:o={}})=>{const{message:p}=(o==null?void 0:o.data)||{};p?g(p):a?T(ce({id:o==null?void 0:o.data._id,email:""})).then(({payload:l={}})=>{const{message:m}=(l==null?void 0:l.data)||{};if(m&&g(m),l!=null&&l.data.file){const F=de(l==null?void 0:l.data.file);if(F){const N=window.open(F,"_blank");N.focus(),N.print(),g(""),x(C),u(I),B()}}}).catch(l=>{g(l.message)}):i?T(ue({id:o==null?void 0:o.data._id,email:""})).then(({payload:l={}})=>{const{message:m}=(l==null?void 0:l.data)||{};if(m)g(m);else{const F=new Blob([l==null?void 0:l.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});ge.saveAs(F,"Bill.xlsx"),g(""),x(C),u(I),B()}}).catch(l=>{g(l.message)}):(g(""),x(C),u(I),B())}).catch(o=>{g(o.message)})},ee=t=>{t.preventDefault(),W(t,!0)},te=t=>{t.preventDefault(),W(t,!1,!0)},re=t=>{var s,h,o;const a={...C};t.branch||(a.branch={invalid:!0,message:"Branch is required"}),t.date||(a.date={invalid:!0,message:"Date is required"}),t.customer||(a.customer={invalid:!0,message:"Customer is required"}),(!((s=t.lrList)!=null&&s.length)||!((o=(h=t.lrList||[]).some)!=null&&o.call(h,p=>p)))&&(a.lrList={invalid:!0,message:"At least one lorry receipt is required"}),+t.totalFreight<=0&&(a.totalFreight={invalid:!0,message:"Total freight should be greater than 0"}),+t.freight<0&&(a.freight={invalid:!0,message:"Freight should be 0 or more"}),+t.localFreight<0&&(a.localFreight={invalid:!0,message:"Local freight should be 0 or more"}),+t.cgstPercent<0&&(a.cgstPercent={invalid:!0,message:"CGST % should be 0 or more"}),+t.sgstPercent<0&&(a.sgstPercent={invalid:!0,message:"SGST % should be 0 or more"});let i=!1;for(const p in a)a[p].invalid===!0&&(i=!0);return i&&x(a),i},D=(t,a)=>{u(i=>({...i,[t]:new Date(a)}))},ae=()=>{var a;const t=(a=L==null?void 0:L.filter)==null?void 0:a.call(L,i=>i.checked);u(i=>({...i,lrList:t}))};return e.createElement(e.Fragment,null,$&&e.createElement(oe,null),e.createElement("h1",{className:"pageHead"},"Add a bill"),e.createElement("div",{className:"inner-wrap"},k!==""&&e.createElement(ve,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(Ee,{id:"alertError",severity:"error"},k)),e.createElement("form",{action:"",onSubmit:W,id:"billForm"},e.createElement(U,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0,size:"small",error:n.branch.invalid},e.createElement(Q,{disablePortal:!0,size:"small",name:"branch",options:J,value:r.branch,onChange:(t,a)=>R(a,"branch"),getOptionLabel:t=>t.name,openOnFocus:!0,disabled:z&&z.type&&((V=(w=z.type)==null?void 0:w.toLowerCase)==null?void 0:V.call(w))!=="superadmin"&&((j=(O=z.type)==null?void 0:O.toLowerCase)==null?void 0:j.call(O))!=="admin",renderInput:t=>e.createElement(d,{...t,label:"Branch",name:"branch",error:n.branch.invalid,fullWidth:!0})}),n.branch.invalid&&e.createElement(P,null,n.branch.message))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0,size:"small",error:n.customer.invalid},e.createElement(Q,{disablePortal:!0,autoSelect:!0,size:"small",name:"customer",options:v,value:r.customer||null,onChange:(t,a)=>R(a,"customer"),getOptionLabel:t=>t.name,openOnFocus:!0,renderInput:t=>e.createElement(d,{...t,label:"Customer",error:n.customer.invalid,fullWidth:!0})}),n.customer.invalid&&e.createElement(P,null,n.customer.message))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0,error:n.date.invalid},e.createElement(G,{dateAdapter:H},e.createElement(M,{error:n.date.invalid,label:"Date",inputFormat:"DD/MM/YYYY",value:r.date,disableFuture:!0,onChange:D.bind(null,"date"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(d,{name:"date",size:"small",...t,error:n.date.invalid})})),n.date.invalid&&e.createElement(P,null,n.date.message))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0},e.createElement(G,{dateAdapter:H},e.createElement(M,{label:"From",inputFormat:"DD/MM/YYYY",value:r.from||null,disableFuture:!0,maxDate:r.to,onChange:D.bind(null,"from"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(d,{name:"from",size:"small",...t})})))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0},e.createElement(G,{dateAdapter:H},e.createElement(M,{label:"To",inputFormat:"DD/MM/YYYY",value:r.to||null,disableFuture:!0,minDate:r.from,onChange:D.bind(null,"to"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(d,{name:"to",size:"small",...t})}))))))),n.lrList.invalid&&e.createElement("p",{className:"error"},n.lrList.message),e.createElement(U,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement(ie,{lorryReceipts:L,setLRForBill:ae,bill:r,setBill:u}),e.createElement(pe,{sx:{margin:"20px 0"}}),e.createElement("form",{action:"",onSubmit:W,id:"billForm"},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0},e.createElement(d,{size:"small",type:"number",variant:"outlined",label:"Total freight",value:r.totalFreight||"",onChange:E,name:"totalFreight",id:"totalFreight",InputProps:{startAdornment:e.createElement(b,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0,error:n.freight.invalid},e.createElement(d,{size:"small",type:"text",variant:"outlined",label:"Freight",value:r.freight||"",error:n.freight.invalid,onInput:S,onChange:E,name:"freight",id:"freight",InputProps:{maxLength:12,startAdornment:e.createElement(b,{position:"start"},"â‚¹")}}),n.freight.invalid&&e.createElement(P,null,n.freight.message))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0,error:n.localFreight.invalid},e.createElement(d,{size:"small",variant:"outlined",label:"Local freight",value:r.localFreight||"",error:n.localFreight.invalid,onChange:E,onInput:S,name:"localFreight",id:"localFreight",InputProps:{startAdornment:e.createElement(b,{position:"start"},"â‚¹"),maxLength:15}}),n.localFreight.invalid&&e.createElement(P,null,n.localFreight.message))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0,error:n.cgstPercent.invalid},e.createElement(d,{size:"small",variant:"outlined",label:"CGST %",value:r.cgstPercent||"",error:n.cgstPercent.invalid,onChange:E,onInput:S,name:"cgstPercent",id:"cgstPercent",InputProps:{endAdornment:e.createElement(b,{position:"end"},"%"),maxLength:15}}),n.cgstPercent.invalid&&e.createElement(P,null,n.cgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0},e.createElement(d,{size:"small",variant:"outlined",label:"CGST",value:r.cgst||"",onChange:E,onInput:S,name:"cgst",id:"cgst",InputProps:{startAdornment:e.createElement(b,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0,error:n.sgstPercent.invalid},e.createElement(d,{size:"small",variant:"outlined",label:"SGST %",value:r.sgstPercent||"",error:n.sgstPercent.invalid,onChange:E,onInput:S,name:"sgstPercent",id:"sgstPercent",InputProps:{endAdornment:e.createElement(b,{position:"end"},"%"),maxLength:15}}),n.sgstPercent.invalid&&e.createElement(P,null,n.sgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0},e.createElement(d,{size:"small",variant:"outlined",label:"SGST",value:r.sgst||"",onChange:E,name:"sgst",id:"sgst",InputProps:{startAdornment:e.createElement(b,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0},e.createElement(d,{size:"small",variant:"outlined",label:"Total",value:r.total||"",onChange:E,name:"total",id:"total",InputProps:{startAdornment:e.createElement(b,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0},e.createElement(d,{size:"small",type:"number",variant:"outlined",label:"Grand total",value:r.grandTotal||"",onChange:E,name:"grandTotal",id:"grandTotal",InputProps:{startAdornment:e.createElement(b,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(c,{fullWidth:!0},e.createElement(d,{size:"small",variant:"outlined",label:"Remark",value:r.remark,onChange:E,name:"remark",id:"remark",inputProps:{maxLength:200}}))))),e.createElement("div",{className:"right"},e.createElement(A,{variant:"outlined",size:"medium",onClick:y},"Back"),e.createElement(A,{variant:"outlined",size:"medium",onClick:Z,className:"ml6"},"Reset"),e.createElement(A,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"billForm",className:"ml6"},"Save"),e.createElement(A,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:ee},"Save & Print"),e.createElement(A,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:te},"export to excel sheet")))))};export{lt as default};
