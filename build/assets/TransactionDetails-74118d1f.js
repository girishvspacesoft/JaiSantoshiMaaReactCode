import{r as h,a as r}from"./react-69b9bddd.js";import{e as ee,f as te}from"./icons-material-40f8e5d8.js";import{a as re,u as ie}from"./react-redux-13959126.js";import{a$ as ae,bh as ne,L as le,an as C}from"./index-1d9d8716.js";import"./Card.module-3bdbfb7f.js";import{v as N,i as w,A as G,h as b,V as W,m as R,l as V,f as $}from"./material-04052d9a.js";import{D as se}from"./x-data-grid-83fc2422.js";const v=[{label:"Fixed",value:"Fixed"},{label:"Kg",value:"Kg"},{label:"Case",value:"Case"}],z={article:null,articleNo:"",description:"",weight:"",chargeWeight:"",rateType:v[0]||null,rate:"",freight:""},S={article:{invalid:!1,message:""},articleNo:{invalid:!1,message:""},weight:{invalid:!1,message:""},chargeWeight:{invalid:!1,message:""},rateType:{invalid:!1,message:""},rate:{invalid:!1,message:""},freight:{invalid:!1,message:""}},ve=({articles:o,lorryReceipt:p,setLorryReceipt:y})=>{var P;const _=[{field:"article",headerName:"Article",flex:1,renderCell:e=>{var t,a;return typeof e.row.article=="string"?e.row.article:(t=e.row.article)!=null&&t.label?(a=e.row.article)==null?void 0:a.label:null}},{field:"articleNo",headerName:"No. of articles",flex:1},{field:"description",headerName:"Description",flex:1},{field:"weight",headerName:"Weight",flex:1},{field:"chargeWeight",headerName:"Charge weight",flex:1},{field:"rateType",headerName:"Rate type",flex:1,renderCell:e=>{var t,a;return typeof((t=e.row)==null?void 0:t.rateType)=="string"?e.row.rateType:(a=e.row.rateType)!=null&&a.value?e.row.rateType.value:null}},{field:"rate",headerName:"Rate",flex:1},{field:"freight",headerName:"Freight",flex:1},{field:"actions",headerName:"Action",flex:1,sortable:!1,renderCell:e=>{const t=n=>(n.stopPropagation(),Z(e.row.id||e.row._id,!!e.row._id)),a=n=>(n.stopPropagation(),Y(e.row.id||e.row._id,!!e.row._id));return r.createElement(r.Fragment,null,r.createElement($,{size:"small",onClick:t,color:"primary"},r.createElement(ee,null)),"  ",r.createElement($,{size:"small",onClick:a,color:"error"},r.createElement(te,null)))}}],U=re(),j=ie(ae),[l,H]=h.useState(S),[i,E]=h.useState(z),[M,q]=h.useState(!1),[k,A]=h.useState(!1),[F,L]=h.useState(!1),[I,J]=h.useState(!1),[oe,O]=h.useState("");let B;h.useEffect(()=>{M&&!k&&(y(e=>{var a,n,u,s,m,c;let t={...e,transactions:[...e.transactions]};if(F){let f;t.transactions[0]._id?f=(m=(s=t.transactions)==null?void 0:s.filter)==null?void 0:m.call(s,d=>d._id!==i._id):f=(u=(n=t.transactions)==null?void 0:n.filter)==null?void 0:u.call(n,d=>d.id!==i.id);const g=(c=o==null?void 0:o.filter)==null?void 0:c.call(o,d=>d._id===i.article||d.name===i.article),T={...i};g!=null&&g.length&&(T.article=g[0].name),t.transactions=[...f,{...T}]}else{const f={...i,id:Math.random()},g=(a=o==null?void 0:o.filter)==null?void 0:a.call(o,T=>T._id===f.article);g!=null&&g.length&&(f.article=g[0].name),t.transactions=[...e.transactions,{...f}]}return t}),E(z),q(!1),L(!1),B.focus())},[M,k,i,o,F,y]),h.useEffect(()=>{i!=null&&i.weight&&E(e=>({...e,chargeWeight:e.weight}))},[i==null?void 0:i.weight]),h.useEffect(()=>{var t;let e;i.rateType&&(((t=i.rateType)==null?void 0:t.value)==="Kg"||i.rateType==="Kg")&&i.chargeWeight&&i.rate&&(e=+i.chargeWeight*+Number(i.rate)),i.rateType&&i.rateType.value==="Case"&&i.rate&&i.articleNo&&(e=+i.articleNo*+Number(i.rate)),e&&E(a=>({...a,freight:e}))},[i.rate,i.chargeWeight,i.rateType,i.articleNo]),h.useEffect(()=>{p.consignor&&p.consignor._id&&U(ne(p.consignor._id)).then(({payload:e={}})=>{const{message:t}=(e==null?void 0:e.data)||{};t?O(t):J(e==null?void 0:e.data.rateMaster)}).catch(e=>{O(e.message)})},[p.consignor]),h.useEffect(()=>{var e,t;if(I&&i.article&&i.article.name){const a=(t=(e=I.rates)==null?void 0:e.find)==null?void 0:t.call(e,n=>{var u,s,m,c;return((s=(u=n.article)==null?void 0:u.toLowerCase)==null?void 0:s.call(u))===((c=(m=i.article.name)==null?void 0:m.toLowerCase)==null?void 0:c.call(m))});a&&E(n=>({...n,rate:a.rate}))}else E(a=>({...a,rate:""}))},[I,i.article]);const x=e=>{const t=e.target.name,a=e.target.value;E(n=>({...n,[t]:a}))},Q=()=>{E(z),H(S)},X=e=>{e.preventDefault(),H(t=>D(i)),q(!0)},Z=(e,t)=>{var s,m,c,f,g,T;let a;t?a={...((f=(c=p.transactions)==null?void 0:c.filter)==null?void 0:f.call(c,d=>d._id===e)[0])||{}}:a={...((m=(s=p.transactions)==null?void 0:s.filter)==null?void 0:m.call(s,d=>d.id===e)[0])||{}};const n=(g=o==null?void 0:o.findIndex)==null?void 0:g.call(o,d=>d.name===a.article);n>=0&&(a.article=o[n]);const u=(T=v==null?void 0:v.findIndex)==null?void 0:T.call(v,d=>d.label===a.rateType);u>=0&&(a.rateType=v[u]),E(a),L(!0)},Y=(e,t)=>{var n,u,s,m;let a;t?a=(m=(s=p.transactions)==null?void 0:s.filter)==null?void 0:m.call(s,c=>c._id!==e):a=(u=(n=p.transactions)==null?void 0:n.filter)==null?void 0:u.call(n,c=>c.id!==e),y(c=>({...c,transactions:a}))},D=e=>{var n,u;const t={...S};e.article||(t.article={invalid:!0,message:"Article is required"}),(typeof e.articleNo=="string"&&!((u=(n=e.articleNo)==null?void 0:n.trim)!=null&&u.call(n))||typeof e.articleNo=="number"&&e.articleNo<=0)&&(t.articleNo={invalid:!0,message:"Number of articles is required"}),e.articleNo&&isNaN(e.articleNo)&&(t.materialCost={invalid:!0,message:"Number of articles should be a number"}),(!e.weight||e.weight<=0)&&e.rateType===v[1]&&(t.weight={invalid:!0,message:"Weight is required"}),(!e.chargeWeight||e.chargeWeight<=0)&&e.rateType===v[1]&&(t.chargeWeight={invalid:!0,message:"Charge weight is required"}),e.weight&&isNaN(e.weight)&&(t.weight={invalid:!0,message:"Weight should be in a number"}),e.rateType||(t.rateType={invalid:!0,message:"Rate type is required"}),e.rate&&isNaN(e.weight)&&(t.rate={invalid:!0,message:"Rate  is required"}),e.freight||(t.freight={invalid:!0,message:"Freight is required"});let a=!1;for(const s in t)t[s].invalid===!0&&(a=!0);return A(!!a),t},K=(e,t,a)=>{E(n=>({...n,[a]:t,description:(t==null?void 0:t.name)||""}))};return r.createElement("div",null,j&&r.createElement(le,null),r.createElement("form",{id:"transactionDetailsForm",onSubmit:X,className:"mb20"},r.createElement(N,{container:!0,spacing:2},r.createElement(N,{item:!0,xs:2},r.createElement(w,{fullWidth:!0,size:"small",error:l.article.invalid},r.createElement(G,{autoSelect:!0,autoHighlight:!0,size:"small",name:"article",options:o,value:i.article,onChange:(e,t)=>K(e,t,"article"),openOnFocus:!0,renderInput:e=>r.createElement(b,{...e,label:"Article",error:l.article.invalid,fullWidth:!0,inputRef:t=>{B=t}})}),l.article.invalid&&r.createElement(W,null,l.article.message))),r.createElement(N,{item:!0,xs:1.4},r.createElement(w,{fullWidth:!0,error:l.articleNo.invalid},r.createElement(b,{size:"small",variant:"outlined",label:"No of articles",value:i.articleNo||"",error:l.articleNo.invalid,onChange:x,onInput:C,name:"articleNo",id:"articleNo"}),l.articleNo.invalid&&r.createElement(W,null,l.articleNo.message))),r.createElement(N,{item:!0,xs:1.4},r.createElement(w,{fullWidth:!0},r.createElement(b,{size:"small",variant:"outlined",label:"Description",value:i.description,onChange:x,name:"description",id:"description"}))),r.createElement(N,{item:!0,xs:1.4},r.createElement(w,{fullWidth:!0,error:l.weight.invalid},r.createElement(b,{size:"small",variant:"outlined",label:"Weight",value:i.weight||"",error:l.weight.invalid,onChange:x,onInput:C,name:"weight",id:"weight"}),l.weight.invalid&&r.createElement(W,null,l.weight.message))),r.createElement(N,{item:!0,xs:1.4},r.createElement(w,{fullWidth:!0,error:l.chargeWeight.invalid},r.createElement(b,{size:"small",variant:"outlined",label:"Charge weight",value:i.chargeWeight||"",error:l.chargeWeight.invalid,onChange:x,onInput:C,name:"chargeWeight",id:"chargeWeight"}),l.chargeWeight.invalid&&r.createElement(W,null,l.chargeWeight.message))),r.createElement(N,{item:!0,xs:1.4},r.createElement(w,{fullWidth:!0,size:"small",error:l.rateType.invalid},r.createElement(G,{autoSelect:!0,size:"small",name:"rateType",options:v,value:i.rateType,onChange:(e,t)=>K(e,t,"rateType"),openOnFocus:!0,renderInput:e=>r.createElement(b,{...e,label:"Rate type",error:l.rateType.invalid,fullWidth:!0})}),l.rateType.invalid&&r.createElement(W,null,l.rateType.message))),r.createElement(N,{item:!0,xs:1.4},r.createElement(w,{fullWidth:!0,error:l.rate.invalid},r.createElement(b,{size:"small",variant:"outlined",label:"Rate",value:i.rate||"",error:l.rate.invalid,onChange:x,onInput:C,name:"rate",id:"rate",disabled:i.rateType==="Fixed",InputProps:{startAdornment:r.createElement(R,{position:"start"},"₹")}}),l.rate.invalid&&r.createElement(W,null,l.rate.message))),r.createElement(N,{item:!0,xs:1.4},r.createElement(w,{fullWidth:!0,error:l.freight.invalid},r.createElement(b,{size:"small",variant:"outlined",label:"Freight",value:i.freight||"",error:l.freight.invalid,name:"freight",id:"freight",InputProps:{readOnly:((P=i.rateType)==null?void 0:P.value)!=="Fixed",startAdornment:r.createElement(R,{position:"start"},"₹")},onChange:x,onInput:C}),l.freight.invalid&&r.createElement(W,null,l.freight.message)))),r.createElement("div",{className:"right",style:{paddingTop:"10px"}},r.createElement(V,{variant:"outlined",size:"medium",onClick:Q,className:"ml6"},"Reset"),r.createElement(V,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"transactionDetailsForm",className:"ml6"},F?"Update":"Add"))),r.createElement(se,{sx:{backgroundColor:"primary.contrastText"},autoHeight:!0,density:"compact",getRowId:e=>e.id||e._id,rows:p.transactions,columns:_,initialState:{..._,columns:{columnVisibilityModel:{_id:!1}}},pageSize:10,rowsPerPageOptions:[10],disableSelectionOnClick:!0}))};export{ve as T};
