import{r as i,a as r}from"./react-69b9bddd.js";import{b as K,k as X}from"./icons-material-40f8e5d8.js";import{L as _,A as z,D as H}from"./x-date-pickers-f3802fc3.js";import"./Card.module-3bdbfb7f.js";import{cy as Z,cz as y,cA as ee,cB as te,L as re,cC as ae,a5 as ne,cD as ie,bt as se,ba as oe,cE as le}from"./index-1d9d8716.js";import{u as I,a as ce}from"./react-redux-13959126.js";import{a as me}from"./react-router-7dadf37a.js";import{i as v,A as de,h as w,l as ue,a as fe,V as T,f as Y,O as ge,Q as he}from"./material-04052d9a.js";import{D as pe}from"./x-data-grid-83fc2422.js";import"./@babel-5e587562.js";import"./@date-io-28dabb9c.js";import"./dayjs-39ab3f8d.js";import"./utils-49fe0532.js";import"./clsx-1229b3e0.js";import"./base-e8cfb5a9.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./@popperjs-f3391c26.js";import"./rifm-bf33b601.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./stylis-79144faa.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./react-icons-6bc9af43.js";import"./use-sync-external-store-20ba4de3.js";import"./prop-types-b6d0a120.js";import"./reselect-36a88051.js";const $={startDate:null,endDate:null},b={startDate:{invalid:!1,message:""},endDate:{invalid:!1,message:""}},rt=()=>{var h,k,p,B;const x=[{field:"_id",headerName:"Id"},{field:"transactionNo",headerName:"Transaction no.",flex:1,renderCell:e=>ae(e.row.transactionNo)},{field:"date",headerName:"Date & time",flex:1,minWidth:200,renderCell:e=>`${ne(new Date(e.row.date))} ${ie(e.row.date)}`},{field:"description",headerName:"Description",flex:1},{field:"credit",type:"number",headerName:"Credit",flex:1,renderCell:e=>{var t,a;return e.row.credit!=="-"?`₹ ${(a=(t=e.row.credit)==null?void 0:t.toFixed)==null?void 0:a.call(t,2)}`:e.row.credit}},{field:"debit",type:"number",headerName:"Debit",flex:1,renderCell:e=>{var t,a;return e.row.debit!=="-"?`₹ ${(a=(t=e.row.debit)==null?void 0:t.toFixed)==null?void 0:a.call(t,2)}`:e.row.debit}},{field:"bank",headerName:"Bank & account no",flex:1,minWidth:300,renderCell:e=>{var a;const t=(a=u==null?void 0:u.filter)==null?void 0:a.call(u,s=>s._id===e.row.bank);return`${t!=null&&t.length?t[0].name:e.row.bank} - ${e.row.bankAccountNumber}`}},{field:"lsNo",headerName:"Challan no",flex:1,renderCell:e=>e.row.lsNo?se(e.row.lsNo):""},{field:"availableBal",type:"number",headerName:"Balance",flex:1,renderCell:e=>{var t,a;return e.row.availableBal?`₹ ${(a=(t=e.row.availableBal)==null?void 0:t.toFixed)==null?void 0:a.call(t,2)}`:"₹ 0.00"}}],M=I(Z),d=I(e=>e.user),O=me(),[c,W]=i.useState([]),[u,R]=i.useState([]),[m,S]=i.useState(null),[o,C]=i.useState([]),[q,N]=i.useState([]),[P,n]=i.useState(""),[l,D]=i.useState(b),[g,F]=i.useState($),f=ce();i.useEffect(()=>{f(y()).then(({payload:e={}})=>{var a,s,L;const{message:t}=(e==null?void 0:e.data)||{};if(t)n(t);else if(n(""),W(e==null?void 0:e.data),(a=e==null?void 0:e.data)!=null&&a.length){const E=(L=(s=e==null?void 0:e.data)==null?void 0:s.filter)==null?void 0:L.call(s,J=>J._id===d.branch);E!=null&&E.length&&S(E[0])}}).catch(()=>{n("Something went wrong! Please try later or contact Administrator.")}),f(ee()).then(({payload:e={}})=>{const{message:t}=(e==null?void 0:e.data)||{};t?n(t):(n(""),R(e==null?void 0:e.data))}).catch(()=>{n("Something went wrong! Please try later or contact Administrator.")})},[]),i.useEffect(()=>{m!=null&&m._id&&f(te(m._id)).then(({payload:e={}})=>{const{message:t}=(e==null?void 0:e.data)||{};t?n(t):(n(""),C(e==null?void 0:e.data))}).catch(()=>{n("Something went wrong! Please try later or contact Administrator.")})},[m]),i.useEffect(()=>{var e;if(o!=null&&o.length){const t=(e=o==null?void 0:o.map)==null?void 0:e.call(o,a=>({...a,credit:a.type==="credit"?a.amount:"-",debit:a.type==="debit"?a.amount:"-"}));N(t)}else N([])},[o]);const V=i.useCallback(()=>{D(b),F($)},[]),j=e=>{var a;const t=(a=c==null?void 0:c.filter)==null?void 0:a.call(c,s=>s._id===e.target.value);S(t[0]),f(oe(e.target.value))},G=()=>{O("/transactions/pettyCashHistory/addPettyCashTransaction")},A=(e,t)=>{F(a=>({...a,[e]:new Date(t)}))},Q=e=>{e.preventDefault(),U(g)||f(le(g)).then(({payload:t={}})=>{const{message:a}=(t==null?void 0:t.data)||{};a?n(a):(n(""),C(t==null?void 0:t.data),D(b))}).catch(()=>{n("Something went wrong! Please try later or contact Administrator.")})},U=e=>{const t={...b};e.startDate||(t.startDate={invalid:!0,message:"Start date is required"}),e.endDate||(t.endDate={invalid:!0,message:"End date is required"});let a=!1;for(const s in t)t[s].invalid===!0&&(a=!0);return a&&D(t),a};return r.createElement(r.Fragment,null,M&&r.createElement(re,null),r.createElement("div",{className:"page_head"},r.createElement("h1",{className:"pageHead"},"Petty cash transactions"),r.createElement("div",{className:"page_actions"},r.createElement(v,{size:"small",sx:{width:"230px",marginRight:"5px"}},r.createElement(de,{disablePortal:!0,size:"small",name:"branch",options:c,value:m||null,onChange:j,disabled:d&&d.type&&((k=(h=d.type)==null?void 0:h.toLowerCase)==null?void 0:k.call(h))!=="superadmin"&&((B=(p=d.type)==null?void 0:p.toLowerCase)==null?void 0:B.call(p))!=="admin",getOptionLabel:e=>e.name||"",openOnFocus:!0,renderInput:e=>r.createElement(w,{...e,label:"Select branch",fullWidth:!0})})),r.createElement(ue,{variant:"contained",size:"small",type:"button",color:"primary",className:"ml6",onClick:G},"Add a petty cash transaction"))),r.createElement(fe,{sx:{padding:"20px",marginBottom:"20px"}},r.createElement("h2",{style:{marginBottom:"10px"}},"Search"),r.createElement("form",{action:"",onSubmit:Q},r.createElement("div",{className:"grid grid-6-col"},r.createElement("div",{className:"grid-item"},r.createElement(v,{fullWidth:!0,error:l.startDate.invalid},r.createElement(_,{dateAdapter:z},r.createElement(H,{label:"Start date",inputFormat:"DD/MM/YYYY",value:g.startDate,disableFuture:!0,disableMaskedInput:!0,onChange:A.bind(null,"startDate"),inputProps:{readOnly:!0},renderInput:e=>r.createElement(w,{name:"date",size:"small",...e,error:l.startDate.invalid})})),l.startDate.invalid&&r.createElement(T,null,l.startDate.message))),r.createElement("div",{className:"grid-item"},r.createElement(v,{fullWidth:!0,error:l.endDate.invalid},r.createElement(_,{dateAdapter:z},r.createElement(H,{label:"End date",inputFormat:"DD/MM/YYYY",value:g.endDate,disableMaskedInput:!0,onChange:A.bind(null,"endDate"),inputProps:{readOnly:!0},renderInput:e=>r.createElement(w,{name:"date",size:"small",...e,error:l.endDate.invalid})})),l.endDate.invalid&&r.createElement(T,null,l.endDate.message))),r.createElement("div",{className:"grid-item"},r.createElement(Y,{size:"small",variant:"contained",color:"primary",type:"submit",style:{backgroundColor:"#274d62",marginLeft:"5px"}},r.createElement(K,{style:{color:"#ffffff",verticalAlign:"middle"}})),r.createElement(Y,{size:"small",variant:"contained",color:"primary",type:"button",onClick:V,style:{backgroundColor:"#274d62",marginLeft:"5px"}},r.createElement(X,{style:{color:"#ffffff",verticalAlign:"middle"}})))))),P!==""&&r.createElement(ge,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},r.createElement(he,{severity:"error"},P)),r.createElement(pe,{sx:{backgroundColor:"primary.contrastText"},autoHeight:!0,density:"compact",getRowId:e=>e._id,rows:q,columns:x,initialState:{...x,columns:{columnVisibilityModel:{_id:!1}}},pageSize:10,rowsPerPageOptions:[10],disableSelectionOnClick:!0}))};export{rt as default};
