import{r as s,a as t}from"./react-bfabd40c.js";import{a as V,u as A}from"./react-redux-45d870ba.js";import{c as W,i as q,h as J,j as K,e as X,f as Y}from"./icons-material-4539f19e.js";import"./Card.module-3bdbfb7f.js";import{C as Z}from"./Dialog-cfe6f9ef.js";import{cR as y,cS as ee,cT as O,b_ as te,b3 as ae,b4 as oe,L as se,cU as ne,a4 as re,bq as ie,cV as le,cW as ce}from"./index-60b53c60.js";import{S as me}from"./SendEmail-4c230401.js";import{u as ue,D as de,G as fe}from"./x-data-grid-cceece3f.js";import{a as pe}from"./react-router-1b5f20a2.js";import{j as ge}from"./utils-c03c978f.js";import{l as Ee,O as he,Q as Se,h as we,m as be,f}from"./material-e0a59a28.js";import"./@babel-e11bafe1.js";import"./react-dom-b0178e93.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-6cfbf744.js";import"./use-sync-external-store-18921cc2.js";import"./redux-persist-d9cc1560.js";import"./redux-b7ba668d.js";import"./@reduxjs-4d37e7cf.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-4a70c6fc.js";import"./react-router-dom-4405dfe9.js";import"./@remix-run-d753ad9e.js";import"./react-icons-55b3b9a0.js";import"./system-a1d29c52.js";import"./styled-engine-f3bd09bf.js";import"./@emotion-77835cc8.js";import"./stylis-79144faa.js";import"./private-theming-970ac73c.js";import"./react-transition-group-7ded6f4d.js";import"./dom-helpers-9a525042.js";import"./base-ff50cfe3.js";import"./@popperjs-f3391c26.js";import"./clsx-1229b3e0.js";import"./prop-types-d7fd566a.js";import"./reselect-36a88051.js";const st=()=>{const _=[{field:"_id",headerName:"Id"},{field:"quotationNo",headerName:"Quotation no.",flex:1},{field:"date",headerName:"Date",flex:1},{field:"customer",headerName:"Customer",flex:1},{field:"actions",headerName:"Action",flex:1,sortable:!1,renderCell:e=>{const a=r=>{r.stopPropagation(),x({...e.row,download:!1})},o=r=>{r.stopPropagation(),x({...e.row,download:!0})},c=r=>{r.stopPropagation(),g(!0),E({...e.row})},n=r=>(r.stopPropagation(),B(e.row._id)),m=r=>{r.stopPropagation(),C("/transactions/quotations/editQuotation",{state:{quotationId:e.row._id}})};return t.createElement(t.Fragment,null,t.createElement(f,{size:"small",onClick:a,color:"primary"},t.createElement(q,null)),t.createElement(f,{size:"small",onClick:o,color:"primary"},t.createElement(J,null)),t.createElement(f,{size:"small",onClick:c,color:"primary"},t.createElement(K,null)),t.createElement(f,{size:"small",onClick:m,color:"primary"},t.createElement(X,null)),t.createElement(f,{size:"small",onClick:n,color:"error"},t.createElement(Y,null)))}}],u=V(),h=ue(),C=pe(),P=A(y),{search:p}=A(({quotation:e})=>e),[i,L]=s.useState([]),[Q,l]=s.useState(""),[F,S]=s.useState(!1),[R,z]=s.useState(""),[d,x]=s.useState(null),[T,g]=s.useState(!1),[N,v]=s.useState(!1),[w,$]=s.useState(""),[b,E]=s.useState(null),[j,D]=s.useState(!1),I=()=>{u(ne()).then(({payload:e={}})=>{var o,c;const{message:a}=(e==null?void 0:e.data)||{};a?l(a):(l(""),L((c=(o=e==null?void 0:e.data)==null?void 0:o.map)==null?void 0:c.call(o,n=>{var m;return{...n,date:re(new Date(n.date)),quotationNo:ie(n.quotationNo),customer:(m=n.customer)!=null&&m.name?n.customer.name:n.customer}})))}).catch(()=>{l("Something went wrong! Please try later or contact Administrator.")})};s.useEffect(()=>{I(),u(ee())},[]);const k=s.useMemo(()=>ge(e=>{var a,o,c;h.current.setQuickFilterValues((c=(o=(a=e.split)==null?void 0:a.call(e," "))==null?void 0:o.filter)==null?void 0:c.call(o,n=>n!==""))},500),[h]);s.useEffect(()=>{p&&(i!=null&&i.length)&&(D(!0),k(p),setTimeout(()=>{D(!1)},500))},[i]);const G=e=>{k(e.target.value),u(le(e.target.value))};s.useEffect(()=>{d&&d._id&&u(O({id:d._id,email:""})).then(({payload:e={}})=>{var o;const{message:a}=(e==null?void 0:e.data)||{};if(a)l(a);else if(e!=null&&e.data.file){const c=(o=i==null?void 0:i.find)==null?void 0:o.call(i,r=>r._id===d._id),n=te(c.quotationNo,6)+".pdf",m=ae(e==null?void 0:e.data.file);d.download?oe(m,n):window.open(m,"_blank")}}).catch(e=>{l(e.message)})},[d]);const B=e=>{z(e),S(!0)},H=e=>{e.target.value==="true"?u(ce(R)).then(({payload:a={}})=>{const{message:o}=(a==null?void 0:a.data)||{};o?l(o):(I(),S(!1))}).catch(a=>{l(a.message)}):S(!1)},U=()=>{C("/transactions/quotations/addQuotation")};s.useEffect(()=>{N&&w&&b&&(g(!1),u(O({id:b._id,email:w})).then(({payload:e={}})=>{const{message:a}=(e==null?void 0:e.data)||{};a&&l(a),v(!1),E(null)}).catch(e=>{l(e.message),E(null)}))},[N,w,b]);const M=e=>{v(!0),$(e)};return t.createElement(t.Fragment,null,(P||j)&&t.createElement(se,null),t.createElement("div",{className:"inner-wrap"},F&&t.createElement(Z,{isOpen:!0,onClose:H,title:"Are you sure?",content:"Do you want to delete the quotation",warning:!0}),t.createElement("div",{className:"page_head"},t.createElement("h1",{className:"pageHead"},"Quotations"),t.createElement("div",{className:"page_actions"},t.createElement(Ee,{variant:"contained",size:"small",type:"button",color:"primary",className:"ml6",onClick:U},"Add a quotation"))),Q!==""&&t.createElement(he,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},t.createElement(Se,{severity:"error"},Q)),t.createElement("div",{style:{width:"100%"}},t.createElement(de,{apiRef:h,sx:{backgroundColor:"primary.contrastText"},autoHeight:!0,density:"compact",getRowId:e=>e._id,rows:i,columns:_,initialState:{..._,columns:{columnVisibilityModel:{_id:!1}}},components:{Toolbar:()=>t.createElement(fe,{sx:{gap:"6px",mb:"10px",justifyContent:"end",border:"none"}},t.createElement(we,{variant:"standard",placeholder:"Search...",autoFocus:!!p,onChange:G,value:p,InputProps:{startAdornment:t.createElement(be,{position:"start"},t.createElement(W,null))}}))},pageSize:10,rowsPerPageOptions:[10],disableSelectionOnClick:!0})),t.createElement(me,{isOpen:T,setIsOpen:g,handleEmailClose:()=>{g(!1),E(null)},handleSendEmail:e=>M(e),contentBody:""})))};export{st as default};
