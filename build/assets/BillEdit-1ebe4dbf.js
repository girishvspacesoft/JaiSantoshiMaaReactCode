import{r as g,a as e}from"./react-bfabd40c.js";import{u as j,a as he}from"./react-redux-45d870ba.js";import{L as U,A as Q,D as X}from"./x-date-pickers-7b1cc7dd.js";import{L as fe}from"./LorryReceipts-7c93c074.js";import"./Card.module-3bdbfb7f.js";import{bN as ve,bW as Ee,L as be,al as q,bT as pe,bX as Fe,bP as Pe,b3 as Ce,bV as xe}from"./index-60b53c60.js";import{F as Se}from"./file-saver-7e589f53.js";import{a as Le,b as Ne}from"./react-router-1b5f20a2.js";import{O as Ae,Q as Be,a as y,i as h,A as ee,h as f,V as L,D as Ie,m as x,l as O}from"./material-e0a59a28.js";import"./@babel-e11bafe1.js";import"./react-dom-b0178e93.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-6cfbf744.js";import"./use-sync-external-store-18921cc2.js";import"./@date-io-f382d426.js";import"./dayjs-7f45ce31.js";import"./utils-c03c978f.js";import"./clsx-1229b3e0.js";import"./base-ff50cfe3.js";import"./@popperjs-f3391c26.js";import"./rifm-7b0f12ad.js";import"./system-a1d29c52.js";import"./styled-engine-f3bd09bf.js";import"./@emotion-77835cc8.js";import"./stylis-79144faa.js";import"./private-theming-970ac73c.js";import"./react-transition-group-7ded6f4d.js";import"./dom-helpers-9a525042.js";import"./x-data-grid-cceece3f.js";import"./prop-types-d7fd566a.js";import"./reselect-36a88051.js";import"./redux-persist-d9cc1560.js";import"./redux-b7ba668d.js";import"./@reduxjs-4d37e7cf.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-4a70c6fc.js";import"./react-router-dom-4405dfe9.js";import"./@remix-run-d753ad9e.js";import"./icons-material-4539f19e.js";import"./react-icons-55b3b9a0.js";const k={branch:"",date:new Date,from:"",to:"",customer:"",lrList:[],totalFreight:"",freight:"",localFreight:"",cgst:"",cgstPercent:"",sgst:"",sgstPercent:"",total:"",grandTotal:"",remark:""},T={branch:{invalid:!1,message:""},date:{invalid:!1,message:""},customer:{invalid:!1,message:""},lrList:{invalid:!1,message:""},totalFreight:{invalid:!1,message:""},freight:{invalid:!1,message:""},localFreight:{invalid:!1,message:""},cgstPercent:{invalid:!1,message:""},sgstPercent:{invalid:!1,message:""}},Et=()=>{var H,K,M,Z;const _=j(t=>t.user),te=j(ve),{branches:N,customers:s}=j(({bill:t})=>t)||{},[A,re]=g.useState([]),[F,ne]=g.useState([]),[n,b]=g.useState(k),[c,ae]=g.useState(k),[i,w]=g.useState(T),[D,v]=g.useState(""),W=he(),$=Le(),ie=Ne(),{billId:B}=ie.state,Y=g.useCallback(()=>{$("/transactions/billList")},[$]);g.useEffect(()=>{const t=Object.keys(i);if(t!=null&&t.length){const r=document.querySelector(`input[name=${t[0]}]`);r==null||r.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[i]),g.useEffect(()=>{if(D){const t=document.getElementById("alertError");t==null||t.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[D]);const le=(t,r,l,m)=>{W(pe({branch:t,consignor:r,from:l,to:m})).then(({payload:u={}})=>{var P;const{message:o}=(u==null?void 0:u.data)||{};if(o)v(o);else{const a=[...(u==null?void 0:u.data)||[]];(P=a==null?void 0:a.forEach)==null||P.call(a,E=>{var C,S;E.checked=!1,E.consignor=((C=s==null?void 0:s.filter)==null?void 0:C.call(s,d=>d._id===E.consignor)[0])||"",E.consignee=((S=s==null?void 0:s.filter)==null?void 0:S.call(s,d=>d._id===E.consignee)[0])||""}),ne(a)}}).catch(()=>{v("Something went wrong! Please try later or contact Administrator.")})};g.useEffect(()=>{c.branch&&c.customer&&le(c.branch,c.customer,c.from,c.to)},[c.branch,c.customer,c.from,c.to]),g.useEffect(()=>{B&&W(Ee(B)).then(({payload:t={}})=>{const{message:r}=(t==null?void 0:t.data)||{};r?v(r):ae(t==null?void 0:t.data)}).catch(()=>{v("Something went wrong! Please try later or contact Administrator.")})},[B]),g.useEffect(()=>{var t,r,l,m,u,o;if(c._id&&(F!=null&&F.length)&&(s!=null&&s.length)){const P={...c},a=(t=F==null?void 0:F.map)==null?void 0:t.call(F,d=>{var z,R;const I=(R=(z=c.lrList)==null?void 0:z.filter)==null?void 0:R.call(z,ge=>ge._id===d._id);return{...d,checked:!!(I!=null&&I.length)}});let E;B&&(E=(r=a==null?void 0:a.filter)==null?void 0:r.call(a,d=>!d.billGenerated||d.billGenerated&&d.assoBill===B));const C=(l=N==null?void 0:N.find)==null?void 0:l.call(N,d=>d._id===c.branch);P.lrList=(u=(m=P.lrList)==null?void 0:m.map)==null?void 0:u.call(m,d=>{var I;return((I=a==null?void 0:a.filter)==null?void 0:I.call(a,z=>z._id===d._id)[0])||""});const S=(o=s==null?void 0:s.find)==null?void 0:o.call(s,d=>d._id===c.customer);b({...P,branch:C,customer:S}),re(E)}},[c,F,s,B]),g.useEffect(()=>{const t=+n.totalFreight+ +n.freight+ +n.localFreight,r=t+ +n.sgst+ +n.cgst;b(l=>({...l,total:t,grandTotal:r}))},[n.totalFreight,n.freight,n.localFreight,n.sgst,n.cgst]),g.useEffect(()=>{const t=+n.totalFreight+ +n.freight+ +n.localFreight,r=t*+n.cgstPercent/100,l=t*+n.sgstPercent/100;b(m=>({...m,cgst:r,sgst:l}))},[n.cgstPercent,n.sgstPercent,n.totalFreight,n.freight,n.localFreight]),g.useEffect(()=>{var r,l;const t=(l=(r=n.lrList)==null?void 0:r.reduce)==null?void 0:l.call(r,(m,u)=>m+u.total,0);b(m=>({...m,totalFreight:t}))},[n.lrList]);const se=()=>{b(k),v(""),w(T)},me=()=>{Y()},p=t=>{const r=t.target.name,l=t.target.value;b(m=>({...m,[r]:l}))},J=(t,r)=>{b(l=>({...l,[r]:t}))},G=(t,r,l)=>{var m,u;t.preventDefault(),ue(n)||W(Fe({...n,branch:(m=n.branch)==null?void 0:m._id,customer:(u=n.customer)==null?void 0:u._id})).then(({payload:o={}})=>{const{message:P}=(o==null?void 0:o.data)||{};P?v(P):r?W(Pe({id:o==null?void 0:o.data._id,email:""})).then(({payload:a={}})=>{const{message:E}=(a==null?void 0:a.data)||{};if(E&&v(E),a!=null&&a.data.file){const C=Ce(a==null?void 0:a.data.file);if(C){const S=window.open(C,"_blank");S.focus(),S.print(),v(""),w(T),b(k),Y()}}}).catch(a=>{v(a.message)}):l?W(xe({id:o==null?void 0:o.data._id,email:""})).then(({payload:a={}})=>{const{message:E}=(a==null?void 0:a.data)||{};if(E)v(E);else{const C=new Blob([a==null?void 0:a.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Se.saveAs(C,"Bill.xlsx"),v(""),w(T),b(k),Y()}}).catch(a=>{v(a.message)}):(v(""),w(T),b(k),Y())}).catch(o=>{v(o.message)})},oe=t=>{t.preventDefault(),G(t,!0)},ce=t=>{t.preventDefault(),G(t,!1,!0)},ue=t=>{var m;const r={...T};t.branch||(r.branch={invalid:!0,message:"Branch is required"}),t.date||(r.date={invalid:!0,message:"Date is required"}),t.customer||(r.customer={invalid:!0,message:"Customer is required"}),(m=t.lrList)!=null&&m.length||(r.lrList={invalid:!0,message:"At least one lorry receipt is required"}),+t.totalFreight<=0&&(r.totalFreight={invalid:!0,message:"Total freight should be greater than 0"}),+t.freight<0&&(r.freight={invalid:!0,message:"Freight should be 0 or more"}),+t.localFreight<0&&(r.localFreight={invalid:!0,message:"Local freight should be 0 or more"}),+t.cgstPercent<0&&(r.cgstPercent={invalid:!0,message:"CGST % should be 0 or more"}),+t.sgstPercent<0&&(r.sgstPercent={invalid:!0,message:"SGST % should be 0 or more"});let l=!1;for(const u in r)r[u].invalid===!0&&(l=!0);return l&&w(r),l},V=(t,r)=>{b(l=>({...l,[t]:new Date(r)}))},de=()=>{var r;const t=(r=A==null?void 0:A.filter)==null?void 0:r.call(A,l=>l.checked);b(l=>({...l,lrList:t}))};return e.createElement(e.Fragment,null,te&&e.createElement(be,null),e.createElement("div",{className:"inner-wrap"},e.createElement("h1",{className:"pageHead"},"Edit a bill"),D!==""&&e.createElement(Ae,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(Be,{id:"alertError",severity:"error"},D)),e.createElement("form",{action:"",onSubmit:G,id:"billForm"},e.createElement(y,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,size:"small",error:i.branch.invalid},e.createElement(ee,{disablePortal:!0,size:"small",name:"branch",options:N,value:n.branch||null,onChange:(t,r)=>J(r,"branch"),getOptionLabel:t=>t.name,openOnFocus:!0,disabled:_&&_.type&&((K=(H=_.type)==null?void 0:H.toLowerCase)==null?void 0:K.call(H))!=="superadmin"&&((Z=(M=_.type)==null?void 0:M.toLowerCase)==null?void 0:Z.call(M))!=="admin",renderInput:t=>e.createElement(f,{...t,label:"Branch",name:"branch",error:i.branch.invalid,fullWidth:!0})}),i.branch.invalid&&e.createElement(L,null,i.branch.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,size:"small",error:i.customer.invalid},e.createElement(ee,{disablePortal:!0,autoSelect:!0,size:"small",name:"customer",options:s,value:n.customer||null,onChange:(t,r)=>J(r,"customer"),getOptionLabel:t=>t.name,openOnFocus:!0,renderInput:t=>e.createElement(f,{...t,label:"Customer",error:i.customer.invalid,fullWidth:!0})}),i.customer.invalid&&e.createElement(L,null,i.customer.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:i.date.invalid},e.createElement(U,{dateAdapter:Q},e.createElement(X,{error:i.date.invalid,label:"Date",inputFormat:"DD/MM/YYYY",value:n.date,disableFuture:!0,onChange:V.bind(null,"date"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(f,{name:"date",size:"small",...t,error:i.date.invalid})})),i.date.invalid&&e.createElement(L,null,i.date.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(U,{dateAdapter:Q},e.createElement(X,{label:"From",inputFormat:"DD/MM/YYYY",value:n.from||null,maxDate:n.to,disableFuture:!0,onChange:V.bind(null,"from"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(f,{name:"from",size:"small",...t})})))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(U,{dateAdapter:Q},e.createElement(X,{label:"To",inputFormat:"DD/MM/YYYY",value:n.to||null,minDate:n.from,disableFuture:!0,onChange:V.bind(null,"to"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(f,{name:"to",size:"small",...t})}))))))),i.lrList.invalid&&e.createElement("p",{className:"error"},i.lrList.message),e.createElement(y,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement(fe,{lorryReceipts:A,setLRForBill:de,bill:n,setBill:b}),e.createElement(Ie,{sx:{margin:"20px 0"}}),e.createElement("form",{action:"",onSubmit:G,id:"billForm"},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"Total freight",value:n.totalFreight||"",onChange:p,name:"totalFreight",id:"totalFreight",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:i.freight.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"Freight",value:n.freight||"",error:i.freight.invalid,onInput:q,onChange:p,name:"freight",id:"freight",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),maxLength:15}}),i.freight.invalid&&e.createElement(L,null,i.freight.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:i.localFreight.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"Local freight",value:n.localFreight||"",error:i.localFreight.invalid,onChange:p,onInput:q,name:"localFreight",id:"localFreight",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),maxLength:15}}),i.localFreight.invalid&&e.createElement(L,null,i.localFreight.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:i.cgstPercent.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"CGST %",value:n.cgstPercent||"",error:i.cgstPercent.invalid,onChange:p,onInput:q,name:"cgstPercent",id:"cgstPercent",InputProps:{endAdornment:e.createElement(x,{position:"end"},"%"),maxLength:15}}),i.cgstPercent.invalid&&e.createElement(L,null,i.cgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"CGST",value:n.cgst||"",onChange:p,name:"cgst",id:"cgst",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0,error:i.sgstPercent.invalid},e.createElement(f,{size:"small",variant:"outlined",label:"SGST %",value:n.sgstPercent||"",error:i.sgstPercent.invalid,onChange:p,onInput:q,name:"sgstPercent",id:"sgstPercent",InputProps:{endAdornment:e.createElement(x,{position:"end"},"%"),maxLength:15}}),i.sgstPercent.invalid&&e.createElement(L,null,i.sgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"SGST",value:n.sgst||"",onChange:p,name:"sgst",id:"sgst",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"Total",value:n.total||"",onChange:p,name:"total",id:"total",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",type:"number",variant:"outlined",label:"Grand total",value:n.grandTotal||"",onChange:p,name:"grandTotal",id:"grandTotal",InputProps:{startAdornment:e.createElement(x,{position:"start"},"₹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(h,{fullWidth:!0},e.createElement(f,{size:"small",variant:"outlined",label:"Remark",value:n.remark,onChange:p,name:"remark",id:"remark",inputProps:{maxLength:200}}))))),e.createElement("div",{className:"right"},e.createElement(O,{variant:"outlined",size:"medium",onClick:me},"Back"),e.createElement(O,{variant:"outlined",size:"medium",onClick:se,className:"ml6"},"Reset"),e.createElement(O,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"billForm",className:"ml6"},"Save"),e.createElement(O,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:oe},"Save & Print")," ",e.createElement(O,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:ce},"export to excel sheet")))))};export{Et as default};
