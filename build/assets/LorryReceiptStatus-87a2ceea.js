import{r as s,a as t}from"./react-bfabd40c.js";import{u as G,a as se}from"./react-redux-45d870ba.js";import{h as oe}from"./icons-material-4539f19e.js";import{L as j,A as q,D as Q}from"./x-date-pickers-7b1cc7dd.js";import{F as me}from"./file-saver-7e589f53.js";import{cW as ce,cX as le,cY as ue,cZ as de,a4 as pe,L as ge,b5 as fe,c_ as he}from"./index-66f971e4.js";import"./Card.module-3bdbfb7f.js";import{i as v,A as xe,h as C,O as Ee,Q as be,a as V,a1 as Se,a2 as w,l as z}from"./material-e0a59a28.js";import{G as g}from"./@material-ui-774e3213.js";import{D as Ne}from"./x-data-grid-cceece3f.js";import"./@babel-e11bafe1.js";import"./react-dom-b0178e93.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-6cfbf744.js";import"./use-sync-external-store-18921cc2.js";import"./@date-io-f382d426.js";import"./dayjs-7f45ce31.js";import"./utils-c03c978f.js";import"./clsx-1229b3e0.js";import"./base-ff50cfe3.js";import"./@popperjs-f3391c26.js";import"./rifm-7b0f12ad.js";import"./system-a1d29c52.js";import"./styled-engine-f3bd09bf.js";import"./@emotion-77835cc8.js";import"./stylis-79144faa.js";import"./private-theming-970ac73c.js";import"./react-transition-group-7ded6f4d.js";import"./dom-helpers-9a525042.js";import"./redux-persist-d9cc1560.js";import"./redux-b7ba668d.js";import"./@reduxjs-4d37e7cf.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-4a70c6fc.js";import"./react-router-622b2d59.js";import"./@remix-run-d753ad9e.js";import"./react-router-dom-60901e53.js";import"./react-icons-55b3b9a0.js";import"./jss-7659e388.js";import"./is-in-browser-9e40da8a.js";import"./jss-plugin-rule-value-function-051edbeb.js";import"./jss-plugin-global-64559e95.js";import"./jss-plugin-nested-6377d8b0.js";import"./jss-plugin-camel-case-92f9f32c.js";import"./hyphenate-style-name-80972348.js";import"./jss-plugin-default-unit-593cc4c5.js";import"./jss-plugin-vendor-prefixer-4dd06b33.js";import"./css-vendor-33142dc8.js";import"./jss-plugin-props-sort-0c9fca2f.js";import"./prop-types-d7fd566a.js";import"./reselect-36a88051.js";const F={consignor:null,consignee:null,from:null,to:null,payType:"",searchText:""},Nt=()=>{var O;const R=[{field:"_id",headerName:"Id"},{field:"srNo",headerName:"Sr No."},{field:"lrNo",headerName:"Consign No",flex:1},{field:"date",headerName:"Consign Date",flex:1},{field:"consignorName",headerName:"Consignor Name",flex:1},{field:"from",headerName:"From",flex:1},{field:"consigneeName",headerName:"Consignee Name",flex:1},{field:"to",headerName:"To",flex:1},{field:"payType",headerName:"Payment Mode",flex:1}],X=G(ce),h=se(),f=G(e=>e.user),[Te,Z]=s.useState([]),[J,K]=s.useState([]),[A,o]=s.useState(""),[c,B]=s.useState(null),[a,x]=s.useState(F),[P,u]=s.useState(!1),[d,U]=s.useState({page:0,pageSize:100}),[E,$]=s.useState({isLoading:!1,data:[],total:0}),[y,L]=s.useState(!1);s.useEffect(()=>{h(le()).then(({payload:e={}})=>{var r,i;const{message:n}=(e==null?void 0:e.data)||{};if(n)o(n);else{o("");const m=(i=(r=e==null?void 0:e.data)==null?void 0:r.map)==null?void 0:i.call(r,l=>({...l,label:l.name}));Z(m)}}).catch(e=>{o(e.message)}),h(ue()).then(({payload:e={}})=>{var r,i;const{message:n}=(e==null?void 0:e.data)||{};if(n)o(n);else if(o(""),K(e==null?void 0:e.data),f&&f.branch){const m=(i=(r=e==null?void 0:e.data)==null?void 0:r.find)==null?void 0:i.call(r,l=>l._id===f.branch);B(m)}}).catch(e=>{o(e.message)})},[]),s.useEffect(()=>{if(P&&(f.branch&&c||!f.branch)){L(!0);const e={};c&&c._id&&(e.branch=c._id),a.consignor&&a.consignor._id&&(e.consignor=a.consignor._id),a.consignee&&a.consignee._id&&(e.consignee=a.consignee._id),a.from&&(e.from=a.from),a.to&&(e.to=a.to),a.payType&&(e.payType=a.payType),a.searchText&&(e.searchText=a.searchText);const n={pagination:{limit:d.pageSize?d.pageSize:100,page:d.page+1},query:e};h(de(n)).then(({payload:r={}})=>{var m,l;L(!1);const{message:i}=(r==null?void 0:r.data)||{};if(i)o(i);else{const ne=(l=(m=r==null?void 0:r.data.lorryReceipts)==null?void 0:m.map)==null?void 0:l.call(m,(p,ie)=>{var b,Y,S,H,N,k,T,W;return{...p,srNo:ie+1,date:pe(new Date(p.date)),totalWeight:(H=(S=(Y=(b=p.transactions)==null?void 0:b.reduce)==null?void 0:Y.call(b,(_,D)=>_+D.chargeWeight,0))==null?void 0:S.toFixed)==null?void 0:H.call(S,2),totalArticles:(W=(T=(k=(N=p.transactions)==null?void 0:N.reduce)==null?void 0:k.call(N,(_,D)=>_+D.articleNo,0))==null?void 0:T.toFixed)==null?void 0:W.call(T,2)}});$(p=>({...p,isLoading:!1,data:ne,total:r==null?void 0:r.data.count}))}u(!1)}).catch(r=>{u(!1),o(r.message),L(!1)})}},[d.page,d.pageSize,c,P]);const ee=(e,n)=>{B(n),u(!1),x(F)},te=e=>{e.preventDefault(),u(!0)},M=(e,n)=>{x(r=>({...r,[e]:new Date(n)}))},re=e=>{e.preventDefault(),x(F),u(!0)},ae=e=>{e.preventDefault();const n={};c&&c._id&&(n.branch=c._id),a.consignor&&a.consignor._id&&(n.consignor=a.consignor._id),a.consignee&&a.consignee._id&&(n.consignee=a.consignee._id),a.from&&(n.from=a.from),a.to&&(n.to=a.to),a.payType&&(n.payType=a.payType),a.searchText&&(n.searchText=a.searchText),h(he(n)).then(({payload:r={}})=>{const{message:i}=(r==null?void 0:r.data)||{};if(i)o(i);else{const m=new Blob([r==null?void 0:r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});me.saveAs(m,"LoadedLorryReceipts.xlsx")}}).catch(r=>{o(r.message)})},I=(e,n="payType")=>{x(r=>({...r,[n]:e.target.value}))};return t.createElement(t.Fragment,null,(X||y)&&t.createElement(ge,null),t.createElement("div",{className:"inner-wrap"},t.createElement("div",{className:"page_head-1",style:{display:"flex",justifyContent:"space-between"}},t.createElement("h1",{className:"pageHead"},"Loaded Lorry Receipt Status"),t.createElement("div",{className:""},t.createElement(v,{size:"small",sx:{width:"230px",marginRight:"5px",marginBottom:"20px"}},t.createElement(xe,{disablePortal:!0,size:"small",name:"branch",options:J,value:c||null,onChange:ee,disabled:!fe(),getOptionLabel:e=>e.name,openOnFocus:!0,renderInput:e=>t.createElement(C,{...e,label:"Select branch",fullWidth:!0})})))),A!==""&&t.createElement(Ee,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},t.createElement(be,{severity:"error"},A)),t.createElement(V,{sx:{padding:"20px",marginBottom:"20px"}},t.createElement("h2",{className:"mb20"},"Search"),t.createElement("form",{action:"",onSubmit:te},t.createElement(g,{container:!0,spacing:3},t.createElement(g,{item:!0,xs:3},t.createElement(v,{fullWidth:!0},t.createElement(j,{dateAdapter:q},t.createElement(Q,{label:"From",inputFormat:"DD/MM/YYYY",value:a.from,onChange:M.bind(null,"from"),renderInput:e=>t.createElement(C,{name:"from",size:"small",...e})})))),t.createElement(g,{item:!0,xs:3},t.createElement(v,{fullWidth:!0},t.createElement(j,{dateAdapter:q},t.createElement(Q,{label:"To",inputFormat:"DD/MM/YYYY",value:a.to,onChange:M.bind(null,"to"),renderInput:e=>t.createElement(C,{name:"to",size:"small",...e})})))),t.createElement(g,{item:!0,xs:2},t.createElement(Se,{color:"primary",value:a.payType,exclusive:!0,onChange:e=>I(e,"payType"),"aria-label":"Platform",size:"small"},t.createElement(w,{value:""},"All"),t.createElement(w,{value:"Open"},"Open"),t.createElement(w,{value:"Closed"},"Closed"))),t.createElement(g,{item:!0,xs:3},t.createElement(v,{fullWidth:!0},t.createElement(C,{size:"small",variant:"outlined",label:"Search in List By Consign No/Constomer Name",value:a.searchText,onChange:e=>I(e,"searchText"),name:"searchText",id:"searchText",inputProps:{maxLength:50}}))),t.createElement(g,{style:{display:"flex"},item:!0,xs:3},t.createElement(z,{type:"submit",variant:"contained",size:"medium",color:"primary"},"Search"),t.createElement(z,{type:"button",variant:"outlined",size:"medium",className:"ml6",onClick:e=>re(e)},"Reset"))))),t.createElement(V,{sx:{width:"100%"}},((O=E.data)==null?void 0:O.length)>0?t.createElement("div",{className:"tbl_header"},t.createElement(z,{variant:"contained",endIcon:t.createElement(oe,null),onClick:ae},"Download")):null,t.createElement(Ne,{autoHeight:!0,density:"compact",rows:E.data,rowCount:E.total,loading:E.isLoading,pageSizeOptions:[100],paginationModel:d,onPaginationModelChange:e=>{U(e),u(!0)},paginationMode:"server",columns:R,getRowId:e=>e._id,sx:{backgroundColor:"primary.contrastText"},initialState:{...R,columns:{columnVisibilityModel:{_id:!1}}},disableSelectionOnClick:!0}))))};export{Nt as default};
