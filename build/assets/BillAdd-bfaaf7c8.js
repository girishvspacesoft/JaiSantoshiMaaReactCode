import{r as h,a as e}from"./react-bfabd40c.js";import{u as _,a as ne}from"./react-redux-45d870ba.js";import{L as G,A as H,D as M}from"./x-date-pickers-7b1cc7dd.js";import{L as ie}from"./LorryReceipts-4f1738e2.js";import"./Card.module-3bdbfb7f.js";import{bN as le,bT as se,L as oe,al as S,bU as me,bP as ce,b3 as de,bV as ue}from"./index-5f564d13.js";import{F as ge}from"./file-saver-7e589f53.js";import{b as he,a as fe}from"./react-router-1b5f20a2.js";import{O as ve,Q as Ee,a as U,i as m,A as Q,h as c,V as F,D as pe,m as p,l as A}from"./material-e0a59a28.js";import"./@babel-e11bafe1.js";import"./react-dom-b0178e93.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-6cfbf744.js";import"./use-sync-external-store-18921cc2.js";import"./@date-io-f382d426.js";import"./dayjs-7f45ce31.js";import"./utils-c03c978f.js";import"./clsx-1229b3e0.js";import"./base-ff50cfe3.js";import"./@popperjs-f3391c26.js";import"./rifm-7b0f12ad.js";import"./system-a1d29c52.js";import"./styled-engine-f3bd09bf.js";import"./@emotion-77835cc8.js";import"./stylis-79144faa.js";import"./private-theming-970ac73c.js";import"./react-transition-group-7ded6f4d.js";import"./dom-helpers-9a525042.js";import"./x-data-grid-cceece3f.js";import"./prop-types-d7fd566a.js";import"./reselect-36a88051.js";import"./redux-persist-d9cc1560.js";import"./redux-b7ba668d.js";import"./@reduxjs-4d37e7cf.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-4a70c6fc.js";import"./react-router-dom-4405dfe9.js";import"./@remix-run-d753ad9e.js";import"./icons-material-4539f19e.js";import"./react-icons-55b3b9a0.js";const I={branch:"",date:new Date,from:"",to:"",customer:"",lrList:[],totalFreight:"",freight:"",localFreight:"",cgst:"",cgstPercent:"",sgst:"",sgstPercent:"",total:"",grandTotal:"",remark:""},L={branch:{invalid:!1,message:""},date:{invalid:!1,message:""},customer:{invalid:!1,message:""},lrList:{invalid:!1,message:""},totalFreight:{invalid:!1,message:""},freight:{invalid:!1,message:""},localFreight:{invalid:!1,message:""},cgstPercent:{invalid:!1,message:""},sgstPercent:{invalid:!1,message:""}},lt=()=>{var w,V,O,j;const $=_(le),{branches:J,customers:f}=_(({bill:t})=>t)||{},z=_(t=>t.user),{state:K}=he(),[P,X]=h.useState([]),[r,d]=h.useState({...I,branch:K}),[n,C]=h.useState(L),[k,g]=h.useState(""),T=ne(),q=fe(),B=h.useCallback(()=>{q("/transactions/billList")},[q]);h.useEffect(()=>{const t=Object.keys(n);if(t!=null&&t.length){const a=document.querySelector(`input[name=${t[0]}]`);a==null||a.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[n]),h.useEffect(()=>{if(k){const t=document.getElementById("alertError");t==null||t.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},[k]),h.useEffect(()=>{var t,a;r.branch&&r.customer&&T(se({branch:(t=r.branch)==null?void 0:t._id,consignor:(a=r.customer)==null?void 0:a._id,from:r.from,to:r.to})).then(({payload:i={}})=>{var v,u,x;const{message:s}=(i==null?void 0:i.data)||{};if(s)g(s);else{const l=(u=(v=i==null?void 0:i.data)==null?void 0:v.filter)==null?void 0:u.call(v,o=>!o.billGenerated);(x=l==null?void 0:l.forEach)==null||x.call(l,o=>{var b,N;o.checked=!1,o.consignor=((b=f==null?void 0:f.filter)==null?void 0:b.call(f,Y=>Y._id===o.consignor)[0])||"",o.consignee=((N=f==null?void 0:f.filter)==null?void 0:N.call(f,Y=>Y._id===o.consignee)[0])||""}),X(l),d(o=>({...o,lrList:[]}))}}).catch(()=>{g("Something went wrong! Please try later or contact Administrator.")})},[r.branch,r.customer,r.from,r.to]),h.useEffect(()=>{var a,i;let t=0;(i=(a=r.lrList)==null?void 0:a.forEach)==null||i.call(a,s=>{t+=+s.total}),d(s=>({...s,totalFreight:t}))},[r.lrList]),h.useEffect(()=>{const t=+r.totalFreight+ +r.freight+ +r.localFreight,a=t+ +r.sgst+ +r.cgst;d(i=>({...i,total:t,grandTotal:a}))},[r.totalFreight,r.freight,r.localFreight,r.sgst,r.cgst]),h.useEffect(()=>{const t=+r.totalFreight+ +r.freight+ +r.localFreight,a=t*+r.cgstPercent/100,i=t*+r.sgstPercent/100;d(s=>({...s,cgst:a,sgst:i}))},[r.cgstPercent,r.sgstPercent,r.totalFreight,r.freight,r.localFreight]),h.useEffect(()=>{var a,i;const t=(i=(a=r.lrList)==null?void 0:a.reduce)==null?void 0:i.call(a,(s,v)=>s+v.total,0);d(s=>({...s,totalFreight:t}))},[r.lrList]);const Z=()=>{d(I),g(""),C(L)},y=()=>{B()},E=t=>{const a=t.target.name,i=t.target.value;d(s=>({...s,[a]:i}))},R=(t,a)=>{d(i=>({...i,[a]:t}))},W=(t,a,i)=>{var s,v;t.preventDefault(),re(r)||T(me({...r,branch:(s=r.branch)==null?void 0:s._id,customer:(v=r.customer)==null?void 0:v._id})).then(({payload:u={}})=>{const{message:x}=(u==null?void 0:u.data)||{};x?g(x):a?T(ce({id:u==null?void 0:u.data._id,email:""})).then(({payload:l={}})=>{const{message:o}=(l==null?void 0:l.data)||{};if(o&&g(o),l!=null&&l.data.file){const b=de(l==null?void 0:l.data.file);if(b){const N=window.open(b,"_blank");N.focus(),N.print(),g(""),C(L),d(I),B()}}}).catch(l=>{g(l.message)}):i?T(ue({id:u==null?void 0:u.data._id,email:""})).then(({payload:l={}})=>{const{message:o}=(l==null?void 0:l.data)||{};if(o)g(o);else{const b=new Blob([l==null?void 0:l.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});ge.saveAs(b,"Bill.xlsx"),g(""),C(L),d(I),B()}}).catch(l=>{g(l.message)}):(g(""),C(L),d(I),B())}).catch(u=>{g(u.message)})},ee=t=>{t.preventDefault(),W(t,!0)},te=t=>{t.preventDefault(),W(t,!1,!0)},re=t=>{var s;const a={...L};t.branch||(a.branch={invalid:!0,message:"Branch is required"}),t.date||(a.date={invalid:!0,message:"Date is required"}),t.customer||(a.customer={invalid:!0,message:"Customer is required"}),(s=t.lrList)!=null&&s.length||(a.lrList={invalid:!0,message:"At least one lorry receipt is required"}),+t.totalFreight<=0&&(a.totalFreight={invalid:!0,message:"Total freight should be greater than 0"}),+t.freight<0&&(a.freight={invalid:!0,message:"Freight should be 0 or more"}),+t.localFreight<0&&(a.localFreight={invalid:!0,message:"Local freight should be 0 or more"}),+t.cgstPercent<0&&(a.cgstPercent={invalid:!0,message:"CGST % should be 0 or more"}),+t.sgstPercent<0&&(a.sgstPercent={invalid:!0,message:"SGST % should be 0 or more"});let i=!1;for(const v in a)a[v].invalid===!0&&(i=!0);return i&&C(a),i},D=(t,a)=>{d(i=>({...i,[t]:new Date(a)}))},ae=()=>{var a;const t=(a=P==null?void 0:P.filter)==null?void 0:a.call(P,i=>i.checked);d(i=>({...i,lrList:t}))};return e.createElement(e.Fragment,null,$&&e.createElement(oe,null),e.createElement("h1",{className:"pageHead"},"Add a bill"),e.createElement("div",{className:"inner-wrap"},k!==""&&e.createElement(ve,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},e.createElement(Ee,{id:"alertError",severity:"error"},k)),e.createElement("form",{action:"",onSubmit:W,id:"billForm"},e.createElement(U,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0,size:"small",error:n.branch.invalid},e.createElement(Q,{disablePortal:!0,size:"small",name:"branch",options:J,value:r.branch,onChange:(t,a)=>R(a,"branch"),getOptionLabel:t=>t.name,openOnFocus:!0,disabled:z&&z.type&&((V=(w=z.type)==null?void 0:w.toLowerCase)==null?void 0:V.call(w))!=="superadmin"&&((j=(O=z.type)==null?void 0:O.toLowerCase)==null?void 0:j.call(O))!=="admin",renderInput:t=>e.createElement(c,{...t,label:"Branch",name:"branch",error:n.branch.invalid,fullWidth:!0})}),n.branch.invalid&&e.createElement(F,null,n.branch.message))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0,size:"small",error:n.customer.invalid},e.createElement(Q,{disablePortal:!0,autoSelect:!0,size:"small",name:"customer",options:f,value:r.customer||null,onChange:(t,a)=>R(a,"customer"),getOptionLabel:t=>t.name,openOnFocus:!0,renderInput:t=>e.createElement(c,{...t,label:"Customer",error:n.customer.invalid,fullWidth:!0})}),n.customer.invalid&&e.createElement(F,null,n.customer.message))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0,error:n.date.invalid},e.createElement(G,{dateAdapter:H},e.createElement(M,{error:n.date.invalid,label:"Date",inputFormat:"DD/MM/YYYY",value:r.date,disableFuture:!0,onChange:D.bind(null,"date"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(c,{name:"date",size:"small",...t,error:n.date.invalid})})),n.date.invalid&&e.createElement(F,null,n.date.message))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0},e.createElement(G,{dateAdapter:H},e.createElement(M,{label:"From",inputFormat:"DD/MM/YYYY",value:r.from||null,disableFuture:!0,maxDate:r.to,onChange:D.bind(null,"from"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(c,{name:"from",size:"small",...t})})))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0},e.createElement(G,{dateAdapter:H},e.createElement(M,{label:"To",inputFormat:"DD/MM/YYYY",value:r.to||null,disableFuture:!0,minDate:r.from,onChange:D.bind(null,"to"),inputProps:{readOnly:!0},renderInput:t=>e.createElement(c,{name:"to",size:"small",...t})}))))))),n.lrList.invalid&&e.createElement("p",{className:"error"},n.lrList.message),e.createElement(U,{sx:{padding:"20px",marginBottom:"20px"}},e.createElement(ie,{lorryReceipts:P,setLRForBill:ae,bill:r,setBill:d}),e.createElement(pe,{sx:{margin:"20px 0"}}),e.createElement("form",{action:"",onSubmit:W,id:"billForm"},e.createElement("div",{className:"grid grid-6-col"},e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0},e.createElement(c,{size:"small",type:"number",variant:"outlined",label:"Total freight",value:r.totalFreight||"",onChange:E,name:"totalFreight",id:"totalFreight",InputProps:{startAdornment:e.createElement(p,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0,error:n.freight.invalid},e.createElement(c,{size:"small",type:"text",variant:"outlined",label:"Freight",value:r.freight||"",error:n.freight.invalid,onInput:S,onChange:E,name:"freight",id:"freight",InputProps:{maxLength:12,startAdornment:e.createElement(p,{position:"start"},"â‚¹")}}),n.freight.invalid&&e.createElement(F,null,n.freight.message))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0,error:n.localFreight.invalid},e.createElement(c,{size:"small",variant:"outlined",label:"Local freight",value:r.localFreight||"",error:n.localFreight.invalid,onChange:E,onInput:S,name:"localFreight",id:"localFreight",InputProps:{startAdornment:e.createElement(p,{position:"start"},"â‚¹"),maxLength:15}}),n.localFreight.invalid&&e.createElement(F,null,n.localFreight.message))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0,error:n.cgstPercent.invalid},e.createElement(c,{size:"small",variant:"outlined",label:"CGST %",value:r.cgstPercent||"",error:n.cgstPercent.invalid,onChange:E,onInput:S,name:"cgstPercent",id:"cgstPercent",InputProps:{endAdornment:e.createElement(p,{position:"end"},"%"),maxLength:15}}),n.cgstPercent.invalid&&e.createElement(F,null,n.cgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0},e.createElement(c,{size:"small",variant:"outlined",label:"CGST",value:r.cgst||"",onChange:E,onInput:S,name:"cgst",id:"cgst",InputProps:{startAdornment:e.createElement(p,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0,error:n.sgstPercent.invalid},e.createElement(c,{size:"small",variant:"outlined",label:"SGST %",value:r.sgstPercent||"",error:n.sgstPercent.invalid,onChange:E,onInput:S,name:"sgstPercent",id:"sgstPercent",InputProps:{endAdornment:e.createElement(p,{position:"end"},"%"),maxLength:15}}),n.sgstPercent.invalid&&e.createElement(F,null,n.sgstPercent.message))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0},e.createElement(c,{size:"small",variant:"outlined",label:"SGST",value:r.sgst||"",onChange:E,name:"sgst",id:"sgst",InputProps:{startAdornment:e.createElement(p,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0},e.createElement(c,{size:"small",variant:"outlined",label:"Total",value:r.total||"",onChange:E,name:"total",id:"total",InputProps:{startAdornment:e.createElement(p,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0},e.createElement(c,{size:"small",type:"number",variant:"outlined",label:"Grand total",value:r.grandTotal||"",onChange:E,name:"grandTotal",id:"grandTotal",InputProps:{startAdornment:e.createElement(p,{position:"start"},"â‚¹"),readOnly:!0}}))),e.createElement("div",{className:"grid-item"},e.createElement(m,{fullWidth:!0},e.createElement(c,{size:"small",variant:"outlined",label:"Remark",value:r.remark,onChange:E,name:"remark",id:"remark",inputProps:{maxLength:200}}))))),e.createElement("div",{className:"right"},e.createElement(A,{variant:"outlined",size:"medium",onClick:y},"Back"),e.createElement(A,{variant:"outlined",size:"medium",onClick:Z,className:"ml6"},"Reset"),e.createElement(A,{variant:"contained",size:"medium",type:"submit",color:"primary",form:"billForm",className:"ml6"},"Save"),e.createElement(A,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:ee},"Save & Print"),e.createElement(A,{variant:"contained",size:"medium",type:"button",color:"primary",form:"billForm",className:"ml6",onClick:te},"export to excel sheet")))))};export{lt as default};
