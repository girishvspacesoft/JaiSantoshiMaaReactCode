import{r as n,a as t}from"./react-69b9bddd.js";import{a as ce,u as _}from"./react-redux-13959126.js";import{c as me,h as de,i as ue,j as ge,e as fe,f as he}from"./icons-material-40f8e5d8.js";import"./Card.module-3bdbfb7f.js";import{C as pe}from"./Dialog-c8953a08.js";import{bm as Se,bn as Ee,bo as be,bp as Le,bq as we,br as xe,bs as V,b5 as Ce,bt as Ne,b6 as ve,L as _e,k as q,bu as De,a5 as Fe,bv as Ae,ba as Pe,bw as Ie}from"./index-1d9d8716.js";import{S as Oe}from"./SendEmail-af9be518.js";import{a as ze}from"./react-router-7dadf37a.js";import{u as ke,D as Be,G as Re}from"./x-data-grid-83fc2422.js";import{j as Te}from"./utils-49fe0532.js";import{i as Me,A as je,h as Q,l as He,O as $e,Q as Ge,m as Ve,f as h}from"./material-04052d9a.js";import"./@babel-5e587562.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-20ba4de3.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./react-icons-6bc9af43.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./stylis-79144faa.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./base-e8cfb5a9.js";import"./@popperjs-f3391c26.js";import"./prop-types-b6d0a120.js";import"./reselect-36a88051.js";const Dt=()=>{const D=[{field:"_id",headerName:"Id",flex:1},{field:"lsNo",headerName:"LS no.",flex:1},{field:"date",headerName:"Date",flex:1},{field:"vehicleNo",headerName:"Vehicle no.",width:120,flex:1},{field:"fromName",headerName:"From",flex:1},{field:"toName",headerName:"To",flex:1},{field:"totalFreight",headerName:"Hire amount",flex:1},{field:"totalPayable",headerName:"Balance",flex:1},{field:"actions",headerName:"Action",sortable:!1,minWidth:200,renderCell:e=>{const a=s=>{s.stopPropagation(),M({...e.row,download:!1})},i=s=>{s.stopPropagation(),M({...e.row,download:!0})},r=s=>{s.stopPropagation(),S(!0),E({...e.row})},c=s=>(s.stopPropagation(),oe(e.row._id)),u=s=>(s.stopPropagation(),le(e.row._id));return t.createElement(t.Fragment,null,t.createElement(h,{size:"small",onClick:i,color:"primary"},t.createElement(de,null)),t.createElement(h,{size:"small",onClick:a,color:"primary"},t.createElement(ue,null)),t.createElement(h,{size:"small",onClick:r,color:"primary"},t.createElement(ge,null)),t.createElement(h,{size:"small",onClick:c,color:"primary"},t.createElement(fe,null)),q()?t.createElement(h,{size:"small",onClick:u,color:"error"},t.createElement(he,null)):null)},flex:1}],o=ce(),F=ze(),U=_(Se),A=_(e=>e.user),[W,J]=n.useState([]),[g,P]=n.useState(null),[,K]=n.useState([]),[I,l]=n.useState(""),[X,p]=n.useState(!1),[O,z]=n.useState(""),[qe,k]=n.useState(""),[m,B]=n.useState(null),[Y,S]=n.useState(!1),[R,x]=n.useState(!1),[C,Z]=n.useState(""),[N,E]=n.useState(null),[y,T]=n.useState(!1),{search:b}=_(({loadingslip:e})=>e),v=ke(),[d,ee]=n.useState({page:0,pageSize:100}),[f,te]=n.useState({isLoading:!1,data:[],total:0}),M=e=>{B(e)};n.useEffect(()=>{o(Ee()).then(({payload:e={}})=>{var i,r,c;const{message:a}=(e==null?void 0:e.data)||{};if(a)l(a);else if(l(""),J(e==null?void 0:e.data),(i=e==null?void 0:e.data)!=null&&i.length){const u=(c=(r=e==null?void 0:e.data)==null?void 0:r.find)==null?void 0:c.call(r,s=>s._id===A.branch);P(u)}}).catch(()=>{l("Something went wrong! Please try later or contact Administrator.")}),o(be()),o(Le()),o(we()),o(xe())},[A.branch]);const j=()=>{const e={branch:g._id,pagination:{limit:d.pageSize?d.pageSize:100,page:d.page+1}};o(De(e)).then(({payload:a={}})=>{var r,c;const{message:i}=(a==null?void 0:a.data)||{};if(i)l(i);else{const u=(c=(r=a==null?void 0:a.data.loadingSlips)==null?void 0:r.filter)==null?void 0:c.call(r,s=>{var L,$,w,G;return s.date=Fe(new Date(s.createdAt)),s.totalFreight=($=(L=s.totalFreight)==null?void 0:L.toFixed)==null?void 0:$.call(L,2),s.totalPayable=(G=(w=s.totalPayable)==null?void 0:w.toFixed)==null?void 0:G.call(w,2),!s.isLocalMemo});K(u),te(s=>({...s,isLoading:!1,data:u,total:a==null?void 0:a.data.count}))}}).catch(a=>{l(a.message)})};n.useEffect(()=>{g&&j()},[g,d.page,d.pageSize]),n.useEffect(()=>{m&&m._id&&o(V({id:m._id,email:""})).then(({payload:e={}})=>{var i;const{message:a}=(e==null?void 0:e.data)||{};if(a)l(a);else{if((i=e==null?void 0:e.data)!=null&&i.file){const r=Ce(e==null?void 0:e.data.file),c=Ne(m.lsNo)+".pdf";m.download?ve(r,c):window.open(r,"_blank")}B(null)}}).catch(e=>{l(e.message)})},[m]),n.useEffect(()=>{R&&C&&N&&(S(!1),o(V({id:N._id,email:C})).then(({payload:e={}})=>{const{message:a}=(e==null?void 0:e.data)||{};a&&l(a),x(!1),E(null)}).catch(e=>{l(e.message),x(!1),E(null)}))},[R,C,N]);const H=n.useMemo(()=>Te(e=>{var a,i,r;v.current.setQuickFilterValues((r=(i=(a=e.split)==null?void 0:a.call(e," "))==null?void 0:i.filter)==null?void 0:r.call(i,c=>c!==""))},500),[v]);n.useEffect(()=>{var e;b&&((e=f.data)!=null&&e.length)&&(T(!0),H(b),setTimeout(()=>{T(!1)},500))},[f.data]);const ae=e=>{H(e.target.value),o(Ae(e.target.value))},se=e=>{x(!0),Z(e)},ne=(e,a)=>{P(a),o(Pe(a._id))},ie=e=>{p(!0),e.target.value==="true"?(k(O),o(Ie(O)).then(({payload:a={}})=>{const{message:i}=(a==null?void 0:a.data)||{};i?l(i):j(),p(!1)}).catch(()=>{l("Something went wrong! Please try later or contact Administrator.")})):(k(""),z("")),p(!1)},re=()=>{F("/transactions/loadingSlips/addLoadingSlip",{state:g})},oe=e=>{F("/transactions/loadingSlips/editLoadingSlip",{state:{lsId:e}})},le=e=>{z(e),p(!0)};return t.createElement(t.Fragment,null,(U||y)&&t.createElement(_e,null),t.createElement("div",{className:"inner-wrap"},X&&t.createElement(pe,{isOpen:!0,onClose:ie,title:"Are you sure?",content:"Do you want to delete the loading slip?",warning:!0}),t.createElement("div",{className:"page_head"},t.createElement("h1",{className:"pageHead"},"Lorry Freight Challan List"),t.createElement("div",{className:"page_actions"},t.createElement(Me,{size:"small",sx:{width:"230px",marginRight:"5px"}},t.createElement(je,{disablePortal:!0,size:"small",name:"branch",className:"multi-select",options:W,value:g||null,onChange:ne,disabled:!q(),getOptionLabel:e=>e.name,openOnFocus:!0,renderInput:e=>t.createElement(Q,{...e,label:"Select branch",fullWidth:!0})})),t.createElement(He,{variant:"contained",size:"small",type:"button",color:"primary",className:"ml6",onClick:re},"Add challan"))),I!==""&&t.createElement($e,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},t.createElement(Ge,{severity:"error"},I)),t.createElement("div",{style:{width:"100%"}},t.createElement(Be,{apiRef:v,autoHeight:!0,density:"compact",rows:f.data,rowCount:f.total,loading:f.isLoading,pageSizeOptions:[100],paginationModel:d,onPaginationModelChange:ee,paginationMode:"server",columns:D,getRowId:e=>e._id,sx:{backgroundColor:"primary.contrastText"},initialState:{...D,columns:{columnVisibilityModel:{_id:!1}}},disableSelectionOnClick:!0,disableColumnFilter:!0,disableColumnSelector:!0,disableDensitySelector:!0,components:{Toolbar:()=>t.createElement(Re,{sx:{gap:"6px",mb:"10px",justifyContent:"end",border:"none"}},t.createElement(Q,{variant:"standard",placeholder:"Search...",autoFocus:!!b,onChange:ae,value:b,InputProps:{startAdornment:t.createElement(Ve,{position:"start"},t.createElement(me,null))}}))}})),t.createElement(Oe,{isOpen:Y,setIsOpen:S,handleEmailClose:()=>{S(!1),E(null)},handleSendEmail:e=>se(e),contentBody:""})))};export{Dt as default};
