import{r as a,a as s}from"./react-bfabd40c.js";import{a as ae,u as v}from"./react-redux-45d870ba.js";import{c as ie,h as le,i as oe,j as ce,e as me,f as ue}from"./icons-material-4539f19e.js";import"./Card.module-3bdbfb7f.js";import{C as de}from"./Dialog-cfe6f9ef.js";import{bN as ge,bO as fe,bP as M,b3 as he,bq as $,b4 as Ee,L as pe,b5 as be,bQ as Se,a4 as Ce,bR as we,bS as xe}from"./index-4082e4b8.js";import{S as Be}from"./SendEmail-290ca6a5.js";import{a as _e}from"./react-router-622b2d59.js";import{u as Ne,D as ve,G as De}from"./x-data-grid-cceece3f.js";import{j as Oe}from"./utils-c03c978f.js";import{i as Ae,A as Le,h as j,l as ze,O as Ie,Q as Fe,m as Pe,f as h}from"./material-e0a59a28.js";import"./@babel-e11bafe1.js";import"./react-dom-b0178e93.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-6cfbf744.js";import"./use-sync-external-store-18921cc2.js";import"./redux-persist-d9cc1560.js";import"./redux-b7ba668d.js";import"./@reduxjs-4d37e7cf.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-4a70c6fc.js";import"./react-router-dom-60901e53.js";import"./@remix-run-d753ad9e.js";import"./react-icons-55b3b9a0.js";import"./system-a1d29c52.js";import"./styled-engine-f3bd09bf.js";import"./@emotion-77835cc8.js";import"./stylis-79144faa.js";import"./private-theming-970ac73c.js";import"./react-transition-group-7ded6f4d.js";import"./dom-helpers-9a525042.js";import"./base-ff50cfe3.js";import"./@popperjs-f3391c26.js";import"./clsx-1229b3e0.js";import"./prop-types-d7fd566a.js";import"./reselect-36a88051.js";const bt=()=>{const D=[{field:"_id",headerName:"Id"},{field:"billNo",headerName:"Bill no.",flex:1},{field:"date",headerName:"Date",flex:1},{field:"customer",headerName:"Customer",flex:1},{field:"total",headerName:"Bill amount",flex:1,renderCell:e=>s.createElement("strong",null,"â‚¹ ",e.row.total)},{field:"actions",headerName:"Action",flex:1,sortable:!1,renderCell:e=>{const t=r=>{r.stopPropagation(),E({...e.row,download:!1})},n=r=>{r.stopPropagation(),E({...e.row,download:!0})},l=r=>{r.stopPropagation(),p(!0),b({...e.row})},o=r=>(r.stopPropagation(),ee(e.row._id)),g=r=>(r.stopPropagation(),ne(e.row._id));return s.createElement(s.Fragment,null,s.createElement(h,{size:"small",onClick:n,color:"primary"},s.createElement(le,null)),s.createElement(h,{size:"small",onClick:t,color:"primary"},s.createElement(oe,null)),s.createElement(h,{size:"small",onClick:l,color:"primary"},s.createElement(ce,null)),s.createElement(h,{size:"small",onClick:g,color:"primary"},s.createElement(me,null)),s.createElement(h,{size:"small",onClick:o,color:"error"},s.createElement(ue,null)))}}],m=ae(),w=v(e=>e.user),G=v(ge),O=_e(),[H,Q]=a.useState([]),[c,A]=a.useState(null),[L,i]=a.useState(""),[q,x]=a.useState(!1),[U,V]=a.useState(""),[u,E]=a.useState(null),[W,p]=a.useState(!1),[z,I]=a.useState(!1),[B,J]=a.useState(""),[_,b]=a.useState(null),[d,K]=a.useState({page:0,pageSize:100}),[f,X]=a.useState({isLoading:!1,data:[],total:0}),[Y,F]=a.useState(!1),{search:S}=v(({bill:e})=>e),N=Ne();a.useEffect(()=>{m(fe()).then(({payload:e={}})=>{var n,l,o;const{message:t}=(e==null?void 0:e.data)||{};if(t)i(t);else if(i(""),Q(e==null?void 0:e.data),w&&w.branch){const g=(l=(n=e==null?void 0:e.data)==null?void 0:n.find)==null?void 0:l.call(n,r=>r._id===w.branch);(o=e==null?void 0:e.data)!=null&&o.length&&A(g)}}).catch(()=>{i("Something went wrong! Please try later or contact Administrator.")})},[]);const P=()=>{const e={branch:c._id,pagination:{limit:d.pageSize?d.pageSize:100,page:d.page+1}};m(Se(e)).then(({payload:t={}})=>{const{message:n}=(t==null?void 0:t.data)||{};n?i(n):t!=null&&t.data.bills&&X(l=>{var o,g;return{...l,isLoading:!1,data:(g=(o=t==null?void 0:t.data.bills)==null?void 0:o.map)==null?void 0:g.call(o,r=>{var R,C,T;return{...r,billNo:$(r.billNo),date:Ce(new Date(r.date)),customer:(R=r.customer)!=null&&R.name?r.customer.name:r.customer,total:(T=(C=r.grandTotal)==null?void 0:C.toFixed)==null?void 0:T.call(C,2)}}),total:t==null?void 0:t.data.count}})}).catch(t=>{i(t.message)})};a.useEffect(()=>{c!=null&&c._id&&P()},[c,d.page,d.pageSize]),a.useEffect(()=>{u&&u._id&&m(M({id:u._id,email:""})).then(({payload:e={}})=>{const{message:t}=(e==null?void 0:e.data)||{};if(t)i(t);else if(e!=null&&e.data.file){const n=he(e==null?void 0:e.data.file),l=$(u.billNo)+".pdf";u.download?Ee(n,l):window.open(n,"_blank")}E(null)}).catch(e=>{i(e.message),E(null)})},[u]);const k=a.useMemo(()=>Oe(e=>{var t,n,l;N.current.setQuickFilterValues((l=(n=(t=e.split)==null?void 0:t.call(e," "))==null?void 0:n.filter)==null?void 0:l.call(n,o=>o!==""))},500),[N]);a.useEffect(()=>{var e;S&&((e=f.data)!=null&&e.length)&&(F(!0),k(S),setTimeout(()=>{F(!1)},500))},[f.data]);const Z=e=>{k(e.target.value),m(we(e.target.value))},y=(e,t)=>{A(t)},ee=e=>{V(e),x(!0)},te=e=>{e.target.value==="true"?m(xe(U)).then(({payload:t={}})=>{const{message:n}=(t==null?void 0:t.data)||{};n&&i(n),x(!1),P()}).catch(t=>{i(t.message)}):x(!1)},se=()=>{O("/transactions/billList/addBill",{state:c})},ne=e=>{O("/transactions/billList/editBill",{state:{billId:e}})};a.useEffect(()=>{z&&B&&_&&(p(!1),m(M({id:_._id,email:B})).then(({payload:e={}})=>{const{message:t}=(e==null?void 0:e.data)||{};t&&i(t),I(!1),b(null)}).catch(e=>{i(e.message),b(null)}))},[z,B,_]);const re=e=>{I(!0),J(e)};return s.createElement(s.Fragment,null,(G||Y)&&s.createElement(pe,null),s.createElement("div",{className:"inner-wrap"},q&&s.createElement(de,{isOpen:!0,onClose:te,title:"Are you sure?",content:"Do you want to delete the bill",warning:!0}),s.createElement("div",{className:"page_head"},s.createElement("h1",{className:"pageHead"},"Bills"),s.createElement("div",{className:"page_actions"},s.createElement(Ae,{size:"small",sx:{width:"230px",marginRight:"5px"}},s.createElement(Le,{disablePortal:!0,size:"small",name:"branch",className:"multi-select",options:H,value:c,onChange:y,disabled:!be(),getOptionLabel:e=>e.name,openOnFocus:!0,renderInput:e=>s.createElement(j,{...e,label:"Select branch",fullWidth:!0})})),s.createElement(ze,{variant:"contained",size:"small",type:"button",color:"primary",className:"ml6",onClick:se},"Add a bill"))),L!==""&&s.createElement(Ie,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},s.createElement(Fe,{severity:"error"},L)),s.createElement("div",{style:{width:"100%"}},s.createElement(ve,{apiRef:N,autoHeight:!0,density:"compact",rows:f.data,rowCount:f.total,loading:f.isLoading,pageSizeOptions:[100],paginationModel:d,onPaginationModelChange:K,paginationMode:"server",columns:D,getRowId:e=>e._id,sx:{backgroundColor:"primary.contrastText"},initialState:{...D,columns:{columnVisibilityModel:{_id:!1}}},disableSelectionOnClick:!0,disableColumnFilter:!0,disableColumnSelector:!0,disableDensitySelector:!0,components:{Toolbar:()=>s.createElement(De,{sx:{gap:"6px",mb:"10px",justifyContent:"end",border:"none"}},s.createElement(j,{variant:"standard",placeholder:"Search...",autoFocus:!!S,onChange:Z,value:S,InputProps:{startAdornment:s.createElement(Pe,{position:"start"},s.createElement(ie,null))}}))}})),s.createElement(Be,{isOpen:W,setIsOpen:p,handleEmailClose:()=>{p(!1),b(null)},handleSendEmail:e=>re(e),contentBody:""})))};export{bt as default};
