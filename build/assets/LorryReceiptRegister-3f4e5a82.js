import{r as o,a as t}from"./react-69b9bddd.js";import{u as q,a as ue}from"./react-redux-13959126.js";import{h as de}from"./icons-material-40f8e5d8.js";import{L as Q,A as V,D as J}from"./x-date-pickers-f3802fc3.js";import{F as pe}from"./file-saver-259f058c.js";import{cN as ge,cO as fe,cP as he,a5 as xe,cQ as Ee,L as be,k as Se,ba as Te,cR as Ne}from"./index-1d9d8716.js";import"./Card.module-3bdbfb7f.js";import{i as E,A as K,h as b,O as ve,Q as Ce,a as U,a1 as Le,a2 as S,l as z}from"./material-04052d9a.js";import{G as d}from"./@material-ui-d7516ac8.js";import{D as _e}from"./x-data-grid-83fc2422.js";import"./@babel-5e587562.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-20ba4de3.js";import"./@date-io-28dabb9c.js";import"./dayjs-39ab3f8d.js";import"./utils-49fe0532.js";import"./clsx-1229b3e0.js";import"./base-e8cfb5a9.js";import"./@popperjs-f3391c26.js";import"./rifm-bf33b601.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./stylis-79144faa.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-7dadf37a.js";import"./@remix-run-8989dd9f.js";import"./react-router-dom-38324838.js";import"./react-icons-6bc9af43.js";import"./jss-299ee23a.js";import"./is-in-browser-9e40da8a.js";import"./jss-plugin-rule-value-function-60587a41.js";import"./jss-plugin-global-c6030a8c.js";import"./jss-plugin-nested-fb36a984.js";import"./jss-plugin-camel-case-92f9f32c.js";import"./hyphenate-style-name-80972348.js";import"./jss-plugin-default-unit-2cb1c9e9.js";import"./jss-plugin-vendor-prefixer-24b01907.js";import"./css-vendor-1e7d08f8.js";import"./jss-plugin-props-sort-0c9fca2f.js";import"./prop-types-b6d0a120.js";import"./reselect-36a88051.js";const P={consignor:null,consignee:null,from:null,to:null,payType:"",searchText:""},Lt=()=>{var Y;const w=[{field:"_id",headerName:"Id"},{field:"srNo",headerName:"Sr. No."},{field:"lrNo",headerName:"L.R. Note No.",flex:1},{field:"date",headerName:"Consign Date",flex:1},{field:"invoiceNo",headerName:"Invoice No",flex:1},{field:"consignorName",headerName:"Consignor Name",minWidth:170,flex:1},{field:"consigneeName",headerName:"Consignee Name",minWidth:170,flex:1},{field:"from",headerName:"From",flex:1},{field:"to",headerName:"To",flex:1},{field:"payType",headerName:"Payment Mode",flex:1},{field:"totalArticles",headerName:"Total Qty",type:"number",flex:1},{field:"total",headerName:"Grand Total",type:"number",flex:1}],X=q(ge),f=ue(),h=q(e=>e.user),[Z,$]=o.useState([]),[ee,te]=o.useState([]),[A,m]=o.useState(""),[c,I]=o.useState(null),[a,x]=o.useState(P),[O,p]=o.useState(!1),[g,re]=o.useState({page:0,pageSize:100}),[T,ae]=o.useState({isLoading:!1,data:[],total:0}),[ne,R]=o.useState(!1);o.useEffect(()=>{M(""),f(fe()).then(({payload:e={}})=>{var r,i;const{message:n}=(e==null?void 0:e.data)||{};if(n)m(n);else if(m(""),te(e==null?void 0:e.data),h&&h.branch){const s=(i=(r=e==null?void 0:e.data)==null?void 0:r.find)==null?void 0:i.call(r,l=>l._id===h.branch);I(s)}}).catch(e=>{m(e.message)})},[]),o.useEffect(()=>{if(O&&(h.branch&&c||!h.branch)){R(!0);const e={};c&&c._id&&(e.branch=c._id),a.consignor&&a.consignor._id&&(e.consignor=a.consignor._id),a.consignee&&a.consignee._id&&(e.consignee=a.consignee._id),a.from&&(e.from=a.from),a.to&&(e.to=a.to),a.payType&&(e.payType=a.payType),a.searchText&&(e.searchText=a.searchText);const n={pagination:{limit:g.pageSize?g.pageSize:100,page:g.page+1},query:e};f(he(n)).then(({payload:r={}})=>{var s,l;R(!1);const{message:i}=(r==null?void 0:r.data)||{};if(i)m(i);else{const N=(l=(s=r==null?void 0:r.data.lorryReceipts)==null?void 0:s.map)==null?void 0:l.call(s,(u,v)=>{var C,k,L,G,_,y,D,j;return{...u,srNo:v+1,date:xe(new Date(u.date)),totalWeight:(G=(L=(k=(C=u.transactions)==null?void 0:C.reduce)==null?void 0:k.call(C,(B,F)=>B+F.chargeWeight,0))==null?void 0:L.toFixed)==null?void 0:G.call(L,2),totalArticles:(j=(D=(y=(_=u.transactions)==null?void 0:_.reduce)==null?void 0:y.call(_,(B,F)=>B+F.articleNo,0))==null?void 0:D.toFixed)==null?void 0:j.call(D,2)}});ae(u=>({...u,isLoading:!1,data:N,total:r==null?void 0:r.data.count}))}p(!1)}).catch(r=>{p(!1),m(r.message),R(!1)})}},[g.page,g.pageSize,c,O]);const M=e=>{var r;const n=(r=e.trim)==null?void 0:r.call(e);((n==null?void 0:n.length)>2||!n)&&f(Ee(n)).then(({payload:i={}})=>{var l,N;const{message:s}=(i==null?void 0:i.data)||{};if(s)m(s);else{m("");const u=(N=(l=i==null?void 0:i.data)==null?void 0:l.map)==null?void 0:N.call(l,v=>({...v,label:v.name}));$(u)}}).catch(i=>{m(i.message)})},ie=({target:e})=>{M(e.value)},se=(e,n)=>{I(n),p(!1),x(P),f(Te(n._id))},oe=e=>{e.preventDefault(),p(!0)},me=(e,n,r)=>{x(i=>({...i,[r]:n}))},W=(e,n)=>{x(r=>({...r,[e]:new Date(n)}))},ce=e=>{e.preventDefault(),x(P),p(!0)},le=e=>{e.preventDefault();const n={};c&&c._id&&(n.branch=c._id),a.consignor&&a.consignor._id&&(n.consignor=a.consignor._id),a.consignee&&a.consignee._id&&(n.consignee=a.consignee._id),a.from&&(n.from=a.from),a.to&&(n.to=a.to),a.payType&&(n.payType=a.payType),a.searchText&&(n.searchText=a.searchText),f(Ne(n)).then(({payload:r={}})=>{const{message:i}=(r==null?void 0:r.data)||{};if(i)m(i);else{const s=new Blob([r==null?void 0:r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});pe.saveAs(s,"LorryReceipts.xlsx")}}).catch(r=>{m(r.message)})},H=(e,n="payType")=>{x(r=>({...r,[n]:e.target.value}))};return t.createElement(t.Fragment,null,(X||ne)&&t.createElement(be,null),t.createElement("div",{className:"inner-wrap"},t.createElement("div",{className:"page_head-1",style:{display:"flex",justifyContent:"space-between"}},t.createElement("h1",{className:"pageHead"},"LR. Note Register"),t.createElement("div",{className:""},t.createElement(E,{size:"small",sx:{width:"230px",marginRight:"5px",marginBottom:"20px"}},t.createElement(K,{disablePortal:!0,size:"small",name:"branch",options:ee,value:c||null,onChange:se,disabled:!Se(),getOptionLabel:e=>e.name,openOnFocus:!0,renderInput:e=>t.createElement(b,{...e,label:"Select branch",fullWidth:!0})})))),A!==""&&t.createElement(ve,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},t.createElement(Ce,{severity:"error"},A)),t.createElement(U,{sx:{padding:"20px",marginBottom:"20px"}},t.createElement("h2",{className:"mb20"},"Search"),t.createElement("form",{action:"",onSubmit:oe},t.createElement(d,{container:!0,spacing:3},t.createElement(d,{item:!0,xs:3},t.createElement(E,{fullWidth:!0},t.createElement(Q,{dateAdapter:V},t.createElement(J,{label:"From",inputFormat:"DD/MM/YYYY",value:a.from,onChange:W.bind(null,"from"),renderInput:e=>t.createElement(b,{name:"from",size:"small",...e})})))),t.createElement(d,{item:!0,xs:3},t.createElement(E,{fullWidth:!0},t.createElement(Q,{dateAdapter:V},t.createElement(J,{label:"To",inputFormat:"DD/MM/YYYY",value:a.to,onChange:W.bind(null,"to"),renderInput:e=>t.createElement(b,{name:"to",size:"small",...e})})))),t.createElement(d,{item:!0,xs:3},t.createElement(E,{fullWidth:!0,size:"small"},t.createElement(K,{disablePortal:!0,autoSelect:!0,autoHighlight:!0,size:"small",name:"consignor",options:Z,value:a.consignor,onChange:(e,n)=>me(e,n,"consignor"),openOnFocus:!0,renderInput:e=>t.createElement(b,{...e,label:"Customer",fullWidth:!0,onChange:ie})}))),t.createElement(d,{item:!0,xs:3},t.createElement(Le,{color:"primary",value:a.payType,exclusive:!0,onChange:e=>H(e,"payType"),"aria-label":"Platform",size:"small"},t.createElement(S,{value:""},"All"),t.createElement(S,{value:"TBB"},"TBB"),t.createElement(S,{value:"ToPay"},"ToPay"),t.createElement(S,{value:"Paid"},"Paid"),t.createElement(S,{value:"FOC"},"FOC"))),t.createElement(d,{item:!0,xs:3},t.createElement(E,{fullWidth:!0},t.createElement(b,{size:"small",variant:"outlined",label:"Search in List By",value:a.searchText,onChange:e=>H(e,"searchText"),name:"searchText",id:"searchText",inputProps:{maxLength:50}}))),t.createElement(d,{style:{display:"flex"},item:!0,xs:3},t.createElement(z,{type:"submit",variant:"contained",size:"medium",color:"primary"},"Search"),t.createElement(z,{type:"button",variant:"outlined",size:"medium",className:"ml6",onClick:e=>ce(e)},"Reset"))))),t.createElement(U,{sx:{width:"100%"}},((Y=T.data)==null?void 0:Y.length)>0?t.createElement("div",{className:"tbl_header"},t.createElement(z,{variant:"contained",endIcon:t.createElement(de,null),onClick:le},"Export To Excel")):null,t.createElement(_e,{autoHeight:!0,density:"compact",rows:T.data,rowCount:T.total,loading:T.isLoading,pageSizeOptions:[100],paginationModel:g,onPaginationModelChange:e=>{re(e),p(!0)},paginationMode:"server",columns:w,getRowId:e=>e._id,sx:{backgroundColor:"primary.contrastText"},initialState:{...w,columns:{columnVisibilityModel:{_id:!1}}},disableSelectionOnClick:!0}))))};export{Lt as default};
