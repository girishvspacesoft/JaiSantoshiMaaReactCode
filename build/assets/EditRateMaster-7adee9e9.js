import{r as C,a}from"./react-69b9bddd.js";import{e as Y}from"./icons-material-40f8e5d8.js";import"./Card.module-3bdbfb7f.js";import{aR as $,aZ as y,aV as ee,aW as te,L as ae,an as P,a_ as re}from"./index-1d9d8716.js";import{a as se,u as ie}from"./react-redux-13959126.js";import{b as ne,a as le}from"./react-router-7dadf37a.js";import{O as me,Q as oe,a as ce,i as p,A as I,h as b,V as x,D as de,l as _,f as ue}from"./material-04052d9a.js";import{D as ge}from"./x-data-grid-83fc2422.js";import"./@babel-5e587562.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./react-icons-6bc9af43.js";import"./use-sync-external-store-20ba4de3.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./stylis-79144faa.js";import"./utils-49fe0532.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./base-e8cfb5a9.js";import"./@popperjs-f3391c26.js";import"./prop-types-b6d0a120.js";import"./reselect-36a88051.js";const O={customer:null,customerName:"",rates:[],article:"",station:null,rate:"",ddCharges:""},k={customer:{invalid:!1,message:""},rates:{invalid:!1,message:""},rate:{invalid:!1,message:""},article:{invalid:!1,message:""},station:{invalid:!1,message:""}},Je=()=>{var B;const L=[{field:"_id",headerName:"Id"},{field:"article",headerName:"Article",flex:1},{field:"stationName",headerName:"Station",flex:1},{field:"rate",headerName:"Rate",flex:1},{field:"ddCharges",headerName:"DD charges",flex:1},{field:"actions",headerName:"Action",sortable:!1,flex:1,renderCell:e=>{const t=r=>(r.stopPropagation(),A(e.row._id));return a.createElement(a.Fragment,null,a.createElement(ue,{size:"small",onClick:t,color:"primary"},a.createElement(Y,null)))}}],S=se(),q=ne(),{rateMasterId:R}=q.state,[l,f]=C.useState(O),[d,T]=C.useState([]),[N,w]=C.useState([]),[o,z]=C.useState(k),[D,u]=C.useState(""),[v,A]=C.useState(""),F=ie($),M=le(),H=C.useCallback(()=>{M("/master/rateMasterList")},[M]);C.useEffect(()=>{R&&(d!=null&&d.length)&&S(y(R)).then(({payload:e={}})=>{const{message:t}=(e==null?void 0:e.data)||{};t?u(t):f(r=>{var s,n;const i=(n=(s=e==null?void 0:e.data.rates)==null?void 0:s.map)==null?void 0:n.call(s,m=>{var c;const h=(c=d==null?void 0:d.find)==null?void 0:c.call(d,g=>g._id===(m==null?void 0:m.station)||g.name===(m==null?void 0:m.stationName));return{...m,station:h||(m==null?void 0:m.station),stationName:(h==null?void 0:h.name)||(m==null?void 0:m.stationName)}});return{...r,...e==null?void 0:e.data,rates:i}})}).catch(e=>{u(e.message)})},[R,d]),C.useEffect(()=>{S(ee()).then(({payload:e={}})=>{var r,i;const{message:t}=(e==null?void 0:e.data)||{};if(t)u(t);else{u("");const s=(i=(r=e==null?void 0:e.data)==null?void 0:r.map)==null?void 0:i.call(r,n=>({...n,label:n.name,value:n.name}));T(s)}}).catch(e=>{u(e.message)}),S(te()).then(({payload:e={}})=>{var r,i;const{message:t}=(e==null?void 0:e.data)||{};if(t)u(t);else{u("");const s=(i=(r=e==null?void 0:e.data)==null?void 0:r.map)==null?void 0:i.call(r,n=>({...n,label:n.name,value:n.name}));w(s)}}).catch(e=>{u(e.message)})},[]),C.useEffect(()=>{var e,t,r;if(v){const i=(t=(e=l.rates)==null?void 0:e.filter)==null?void 0:t.call(e,n=>{if(n.id)return n.id===v;if(n._id)return n._id===v});let s;i!=null&&i.length&&(s=(r=d==null?void 0:d.find)==null?void 0:r.call(d,n=>n._id===i[0].station._id)),f(n=>{var m,h;return{...n,rates:(h=(m=n.rates)==null?void 0:m.filter)==null?void 0:h.call(m,c=>c.id!==v),article:i[0].article,station:s,stationName:s.name,rate:i[0].rate,ddCharges:i[0].ddCharges}})}},[v,d]);const W=e=>{const t=e.target.name,r=e.target.value;f(i=>({...i,[t]:r}))},V=e=>{var t,r;if(e.preventDefault(),!G(l)){const i=l;(r=(t=i.rates)==null?void 0:t.forEach)==null||r.call(t,s=>{s.station&&s.station._id&&s.station.name&&(s.stationName=s.station.name,s.station=s.station._id),delete s._id}),S(re(i)).then(({payload:s={}})=>{const{message:n}=(s==null?void 0:s.data)||{};n?u(n):(u(""),f(O),H())}).catch(s=>{u(s.message)})}},U=()=>{H()},G=e=>{var i;const t={...k};e.customer||(t.customer={invalid:!0,message:"Customer is required"}),(i=e.rates)!=null&&i.length||(t.rates={invalid:!0,message:"At least one entry is required"});let r=!1;for(const s in t)t[s].invalid===!0&&(r=!0);return r&&z(t),r},Q=(e,t,r)=>{f(i=>({...i,[r]:t,customerName:(t==null?void 0:t.name)||""}))},Z=(e,t)=>{f(r=>({...r,article:t,articleName:t}))},j=(e,t)=>{f(r=>({...r,station:t,stationName:t==null?void 0:t.name}))},J=e=>{var i,s,n,m,h;e.preventDefault();const t={...k};l.customer?t.customer={invalid:!1,message:""}:t.customer={invalid:!0,message:"Customer is required"},l.article?t.article={invalid:!1,message:""}:t.article={invalid:!0,message:"Article is required"},!l.station||!l.station.name?t.station={invalid:!0,message:"Station is required"}:t.station={invalid:!1,message:""},!l.rate||l.rate<0?t.rate={invalid:!0,message:"Rate should be greater than 0"}:t.rate={invalid:!1,message:""};let r=!1;for(const c in t)t[c].invalid===!0&&(r=!0);if(r)z(t);else if(v){const c=(m=(n=l.rates)==null?void 0:n.filter)==null?void 0:m.call(n,E=>{if(E.id)return E.id!==v;if(E._id)return E._id!==v}),g={_id:Math.random(),article:l.article,station:l.station,stationName:l.station.name,rate:l.rate,ddCharges:l.ddCharges};(h=c==null?void 0:c.some)!=null&&h.call(c,({station:E,article:X})=>E===g.station&&X===g.article)?u("Already item exist."):(f(E=>({...E,rates:[...c,g],article:"",station:null,rate:"",ddCharges:""})),A(""),u(""))}else{const c={_id:Math.random(),article:l.article,station:l.station,stationName:l.station.name,rate:l.rate,ddCharges:l.ddCharges};(s=(i=l.rates)==null?void 0:i.some)!=null&&s.call(i,({station:g,article:E})=>g===c.station&&E===c.article)?u("Already item exist."):(f(g=>({...g,rates:[...g.rates,c],article:"",station:null,rate:"",ddCharges:""})),u(""))}},K=e=>{e.preventDefault(),f(t=>({...t,article:"",station:null,rate:"",ddCharges:""})),A("")};return a.createElement(a.Fragment,null,F&&a.createElement(ae,null),a.createElement("div",{className:"inner-wrap"},a.createElement("h1",{className:"pageHead"},"Edit rates"),D!==""&&a.createElement(me,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},a.createElement(oe,{severity:"error"},D)),!F&&a.createElement("div",null,a.createElement("form",{action:"",onSubmit:V},a.createElement(ce,{sx:{padding:"20px",marginBottom:"20px"}},a.createElement("div",{className:"grid grid-6-col"},a.createElement("div",{className:"grid-item"},a.createElement(p,{fullWidth:!0,error:o.customer.invalid},a.createElement(I,{disablePortal:!0,autoSelect:!0,size:"small",name:"customer",options:[],value:l.customerName,onChange:(e,t)=>Q(e,t,"customer"),disabled:!0,openOnFocus:!0,renderInput:e=>a.createElement(b,{...e,label:"Customer",error:o.customer.invalid,fullWidth:!0})}),o.customer.invalid&&a.createElement(x,null,o.customer.message)))),a.createElement(de,{className:"mb10"}),a.createElement("div",{className:"grid grid-6-col"},a.createElement("div",{className:"grid-item"},a.createElement(p,{fullWidth:!0,error:o.article.invalid},a.createElement(I,{autoSelect:!0,size:"small",name:"article",options:(B=N==null?void 0:N.map)==null?void 0:B.call(N,e=>e.name),value:l.article,onChange:(e,t)=>Z(e,t),openOnFocus:!0,renderInput:e=>a.createElement(b,{...e,label:"Article",error:o.article.invalid,fullWidth:!0})}),o.article.invalid&&a.createElement(x,null,o.article.message))),a.createElement("div",{className:"grid-item"},a.createElement(p,{fullWidth:!0,error:o.station.invalid},a.createElement(I,{autoSelect:!0,size:"small",name:"place",options:d,value:l.station,onChange:(e,t)=>j(e,t),openOnFocus:!0,renderInput:e=>a.createElement(b,{...e,label:"Station",error:o.station.invalid,fullWidth:!0})}),o.station.invalid&&a.createElement(x,null,o.station.message))),a.createElement("div",{className:"grid-item"},a.createElement(p,{fullWidth:!0,error:o.rate.invalid},a.createElement(b,{size:"small",variant:"outlined",label:"Rate",value:l.rate||"",onChange:W,onInput:P,name:"rate",id:"rate",error:o.rate.invalid}),o.rate.invalid&&a.createElement(x,null,o.rate.message))),a.createElement("div",{className:"grid-item"},a.createElement(p,{fullWidth:!0},a.createElement(b,{size:"small",variant:"outlined",label:"DD charges",value:l.ddCharges||"",onChange:W,onInput:P,name:"ddCharges",id:"ddCharges"}))),a.createElement("div",{className:"grid-item"},a.createElement(_,{type:"button",variant:"outlined",size:"medium",onClick:J},v?"Update":"Add"),a.createElement(_,{type:"button",variant:"outlined",size:"medium",className:"ml6",onClick:K},v?"Cancel":"Reset")))),a.createElement("div",{style:{width:"100%",marginBottom:"20px"}},o.rates.invalid&&a.createElement("div",null,a.createElement(x,{className:"error"},o.rates.message)),a.createElement(ge,{sx:{backgroundColor:"primary.contrastText"},autoHeight:!0,density:"compact",getRowId:e=>(e==null?void 0:e._id)||Math.random(),rows:l.rates,columns:L,initialState:{...L,columns:{columnVisibilityModel:{_id:!1}}},pageSize:10,rowsPerPageOptions:[10],disableSelectionOnClick:!0})),a.createElement("div",{className:"right"},a.createElement(_,{type:"button",variant:"outlined",size:"medium",onClick:U},"Back"),a.createElement(_,{variant:"contained",size:"medium",type:"submit",color:"primary",className:"ml6"},"Save"))))))};export{Je as default};
