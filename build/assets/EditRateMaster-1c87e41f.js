import{r as E,a}from"./react-bfabd40c.js";import{e as Z}from"./icons-material-4539f19e.js";import"./Card.module-3bdbfb7f.js";import{aP as $,aW as y,aS as ee,aT as te,L as ae,al as B,aX as re}from"./index-60b53c60.js";import{a as se,u as ie}from"./react-redux-45d870ba.js";import{b as ne,a as le}from"./react-router-1b5f20a2.js";import{O as me,Q as oe,a as ce,i as N,A as R,h as b,V as x,D as de,l as _,f as ue}from"./material-e0a59a28.js";import{D as ge}from"./x-data-grid-cceece3f.js";import"./@babel-e11bafe1.js";import"./react-dom-b0178e93.js";import"./scheduler-765c72db.js";import"./redux-persist-d9cc1560.js";import"./redux-b7ba668d.js";import"./@reduxjs-4d37e7cf.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-4a70c6fc.js";import"./hoist-non-react-statics-6cfbf744.js";import"./react-router-dom-4405dfe9.js";import"./@remix-run-d753ad9e.js";import"./react-icons-55b3b9a0.js";import"./use-sync-external-store-18921cc2.js";import"./system-a1d29c52.js";import"./styled-engine-f3bd09bf.js";import"./@emotion-77835cc8.js";import"./stylis-79144faa.js";import"./utils-c03c978f.js";import"./private-theming-970ac73c.js";import"./react-transition-group-7ded6f4d.js";import"./dom-helpers-9a525042.js";import"./base-ff50cfe3.js";import"./@popperjs-f3391c26.js";import"./clsx-1229b3e0.js";import"./prop-types-d7fd566a.js";import"./reselect-36a88051.js";const O={customer:null,customerName:"",rates:[],article:"",station:null,rate:"",ddCharges:""},k={customer:{invalid:!1,message:""},rates:{invalid:!1,message:""},rate:{invalid:!1,message:""},article:{invalid:!1,message:""},station:{invalid:!1,message:""}},Ke=()=>{var W;const L=[{field:"_id",headerName:"Id"},{field:"article",headerName:"Article",flex:1},{field:"stationName",headerName:"Station",flex:1},{field:"rate",headerName:"Rate",flex:1},{field:"ddCharges",headerName:"DD charges",flex:1},{field:"actions",headerName:"Action",sortable:!1,flex:1,renderCell:e=>{const t=r=>(r.stopPropagation(),I(e.row._id));return a.createElement(a.Fragment,null,a.createElement(ue,{size:"small",onClick:t,color:"primary"},a.createElement(Z,null)))}}],S=se(),q=ne(),{rateMasterId:A}=q.state,[l,u]=E.useState(O),[c,T]=E.useState([]),[p,w]=E.useState([]),[m,z]=E.useState(k),[D,d]=E.useState(""),[g,I]=E.useState(""),F=ie($),M=le(),H=E.useCallback(()=>{M("/master/rateMasterList")},[M]);E.useEffect(()=>{A&&(c!=null&&c.length)&&S(y(A)).then(({payload:e={}})=>{const{message:t}=(e==null?void 0:e.data)||{};t?d(t):u(r=>{var s,n;const i=(n=(s=e==null?void 0:e.data.rates)==null?void 0:s.map)==null?void 0:n.call(s,f=>{var o;const C=(o=c==null?void 0:c.find)==null?void 0:o.call(c,v=>v._id===f.station);return{...f,station:C,stationName:C.name}});return{...r,...e==null?void 0:e.data,rates:i}})}).catch(e=>{d(e.message)})},[A,c]),E.useEffect(()=>{S(ee()).then(({payload:e={}})=>{var r,i;const{message:t}=(e==null?void 0:e.data)||{};if(t)d(t);else{d("");const s=(i=(r=e==null?void 0:e.data)==null?void 0:r.map)==null?void 0:i.call(r,n=>({...n,label:n.name,value:n.name}));T(s)}}).catch(e=>{d(e.message)}),S(te()).then(({payload:e={}})=>{var r,i;const{message:t}=(e==null?void 0:e.data)||{};if(t)d(t);else{d("");const s=(i=(r=e==null?void 0:e.data)==null?void 0:r.map)==null?void 0:i.call(r,n=>({...n,label:n.name,value:n.name}));w(s)}}).catch(e=>{d(e.message)})},[]),E.useEffect(()=>{var e,t,r;if(g){const i=(t=(e=l.rates)==null?void 0:e.filter)==null?void 0:t.call(e,n=>{if(n.id)return n.id===g;if(n._id)return n._id===g});let s;i!=null&&i.length&&(s=(r=c==null?void 0:c.find)==null?void 0:r.call(c,n=>n._id===i[0].station._id)),u(n=>{var f,C;return{...n,rates:(C=(f=n.rates)==null?void 0:f.filter)==null?void 0:C.call(f,o=>o.id!==g),article:i[0].article,station:s,stationName:s.name,rate:i[0].rate,ddCharges:i[0].ddCharges}})}},[g,c]);const P=e=>{const t=e.target.name,r=e.target.value;u(i=>({...i,[t]:r}))},U=e=>{var t,r;if(e.preventDefault(),!G(l)){const i=l;(r=(t=i.rates)==null?void 0:t.forEach)==null||r.call(t,s=>{s.station&&s.station._id&&s.station.name&&(s.stationName=s.station.name,s.station=s.station._id),delete s._id}),S(re(i)).then(({payload:s={}})=>{const{message:n}=(s==null?void 0:s.data)||{};n?d(n):(d(""),u(O),H())}).catch(s=>{d(s.message)})}},V=()=>{H()},G=e=>{var i;const t={...k};e.customer||(t.customer={invalid:!0,message:"Customer is required"}),(i=e.rates)!=null&&i.length||(t.rates={invalid:!0,message:"At least one entry is required"});let r=!1;for(const s in t)t[s].invalid===!0&&(r=!0);return r&&z(t),r},Q=(e,t,r)=>{u(i=>({...i,[r]:t,customerName:(t==null?void 0:t.name)||""}))},X=(e,t)=>{u(r=>({...r,article:t,articleName:t}))},j=(e,t)=>{u(r=>({...r,station:t,stationName:t==null?void 0:t.name}))},J=e=>{var i,s,n,f,C;e.preventDefault();const t={...k};l.customer?t.customer={invalid:!1,message:""}:t.customer={invalid:!0,message:"Customer is required"},l.article?t.article={invalid:!1,message:""}:t.article={invalid:!0,message:"Article is required"},!l.station||!l.station.name?t.station={invalid:!0,message:"Station is required"}:t.station={invalid:!1,message:""},!l.rate||l.rate<0?t.rate={invalid:!0,message:"Rate should be greater than 0"}:t.rate={invalid:!1,message:""};let r=!1;for(const o in t)t[o].invalid===!0&&(r=!0);if(r)z(t);else if(g){const o=(f=(n=l.rates)==null?void 0:n.filter)==null?void 0:f.call(n,h=>{if(h.id)return h.id!==g;if(h._id)return h._id!==g}),v={_id:Math.random(),article:l.article,station:l.station,stationName:l.station.name,rate:l.rate,ddCharges:l.ddCharges};(C=o==null?void 0:o.some)!=null&&C.call(o,({station:h,article:Y})=>h===v.station&&Y===v.article)?d("Already item exist."):(u(h=>({...h,rates:[...o,v],article:"",station:null,rate:"",ddCharges:""})),I(""),d(""))}else{const o={_id:Math.random(),article:l.article,station:l.station,stationName:l.station.name,rate:l.rate,ddCharges:l.ddCharges};(s=(i=l.rates)==null?void 0:i.some)!=null&&s.call(i,({station:v,article:h})=>v===o.station&&h===o.article)?d("Already item exist."):(u(v=>({...v,rates:[...v.rates,o],article:"",station:null,rate:"",ddCharges:""})),d(""))}},K=e=>{e.preventDefault(),u(t=>({...t,article:"",station:null,rate:"",ddCharges:""})),I("")};return a.createElement(a.Fragment,null,F&&a.createElement(ae,null),a.createElement("div",{className:"inner-wrap"},a.createElement("h1",{className:"pageHead"},"Edit rates"),D!==""&&a.createElement(me,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},a.createElement(oe,{severity:"error"},D)),!F&&a.createElement("div",null,a.createElement("form",{action:"",onSubmit:U},a.createElement(ce,{sx:{padding:"20px",marginBottom:"20px"}},a.createElement("div",{className:"grid grid-6-col"},a.createElement("div",{className:"grid-item"},a.createElement(N,{fullWidth:!0,error:m.customer.invalid},a.createElement(R,{disablePortal:!0,autoSelect:!0,size:"small",name:"customer",options:[],value:l.customerName,onChange:(e,t)=>Q(e,t,"customer"),disabled:!0,openOnFocus:!0,renderInput:e=>a.createElement(b,{...e,label:"Customer",error:m.customer.invalid,fullWidth:!0})}),m.customer.invalid&&a.createElement(x,null,m.customer.message)))),a.createElement(de,{className:"mb10"}),a.createElement("div",{className:"grid grid-6-col"},a.createElement("div",{className:"grid-item"},a.createElement(N,{fullWidth:!0,error:m.article.invalid},a.createElement(R,{autoSelect:!0,size:"small",name:"article",options:(W=p==null?void 0:p.map)==null?void 0:W.call(p,e=>e.name),value:l.article,onChange:(e,t)=>X(e,t),openOnFocus:!0,renderInput:e=>a.createElement(b,{...e,label:"Article",error:m.article.invalid,fullWidth:!0})}),m.article.invalid&&a.createElement(x,null,m.article.message))),a.createElement("div",{className:"grid-item"},a.createElement(N,{fullWidth:!0,error:m.station.invalid},a.createElement(R,{autoSelect:!0,size:"small",name:"place",options:c,value:l.station,onChange:(e,t)=>j(e,t),openOnFocus:!0,renderInput:e=>a.createElement(b,{...e,label:"Station",error:m.station.invalid,fullWidth:!0})}),m.station.invalid&&a.createElement(x,null,m.station.message))),a.createElement("div",{className:"grid-item"},a.createElement(N,{fullWidth:!0,error:m.rate.invalid},a.createElement(b,{size:"small",variant:"outlined",label:"Rate",value:l.rate||"",onChange:P,onInput:B,name:"rate",id:"rate",error:m.rate.invalid}),m.rate.invalid&&a.createElement(x,null,m.rate.message))),a.createElement("div",{className:"grid-item"},a.createElement(N,{fullWidth:!0},a.createElement(b,{size:"small",variant:"outlined",label:"DD charges",value:l.ddCharges||"",onChange:P,onInput:B,name:"ddCharges",id:"ddCharges"}))),a.createElement("div",{className:"grid-item"},a.createElement(_,{type:"button",variant:"outlined",size:"medium",onClick:J},g?"Update":"Add"),a.createElement(_,{type:"button",variant:"outlined",size:"medium",className:"ml6",onClick:K},g?"Cancel":"Reset")))),a.createElement("div",{style:{width:"100%",marginBottom:"20px"}},m.rates.invalid&&a.createElement("div",null,a.createElement(x,{className:"error"},m.rates.message)),a.createElement(ge,{sx:{backgroundColor:"primary.contrastText"},autoHeight:!0,density:"compact",getRowId:e=>(e==null?void 0:e._id)||Math.random(),rows:l.rates,columns:L,initialState:{...L,columns:{columnVisibilityModel:{_id:!1}}},pageSize:10,rowsPerPageOptions:[10],disableSelectionOnClick:!0})),a.createElement("div",{className:"right"},a.createElement(_,{type:"button",variant:"outlined",size:"medium",onClick:V},"Back"),a.createElement(_,{variant:"contained",size:"medium",type:"submit",color:"primary",className:"ml6"},"Save"))))))};export{Ke as default};
