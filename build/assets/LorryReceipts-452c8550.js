import{r as s,a as r}from"./react-69b9bddd.js";import{u as _,a as ne}from"./react-redux-13959126.js";import{c as ie,h as oe,i as le,j as ce,e as me,f as de}from"./icons-material-40f8e5d8.js";import"./Card.module-3bdbfb7f.js";import{C as ue}from"./Dialog-c8953a08.js";import{a$ as ge,b0 as fe,b1 as pe,b2 as he,b3 as Ee,b4 as j,b5 as Se,b6 as be,L as we,k as G,b7 as Ce,a5 as Le,b8 as Re,o as N,b9 as xe,ba as _e}from"./index-1d9d8716.js";import{S as Ne}from"./SendEmail-af9be518.js";import{a as Ae}from"./react-router-7dadf37a.js";import{u as ve,D as Pe,G as De}from"./x-data-grid-83fc2422.js";import{j as Ie}from"./utils-49fe0532.js";import{i as Oe,A as ze,h as H,l as ke,O as Fe,Q as Te,m as Be,f as E}from"./material-04052d9a.js";import"./@babel-5e587562.js";import"./react-dom-69e96a05.js";import"./scheduler-765c72db.js";import"./hoist-non-react-statics-1d21e5a8.js";import"./use-sync-external-store-20ba4de3.js";import"./redux-persist-a379f351.js";import"./redux-fa075741.js";import"./@reduxjs-2459f64e.js";import"./immer-41fd5235.js";import"./redux-thunk-ef899f4c.js";import"./axios-21b846bc.js";import"./react-router-dom-38324838.js";import"./@remix-run-8989dd9f.js";import"./react-icons-6bc9af43.js";import"./system-49be6911.js";import"./styled-engine-f8044af8.js";import"./@emotion-17579717.js";import"./stylis-79144faa.js";import"./private-theming-ec89146b.js";import"./react-transition-group-deabed87.js";import"./dom-helpers-9a525042.js";import"./base-e8cfb5a9.js";import"./@popperjs-f3391c26.js";import"./prop-types-b6d0a120.js";import"./reselect-36a88051.js";const wt=()=>{const A=[{field:"_id",headerName:"Id"},{field:"lrNo",headerName:"LR no.",flex:1},{field:"date",headerName:"Date",flex:1},{field:"consignorName",headerName:"Consignor",flex:1},{field:"from",headerName:"From",flex:1},{field:"consigneeName",headerName:"Consignee",flex:1},{field:"to",headerName:"To",flex:1},{field:"payType",headerName:"Pay type",flex:1},{field:"total",headerName:"Grand total",type:"number",flex:1,renderCell:e=>r.createElement("strong",null,"â‚¹ ",e.row.total)},{field:"actions",headerName:"Action",sortable:!1,minWidth:180,flex:1,renderCell:e=>{const t=n=>{n.stopPropagation(),O({...e.row,download:!1})},a=n=>{n.stopPropagation(),O({...e.row,download:!0})},i=n=>{n.stopPropagation(),b(!0),w({...e.row})},o=n=>(n.stopPropagation(),te(e.row._id)),m=n=>(n.stopPropagation(),re(e.row._id));return r.createElement(r.Fragment,null,r.createElement(E,{size:"small",onClick:a,color:"primary"},r.createElement(oe,null)),r.createElement(E,{size:"small",onClick:t,color:"primary"},r.createElement(le,null)),r.createElement(E,{size:"small",onClick:i,color:"primary"},r.createElement(ce,null)),r.createElement(E,{size:"small",onClick:o,color:"primary"},r.createElement(me,null)),G()?r.createElement(E,{size:"small",onClick:m,color:"error"},r.createElement(de,null)):null)}}],v=Ae(),u=_(e=>e.user),W=_(ge),[Q,U]=s.useState([]),[g,P]=s.useState(null),[D,l]=s.useState(""),[q,S]=s.useState(!1),[V,I]=s.useState(""),[h,O]=s.useState(""),[J,b]=s.useState(!1),[z,k]=s.useState(!1),[L,K]=s.useState(""),[R,w]=s.useState(null),[X,F]=s.useState(!1),{search:C}=_(({lorryreceipt:e})=>e),x=ve(),c=ne(),[f,T]=s.useState({page:0,pageSize:100}),[p,Y]=s.useState({isLoading:!1,data:[],total:0});s.useEffect(()=>{c(fe()).then(({payload:e={}})=>{var a,i,o;const{message:t}=(e==null?void 0:e.data)||{};if(t)l(t);else if(l(""),U(e==null?void 0:e.data),(a=e==null?void 0:e.data)!=null&&a.length){const m=(o=(i=e==null?void 0:e.data)==null?void 0:i.find)==null?void 0:o.call(i,n=>n._id===u.branch);P(m)}}).catch(()=>{l("Something went wrong! Please try later or contact Administrator.")}),c(pe()),c(he()),c(Ee())},[]);const B=()=>{const e={branch:g._id,pagination:{limit:f.pageSize?f.pageSize:100,page:f.page+1}};c(Ce(e)).then(({payload:t={}})=>{const{message:a}=(t==null?void 0:t.data)||{};a?l(a):(Y(i=>{var o,m;return{...i,isLoading:!1,data:(m=(o=t==null?void 0:t.data.lorryReceipts)==null?void 0:o.map)==null?void 0:m.call(o,n=>{var d,$;return{...n,date:Le(new Date(n.date)),total:($=(d=n.total)==null?void 0:d.toFixed)==null?void 0:$.call(d,2)}}),total:t==null?void 0:t.data.count}}),l(""))}).catch(t=>{l(t.message)})};s.useEffect(()=>{g!=null&&g._id&&B()},[g,f.page,f.pageSize]),s.useEffect(()=>{var e;h&&c(j({id:h._id,email:"",user:((e=u==null?void 0:u.employee)==null?void 0:e.name)||""})).then(({payload:t={}})=>{var i,o;const{message:a}=(t==null?void 0:t.data)||{};if(a)l(a);else{const m=Se(t==null?void 0:t.data.file),n=(o=(i=p.data)==null?void 0:i.find)==null?void 0:o.call(i,d=>d._id===h._id);if(m)if(h.download){const d=n.lrNo+".pdf";be(m,d)}else window.open(m,"_blank")}}).catch(t=>{l(t.message)})},[h]),s.useEffect(()=>{var e;z&&L&&R&&(b(!1),c(j({id:R._id,email:L,user:((e=u==null?void 0:u.employee)==null?void 0:e.name)||""})).then(({payload:t={}})=>{const{message:a}=(t==null?void 0:t.data)||{};a&&l(a),k(!1),w(null)}).catch(t=>{l(t.message),w(null)}))},[z,L,R]);const M=s.useMemo(()=>Ie(e=>{var t,a,i;x.current.setQuickFilterValues((i=(a=(t=e.split)==null?void 0:t.call(e," "))==null?void 0:a.filter)==null?void 0:i.call(a,o=>o!==""))},500),[x]);s.useEffect(()=>{var e;C&&((e=p.data)!=null&&e.length)&&(F(!0),M(C),setTimeout(()=>{F(!1)},500))},[p.data]);const Z=e=>{M(e.target.value),c(Re(e.target.value))},y=e=>{k(!0),K(e)},ee=()=>{N("Sales/Purchase","LorryReceipt","write")&&v("/transactions/lorryReceipts/addLorryReceipt",{state:g})},te=e=>{N("Sales/Purchase","LorryReceipt","write")&&v("/transactions/lorryReceipts/editLorryReceipt",{state:{lrId:e}})},re=e=>{N("Sales/Purchase","LorryReceipt","write")&&(I(e),S(!0))},ae=e=>{S(!0),e.target.value==="true"?c(xe(V)).then(({payload:t={}})=>{const{message:a}=(t==null?void 0:t.data)||{};a?l(a):B(),S(!1)}).catch(()=>{l("Something went wrong! Please try later or contact Administrator.")}):I(""),S(!1)},se=(e,t)=>{P(t),T({page:0,pageSize:100}),c(_e(t._id))};return r.createElement(r.Fragment,null,(W||X)&&r.createElement(we,null),r.createElement("div",{className:"inner-wrap"},q&&r.createElement(ue,{isOpen:!0,onClose:ae,title:"Are you sure?",content:"Do you want to delete the lorry receipt?",warning:!0}),r.createElement("div",{className:"page_head"},r.createElement("h1",{className:"pageHead"},"Lorry receipts"),r.createElement("div",{className:"page_actions"},r.createElement(Oe,{size:"small",sx:{width:"230px",marginRight:"5px"}},r.createElement(ze,{disablePortal:!0,size:"small",name:"branch",className:"multi-select",options:Q,value:g||null,onChange:se,disabled:!G(),getOptionLabel:e=>e.name,openOnFocus:!0,renderInput:e=>r.createElement(H,{...e,label:"Select branch",fullWidth:!0})})),r.createElement(ke,{variant:"contained",size:"small",type:"button",color:"primary",className:"ml6",onClick:ee},"Add a lorry receipt"))),D!==""&&r.createElement(Fe,{sx:{width:"100%",margin:"0 0 30px 0",border:"1px solid red",borderRadius:"4px"},spacing:2},r.createElement(Te,{severity:"error"},D)),r.createElement("div",{style:{width:"100%"}},r.createElement(Pe,{apiRef:x,autoHeight:!0,density:"compact",rows:p.data,rowCount:p.total,loading:p.isLoading,pageSizeOptions:[100],paginationModel:f,onPaginationModelChange:T,paginationMode:"server",columns:A,getRowId:e=>e._id,sx:{backgroundColor:"primary.contrastText"},initialState:{...A,columns:{columnVisibilityModel:{_id:!1}}},disableSelectionOnClick:!0,disableColumnFilter:!0,disableColumnSelector:!0,disableDensitySelector:!0,components:{Toolbar:()=>r.createElement(De,{sx:{gap:"6px",mb:"10px",justifyContent:"end",border:"none"}},r.createElement(H,{variant:"standard",placeholder:"Search...",autoFocus:!!C,onChange:Z,value:C,InputProps:{startAdornment:r.createElement(Be,{position:"start"},r.createElement(ie,null))}}))}}),r.createElement(Ne,{isOpen:J,setIsOpen:b,handleEmailClose:()=>{b(!1),w(null)},handleSendEmail:e=>y(e),contentBody:""}))))};export{wt as default};
